---
title: "Optimizer"
author: "camq"
date: "December 17, 2018"
output: html_document
---

```{r}
#This file contains all code used in the process of optimizing our upper and lower bounds. Unfortunately, the code as it stands is not quite conducive to easy reproduction, and contains rewriting of code from our SimulationEnv. Nik and Cameron were unable to easily transfer the optimizer and adapt it to functions used in the SimulationEnv, thus the need for this separate file.
```

#RSI, Article Portfoilio

```{r}
Initial_Capital <- 1000
Upper_RSI <- 60
Lower_RSI <- 40
```

```{r}
RSI_Tbl <- CSCO_RSI
Price_Tbl <- CSCO_Price
```
```{r}
Model_RSI_CSCO <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_CSCO > Upper_RSI, "sell", ifelse(RSI_CSCO < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_CSCO = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select(1:5, "close_CSCO") %>%
  arrange(time) %>%
  filter(time < "2018-11-27")
```
```{r}
for(i in 2:(length(Model_RSI_CSCO$Action)-1)){
  prev=(Model_RSI_CSCO$Action[i-1])
  curr=(Model_RSI_CSCO$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_CSCO$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_CSCO$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_CSCO$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_CSCO$Action[i]="none"
  }
}
```
```{r}
if(Model_RSI_CSCO$Action[1]=="buy"){
    Model_RSI_CSCO$StocksHeld[1]=(Model_RSI_CSCO$Capital_CSCO[1]/Model_RSI_CSCO$close_CSCO[1])
    Model_RSI_CSCO$Capital_CSCO[1]=0
}


for(i in 2:(length(Model_RSI_CSCO$Action)-1)){
  prev=(Model_RSI_CSCO$Action[i-1])
  curr=(Model_RSI_CSCO$Action[i])
  
  if(curr=="buy"){
    Model_RSI_CSCO$StocksHeld[i]=(Model_RSI_CSCO$Capital_CSCO[i-1]/Model_RSI_CSCO$close_CSCO[i])
    Model_RSI_CSCO$Capital_CSCO[i]=0
  }else if(curr=="sell"){
    Model_RSI_CSCO$Capital_CSCO[i]=(Model_RSI_CSCO$StocksHeld[i-1]*Model_RSI_CSCO$close_CSCO[i])
    Model_RSI_CSCO$StocksHeld[i]=0
  }
  else{
    Model_RSI_CSCO$Capital_CSCO[i]=Model_RSI_CSCO$Capital_CSCO[i-1]
    Model_RSI_CSCO$StocksHeld[i]=Model_RSI_CSCO$StocksHeld[i-1]
  }
}

if(Model_RSI_CSCO$StocksHeld[length(Model_RSI_CSCO$Action)-1]>0){
    Model_RSI_CSCO$Capital_CSCO[length(Model_RSI_CSCO$Action)]=(Model_RSI_CSCO$StocksHeld[length(Model_RSI_CSCO$Action)-1]*Model_RSI_CSCO$close_CSCO[length(Model_RSI_CSCO$Action)])
    Model_RSI_CSCO$Action[length(Model_RSI_CSCO$Action)]="sell"
    Model_RSI_CSCO$StocksHeld[length(Model_RSI_CSCO$Action)]=0  
}else{
  Model_RSI_CSCO$Capital_CSCO[length(Model_RSI_CSCO$Action)]=Model_RSI_CSCO$Capital_CSCO[length(Model_RSI_CSCO$Action)-1]
}
```

Calculate returns:
```{r}
(returns_RSI_CSCO <- (Model_RSI_CSCO$Capital_CSCO[length(Model_RSI_CSCO$Action)]/Initial_Capital-1)*100)
(returns_CSCO_hold <- (Model_RSI_CSCO$close_CSCO[length(Model_RSI_CSCO$Action)]/Model_RSI_CSCO$close_CSCO[1]-1)*100)
```

##CVX Using RSI
```{r}
RSI_Tbl <- CVX_RSI
Price_Tbl <- CVX_Price
```
```{r}
Model_RSI_CVX <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_CVX > Upper_RSI, "sell", ifelse(RSI_CVX < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_CVX = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select(1:5, "close_CVX") %>%
  arrange(time) %>%
  filter(time < "2018-11-27")
```
```{r}
for(i in 2:(length(Model_RSI_CVX$Action)-1)){
  prev=(Model_RSI_CVX$Action[i-1])
  curr=(Model_RSI_CVX$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_CVX$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_CVX$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_CVX$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_CVX$Action[i]="none"
  }
}
```
```{r}
if(Model_RSI_CVX$Action[1]=="buy"){
    Model_RSI_CVX$StocksHeld[1]=(Model_RSI_CVX$Capital_CVX[1]/Model_RSI_CVX$close_CVX[1])
    Model_RSI_CVX$Capital_CVX[1]=0
}


for(i in 2:(length(Model_RSI_CVX$Action)-1)){
  prev=(Model_RSI_CVX$Action[i-1])
  curr=(Model_RSI_CVX$Action[i])
  
  if(curr=="buy"){
    Model_RSI_CVX$StocksHeld[i]=(Model_RSI_CVX$Capital_CVX[i-1]/Model_RSI_CVX$close_CVX[i])
    Model_RSI_CVX$Capital_CVX[i]=0
  }else if(curr=="sell"){
    Model_RSI_CVX$Capital_CVX[i]=(Model_RSI_CVX$StocksHeld[i-1]*Model_RSI_CVX$close_CVX[i])
    Model_RSI_CVX$StocksHeld[i]=0
  }
  else{
    Model_RSI_CVX$Capital_CVX[i]=Model_RSI_CVX$Capital_CVX[i-1]
    Model_RSI_CVX$StocksHeld[i]=Model_RSI_CVX$StocksHeld[i-1]
  }
}

if(Model_RSI_CVX$StocksHeld[length(Model_RSI_CVX$Action)-1]>0){
    Model_RSI_CVX$Capital_CVX[length(Model_RSI_CVX$Action)]=(Model_RSI_CVX$StocksHeld[length(Model_RSI_CVX$Action)-1]*Model_RSI_CVX$close_CVX[length(Model_RSI_CVX$Action)])
    Model_RSI_CVX$Action[length(Model_RSI_CVX$Action)]="sell"
    Model_RSI_CVX$StocksHeld[length(Model_RSI_CVX$Action)]=0  
}else{
  Model_RSI_CVX$Capital_CVX[length(Model_RSI_CVX$Action)]=Model_RSI_CVX$Capital_CVX[length(Model_RSI_CVX$Action)-1]
}
```

Calculate returns:
```{r}
(returns_RSI_CVX <- (Model_RSI_CVX$Capital_CVX[length(Model_RSI_CVX$Action)]/Initial_Capital-1)*100)
(returns_CVX_hold <- (Model_RSI_CVX$close_CVX[length(Model_RSI_CVX$Action)]/Model_RSI_CVX$close_CVX[1]-1)*100)
```


##GE Using RSI
```{r}
RSI_Tbl <- GE_RSI
Price_Tbl <- GE_Price
```
```{r}
Model_RSI_GE <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_GE > Upper_RSI, "sell", ifelse(RSI_GE < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_GE = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select(1:5, "close_GE") %>%
  arrange(time) %>%
  filter(time < "2018-11-27")
```
```{r}
for(i in 2:(length(Model_RSI_GE$Action)-1)){
  prev=(Model_RSI_GE$Action[i-1])
  curr=(Model_RSI_GE$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_GE$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_GE$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_GE$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_GE$Action[i]="none"
  }
}
```
```{r}
if(Model_RSI_GE$Action[1]=="buy"){
    Model_RSI_GE$StocksHeld[1]=(Model_RSI_GE$Capital_GE[1]/Model_RSI_GE$close_GE[1])
    Model_RSI_GE$Capital_GE[1]=0
}


for(i in 2:(length(Model_RSI_GE$Action)-1)){
  prev=(Model_RSI_GE$Action[i-1])
  curr=(Model_RSI_GE$Action[i])
  
  if(curr=="buy"){
    Model_RSI_GE$StocksHeld[i]=(Model_RSI_GE$Capital_GE[i-1]/Model_RSI_GE$close_GE[i])
    Model_RSI_GE$Capital_GE[i]=0
  }else if(curr=="sell"){
    Model_RSI_GE$Capital_GE[i]=(Model_RSI_GE$StocksHeld[i-1]*Model_RSI_GE$close_GE[i])
    Model_RSI_GE$StocksHeld[i]=0
  }
  else{
    Model_RSI_GE$Capital_GE[i]=Model_RSI_GE$Capital_GE[i-1]
    Model_RSI_GE$StocksHeld[i]=Model_RSI_GE$StocksHeld[i-1]
  }
}

if(Model_RSI_GE$StocksHeld[length(Model_RSI_GE$Action)-1]>0){
    Model_RSI_GE$Capital_GE[length(Model_RSI_GE$Action)]=(Model_RSI_GE$StocksHeld[length(Model_RSI_GE$Action)-1]*Model_RSI_GE$close_GE[length(Model_RSI_GE$Action)])
    Model_RSI_GE$Action[length(Model_RSI_GE$Action)]="sell"
    Model_RSI_GE$StocksHeld[length(Model_RSI_GE$Action)]=0  
}else{
  Model_RSI_GE$Capital_GE[length(Model_RSI_GE$Action)]=Model_RSI_GE$Capital_GE[length(Model_RSI_GE$Action)-1]
}
```

Calculate returns:
```{r}
(returns_RSI_GE <- (Model_RSI_GE$Capital_GE[length(Model_RSI_GE$Action)]/Initial_Capital-1)*100)
(returns_GE_hold <- (Model_RSI_GE$close_GE[length(Model_RSI_GE$Action)]/Model_RSI_GE$close_GE[1]-1)*100)
```

##IBM Using RSI
```{r}
RSI_Tbl <- IBM_RSI
Price_Tbl <- IBM_Price
```
```{r}
Model_RSI_IBM <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_IBM > Upper_RSI, "sell", ifelse(RSI_IBM < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_IBM = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select(1:5, "close_IBM") %>%
  arrange(time) %>%
  filter(time < "2018-11-27")
```
```{r}
for(i in 2:(length(Model_RSI_IBM$Action)-1)){
  prev=(Model_RSI_IBM$Action[i-1])
  curr=(Model_RSI_IBM$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_IBM$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_IBM$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_IBM$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_IBM$Action[i]="none"
  }
}
```
```{r}
if(Model_RSI_IBM$Action[1]=="buy"){
    Model_RSI_IBM$StocksHeld[1]=(Model_RSI_IBM$Capital_IBM[1]/Model_RSI_IBM$close_IBM[1])
    Model_RSI_IBM$Capital_IBM[1]=0
}


for(i in 2:(length(Model_RSI_IBM$Action)-1)){
  prev=(Model_RSI_IBM$Action[i-1])
  curr=(Model_RSI_IBM$Action[i])
  
  if(curr=="buy"){
    Model_RSI_IBM$StocksHeld[i]=(Model_RSI_IBM$Capital_IBM[i-1]/Model_RSI_IBM$close_IBM[i])
    Model_RSI_IBM$Capital_IBM[i]=0
  }else if(curr=="sell"){
    Model_RSI_IBM$Capital_IBM[i]=(Model_RSI_IBM$StocksHeld[i-1]*Model_RSI_IBM$close_IBM[i])
    Model_RSI_IBM$StocksHeld[i]=0
  }
  else{
    Model_RSI_IBM$Capital_IBM[i]=Model_RSI_IBM$Capital_IBM[i-1]
    Model_RSI_IBM$StocksHeld[i]=Model_RSI_IBM$StocksHeld[i-1]
  }
}

if(Model_RSI_IBM$StocksHeld[length(Model_RSI_IBM$Action)-1]>0){
    Model_RSI_IBM$Capital_IBM[length(Model_RSI_IBM$Action)]=(Model_RSI_IBM$StocksHeld[length(Model_RSI_IBM$Action)-1]*Model_RSI_IBM$close_IBM[length(Model_RSI_IBM$Action)])
    Model_RSI_IBM$Action[length(Model_RSI_IBM$Action)]="sell"
    Model_RSI_IBM$StocksHeld[length(Model_RSI_IBM$Action)]=0  
}else{
  Model_RSI_IBM$Capital_IBM[length(Model_RSI_IBM$Action)]=Model_RSI_IBM$Capital_IBM[length(Model_RSI_IBM$Action)-1]
}
```

Calculate returns:
```{r}
(returns_RSI_IBM <- (Model_RSI_IBM$Capital_IBM[length(Model_RSI_IBM$Action)]/Initial_Capital-1)*100)
(returns_IBM_hold <- (Model_RSI_IBM$close_IBM[length(Model_RSI_IBM$Action)]/Model_RSI_IBM$close_IBM[1]-1)*100)
```

##MMM Using RSI
```{r}
RSI_Tbl <- MMM_RSI
Price_Tbl <- MMM_Price
```
```{r}
Model_RSI_MMM <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_MMM > Upper_RSI, "sell", ifelse(RSI_MMM < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_MMM = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select(1:5, "close_MMM") %>%
  arrange(time) %>%
  filter(time < "2018-11-27") 
```
```{r}
for(i in 2:(length(Model_RSI_MMM$Action)-1)){
  prev=(Model_RSI_MMM$Action[i-1])
  curr=(Model_RSI_MMM$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_MMM$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_MMM$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_MMM$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_MMM$Action[i]="none"
  }
}
```
```{r}
if(Model_RSI_MMM$Action[1]=="buy"){
    Model_RSI_MMM$StocksHeld[1]=(Model_RSI_MMM$Capital_MMM[1]/Model_RSI_MMM$close_MMM[1])
    Model_RSI_MMM$Capital_MMM[1]=0
}


for(i in 2:(length(Model_RSI_MMM$Action)-1)){
  prev=(Model_RSI_MMM$Action[i-1])
  curr=(Model_RSI_MMM$Action[i])
  
  if(curr=="buy"){
    Model_RSI_MMM$StocksHeld[i]=(Model_RSI_MMM$Capital_MMM[i-1]/Model_RSI_MMM$close_MMM[i])
    Model_RSI_MMM$Capital_MMM[i]=0
  }else if(curr=="sell"){
    Model_RSI_MMM$Capital_MMM[i]=(Model_RSI_MMM$StocksHeld[i-1]*Model_RSI_MMM$close_MMM[i])
    Model_RSI_MMM$StocksHeld[i]=0
  }
  else{
    Model_RSI_MMM$Capital_MMM[i]=Model_RSI_MMM$Capital_MMM[i-1]
    Model_RSI_MMM$StocksHeld[i]=Model_RSI_MMM$StocksHeld[i-1]
  }
}

if(Model_RSI_MMM$StocksHeld[length(Model_RSI_MMM$Action)-1]>0){
    Model_RSI_MMM$Capital_MMM[length(Model_RSI_MMM$Action)]=(Model_RSI_MMM$StocksHeld[length(Model_RSI_MMM$Action)-1]*Model_RSI_MMM$close_MMM[length(Model_RSI_MMM$Action)])
    Model_RSI_MMM$Action[length(Model_RSI_MMM$Action)]="sell"
    Model_RSI_MMM$StocksHeld[length(Model_RSI_MMM$Action)]=0  
}else{
  Model_RSI_MMM$Capital_MMM[length(Model_RSI_MMM$Action)]=Model_RSI_MMM$Capital_MMM[length(Model_RSI_MMM$Action)-1]
}
```

Calculate returns:
```{r}
(returns_RSI_MMM <- (Model_RSI_MMM$Capital_MMM[length(Model_RSI_MMM$Action)]/Initial_Capital-1)*100)
(returns_MMM_hold <- (Model_RSI_MMM$close_MMM[length(Model_RSI_MMM$Action)]/Model_RSI_MMM$close_MMM[1]-1)*100)
```

##MSFT Using RSI
```{r}
RSI_Tbl <- MSFT_RSI
Price_Tbl <- MSFT_Price
```
```{r}
Model_RSI_MSFT <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_MSFT > Upper_RSI, "sell", ifelse(RSI_MSFT < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_MSFT = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select(1:5, "close_MSFT") %>%
  arrange(time) %>%
  filter(time < "2018-11-27")
```
```{r}
for(i in 2:(length(Model_RSI_MSFT$Action)-1)){
  prev=(Model_RSI_MSFT$Action[i-1])
  curr=(Model_RSI_MSFT$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_MSFT$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_MSFT$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_MSFT$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_MSFT$Action[i]="none"
  }
}
```
```{r}
if(Model_RSI_MSFT$Action[1]=="buy"){
    Model_RSI_MSFT$StocksHeld[1]=(Model_RSI_MSFT$Capital_MSFT[1]/Model_RSI_MSFT$close_MSFT[1])
    Model_RSI_MSFT$Capital_MSFT[1]=0
}


for(i in 2:(length(Model_RSI_MSFT$Action)-1)){
  prev=(Model_RSI_MSFT$Action[i-1])
  curr=(Model_RSI_MSFT$Action[i])
  
  if(curr=="buy"){
    Model_RSI_MSFT$StocksHeld[i]=(Model_RSI_MSFT$Capital_MSFT[i-1]/Model_RSI_MSFT$close_MSFT[i])
    Model_RSI_MSFT$Capital_MSFT[i]=0
  }else if(curr=="sell"){
    Model_RSI_MSFT$Capital_MSFT[i]=(Model_RSI_MSFT$StocksHeld[i-1]*Model_RSI_MSFT$close_MSFT[i])
    Model_RSI_MSFT$StocksHeld[i]=0
  }
  else{
    Model_RSI_MSFT$Capital_MSFT[i]=Model_RSI_MSFT$Capital_MSFT[i-1]
    Model_RSI_MSFT$StocksHeld[i]=Model_RSI_MSFT$StocksHeld[i-1]
  }
}

if(Model_RSI_MSFT$StocksHeld[length(Model_RSI_MSFT$Action)-1]>0){
    Model_RSI_MSFT$Capital_MSFT[length(Model_RSI_MSFT$Action)]=(Model_RSI_MSFT$StocksHeld[length(Model_RSI_MSFT$Action)-1]*Model_RSI_MSFT$close_MSFT[length(Model_RSI_MSFT$Action)])
    Model_RSI_MSFT$Action[length(Model_RSI_MSFT$Action)]="sell"
    Model_RSI_MSFT$StocksHeld[length(Model_RSI_MSFT$Action)]=0  
  }else{
  Model_RSI_MSFT$Capital_MSFT[length(Model_RSI_MSFT$Action)]=Model_RSI_MSFT$Capital_MSFT[length(Model_RSI_MSFT$Action)-1]
}
  
```

Calculate returns:
```{r}
(returns_RSI_MSFT <- (Model_RSI_MSFT$Capital_MSFT[length(Model_RSI_MSFT$Action)]/Initial_Capital-1)*100)
(returns_MSFT_hold <- (Model_RSI_MSFT$close_MSFT[length(Model_RSI_MSFT$Action)]/Model_RSI_MSFT$close_MSFT[1]-1)*100)
```

##PFE Using RSI
```{r}
RSI_Tbl <- PFE_RSI
Price_Tbl <- PFE_Price
```
```{r}
Model_RSI_PFE <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_PFE > Upper_RSI, "sell", ifelse(RSI_PFE < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_PFE = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select(1:5, "close_PFE") %>%
  arrange(time) %>%
  filter(time < "2018-11-27")
```
```{r}
for(i in 2:(length(Model_RSI_PFE$Action)-1)){
  prev=(Model_RSI_PFE$Action[i-1])
  curr=(Model_RSI_PFE$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_PFE$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_PFE$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_PFE$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_PFE$Action[i]="none"
  }
}
```
```{r}
if(Model_RSI_PFE$Action[1]=="buy"){
    Model_RSI_PFE$StocksHeld[1]=(Model_RSI_PFE$Capital_PFE[1]/Model_RSI_PFE$close_PFE[1])
    Model_RSI_PFE$Capital_PFE[1]=0
}


for(i in 2:(length(Model_RSI_PFE$Action)-1)){
  prev=(Model_RSI_PFE$Action[i-1])
  curr=(Model_RSI_PFE$Action[i])
  
  if(curr=="buy"){
    Model_RSI_PFE$StocksHeld[i]=(Model_RSI_PFE$Capital_PFE[i-1]/Model_RSI_PFE$close_PFE[i])
    Model_RSI_PFE$Capital_PFE[i]=0
  }else if(curr=="sell"){
    Model_RSI_PFE$Capital_PFE[i]=(Model_RSI_PFE$StocksHeld[i-1]*Model_RSI_PFE$close_PFE[i])
    Model_RSI_PFE$StocksHeld[i]=0
  }
  else{
    Model_RSI_PFE$Capital_PFE[i]=Model_RSI_PFE$Capital_PFE[i-1]
    Model_RSI_PFE$StocksHeld[i]=Model_RSI_PFE$StocksHeld[i-1]
  }
}

if(Model_RSI_PFE$StocksHeld[length(Model_RSI_PFE$Action)-1]>0){
    Model_RSI_PFE$Capital_PFE[length(Model_RSI_PFE$Action)]=(Model_RSI_PFE$StocksHeld[length(Model_RSI_PFE$Action)-1]*Model_RSI_PFE$close_PFE[length(Model_RSI_PFE$Action)])
    Model_RSI_PFE$Action[length(Model_RSI_PFE$Action)]="sell"
    Model_RSI_PFE$StocksHeld[length(Model_RSI_PFE$Action)]=0  
}else{
  Model_RSI_PFE$Capital_PFE[length(Model_RSI_PFE$Action)]=Model_RSI_PFE$Capital_PFE[length(Model_RSI_PFE$Action)-1]
}
```

Calculate returns:
```{r}
(returns_RSI_PFE <- (Model_RSI_PFE$Capital_PFE[length(Model_RSI_PFE$Action)]/Initial_Capital-1)*100)
(returns_PFE_hold <- (Model_RSI_PFE$close_PFE[length(Model_RSI_PFE$Action)]/Model_RSI_PFE$close_PFE[1]-1)*100)
```

##TRV Using RSI
```{r}
RSI_Tbl <- TRV_RSI
Price_Tbl <- TRV_Price
```
```{r}
Model_RSI_TRV <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_TRV > Upper_RSI, "sell", ifelse(RSI_TRV < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_TRV = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select(1:5, "close_TRV") %>%
  arrange(time) %>%
  filter(time < "2018-11-27")
```
```{r}
for(i in 2:(length(Model_RSI_TRV$Action)-1)){
  prev=(Model_RSI_TRV$Action[i-1])
  curr=(Model_RSI_TRV$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_TRV$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_TRV$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_TRV$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_TRV$Action[i]="none"
  }
}
```
```{r}
if(Model_RSI_TRV$Action[1]=="buy"){
    Model_RSI_TRV$StocksHeld[1]=(Model_RSI_TRV$Capital_TRV[1]/Model_RSI_TRV$close_TRV[1])
    Model_RSI_TRV$Capital_TRV[1]=0
}


for(i in 2:(length(Model_RSI_TRV$Action)-1)){
  prev=(Model_RSI_TRV$Action[i-1])
  curr=(Model_RSI_TRV$Action[i])
  
  if(curr=="buy"){
    Model_RSI_TRV$StocksHeld[i]=(Model_RSI_TRV$Capital_TRV[i-1]/Model_RSI_TRV$close_TRV[i])
    Model_RSI_TRV$Capital_TRV[i]=0
  }else if(curr=="sell"){
    Model_RSI_TRV$Capital_TRV[i]=(Model_RSI_TRV$StocksHeld[i-1]*Model_RSI_TRV$close_TRV[i])
    Model_RSI_TRV$StocksHeld[i]=0
  }
  else{
    Model_RSI_TRV$Capital_TRV[i]=Model_RSI_TRV$Capital_TRV[i-1]
    Model_RSI_TRV$StocksHeld[i]=Model_RSI_TRV$StocksHeld[i-1]
  }
}

if(Model_RSI_TRV$StocksHeld[length(Model_RSI_TRV$Action)-1]>0){
    Model_RSI_TRV$Capital_TRV[length(Model_RSI_TRV$Action)]=(Model_RSI_TRV$StocksHeld[length(Model_RSI_TRV$Action)-1]*Model_RSI_TRV$close_TRV[length(Model_RSI_TRV$Action)])
    Model_RSI_TRV$Action[length(Model_RSI_TRV$Action)]="sell"
    Model_RSI_TRV$StocksHeld[length(Model_RSI_TRV$Action)]=0  
}else{
  Model_RSI_TRV$Capital_TRV[length(Model_RSI_TRV$Action)]=Model_RSI_TRV$Capital_TRV[length(Model_RSI_TRV$Action)-1]
}
```

Calculate returns:
```{r}
(returns_RSI_TRV <- (Model_RSI_TRV$Capital_TRV[length(Model_RSI_TRV$Action)]/Initial_Capital-1)*100)
(returns_TRV_hold <- (Model_RSI_TRV$close_TRV[length(Model_RSI_TRV$Action)]/Model_RSI_TRV$close_TRV[1]-1)*100)
```

##UNH Using RSI
```{r}
RSI_Tbl <- UNH_RSI
Price_Tbl <- UNH_Price
```
```{r}
Model_RSI_UNH <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_UNH > Upper_RSI, "sell", ifelse(RSI_UNH < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_UNH = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select(1:5, "close_UNH") %>%
  arrange(time) %>%
  filter(time < "2018-11-27")
```
```{r}
for(i in 2:(length(Model_RSI_UNH$Action)-1)){
  prev=(Model_RSI_UNH$Action[i-1])
  curr=(Model_RSI_UNH$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_UNH$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_UNH$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_UNH$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_UNH$Action[i]="none"
  }
}
```
```{r}
if(Model_RSI_UNH$Action[1]=="buy"){
    Model_RSI_UNH$StocksHeld[1]=(Model_RSI_UNH$Capital_UNH[1]/Model_RSI_UNH$close_UNH[1])
    Model_RSI_UNH$Capital_UNH[1]=0
}


for(i in 2:(length(Model_RSI_UNH$Action)-1)){
  prev=(Model_RSI_UNH$Action[i-1])
  curr=(Model_RSI_UNH$Action[i])
  
  if(curr=="buy"){
    Model_RSI_UNH$StocksHeld[i]=(Model_RSI_UNH$Capital_UNH[i-1]/Model_RSI_UNH$close_UNH[i])
    Model_RSI_UNH$Capital_UNH[i]=0
  }else if(curr=="sell"){
    Model_RSI_UNH$Capital_UNH[i]=(Model_RSI_UNH$StocksHeld[i-1]*Model_RSI_UNH$close_UNH[i])
    Model_RSI_UNH$StocksHeld[i]=0
  }
  else{
    Model_RSI_UNH$Capital_UNH[i]=Model_RSI_UNH$Capital_UNH[i-1]
    Model_RSI_UNH$StocksHeld[i]=Model_RSI_UNH$StocksHeld[i-1]
  }
}

if(Model_RSI_UNH$StocksHeld[length(Model_RSI_UNH$Action)-1]>0){
    Model_RSI_UNH$Capital_UNH[length(Model_RSI_UNH$Action)]=(Model_RSI_UNH$StocksHeld[length(Model_RSI_UNH$Action)-1]*Model_RSI_UNH$close_UNH[length(Model_RSI_UNH$Action)])
    Model_RSI_UNH$Action[length(Model_RSI_UNH$Action)]="sell"
    Model_RSI_UNH$StocksHeld[length(Model_RSI_UNH$Action)]=0  
}else{
  Model_RSI_UNH$Capital_UNH[length(Model_RSI_UNH$Action)]=Model_RSI_UNH$Capital_UNH[length(Model_RSI_UNH$Action)-1]
}
```

Calculate returns:
```{r}
(returns_RSI_UNH <- (Model_RSI_UNH$Capital_UNH[length(Model_RSI_UNH$Action)]/Initial_Capital-1)*100)
(returns_UNH_hold <- (Model_RSI_UNH$close_UNH[length(Model_RSI_UNH$Action)]/Model_RSI_UNH$close_UNH[1]-1)*100)
```

##UTX Using RSI
```{r}
RSI_Tbl <- UTX_RSI
Price_Tbl <- UTX_Price
```
```{r}
Model_RSI_UTX <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_UTX > Upper_RSI, "sell", ifelse(RSI_UTX < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_UTX = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select(1:5, "close_UTX") %>%
  arrange(time) %>%
  filter(time < "2018-11-27") %>%
  filter(time > "2013-11-25")
```
```{r}
for(i in 2:(length(Model_RSI_UTX$Action)-1)){
  prev=(Model_RSI_UTX$Action[i-1])
  curr=(Model_RSI_UTX$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_UTX$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_UTX$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_UTX$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_UTX$Action[i]="none"
  }
}
```
```{r}
if(Model_RSI_UTX$Action[1]=="buy"){
    Model_RSI_UTX$StocksHeld[1]=(Model_RSI_UTX$Capital_UTX[1]/Model_RSI_UTX$close_UTX[1])
    Model_RSI_UTX$Capital_UTX[1]=0
}


for(i in 2:(length(Model_RSI_UTX$Action)-1)){
  prev=(Model_RSI_UTX$Action[i-1])
  curr=(Model_RSI_UTX$Action[i])
  
  if(curr=="buy"){
    Model_RSI_UTX$StocksHeld[i]=(Model_RSI_UTX$Capital_UTX[i-1]/Model_RSI_UTX$close_UTX[i])
    Model_RSI_UTX$Capital_UTX[i]=0
  }else if(curr=="sell"){
    Model_RSI_UTX$Capital_UTX[i]=(Model_RSI_UTX$StocksHeld[i-1]*Model_RSI_UTX$close_UTX[i])
    Model_RSI_UTX$StocksHeld[i]=0
  }
  else{
    Model_RSI_UTX$Capital_UTX[i]=Model_RSI_UTX$Capital_UTX[i-1]
    Model_RSI_UTX$StocksHeld[i]=Model_RSI_UTX$StocksHeld[i-1]
  }
}

if(Model_RSI_UTX$StocksHeld[length(Model_RSI_UTX$Action)-1]>0){
    Model_RSI_UTX$Capital_UTX[length(Model_RSI_UTX$Action)]=(Model_RSI_UTX$StocksHeld[length(Model_RSI_UTX$Action)-1]*Model_RSI_UTX$close_UTX[length(Model_RSI_UTX$Action)])
    Model_RSI_UTX$Action[length(Model_RSI_UTX$Action)]="sell"
    Model_RSI_UTX$StocksHeld[length(Model_RSI_UTX$Action)]=0  
}else{
  Model_RSI_UTX$Capital_UTX[length(Model_RSI_UTX$Action)]=Model_RSI_UTX$Capital_UTX[length(Model_RSI_UTX$Action)-1]
}
```

Calculate returns:
```{r}
(returns_RSI_UTX <- (Model_RSI_UTX$Capital_UTX[length(Model_RSI_UTX$Action)]/Initial_Capital-1)*100)
(returns_UTX_hold <- (Model_RSI_UTX$close_UTX[length(Model_RSI_UTX$Action)]/Model_RSI_UTX$close_UTX[1]-1)*100)
```

#Comparing RSI performance

```{r}
ggplot(Model_RSI_UNH, aes(x=time)) +
  geom_line(aes(y=Capital_UNH)) +
  geom_line(aes(y=(1000/close_UNH[1])*close_UNH))
```
```{r}
ggplot(Model_RSI_PFE, aes(x=time)) +
  geom_line(aes(y=Capital_PFE)) +
  geom_line(aes(y=(1000/close_PFE[1])*close_PFE))
```


```{r}
RSI_mean_returns <- mean(returns_RSI_CSCO+returns_RSI_CVX+returns_RSI_GE+returns_RSI_IBM+returns_RSI_MMM+returns_RSI_MSFT+returns_RSI_PFE+returns_RSI_TRV+returns_RSI_UNH+returns_RSI_UTX)
```

```{r}
hold_mean_returns <- mean(returns_CSCO_hold+returns_CVX_hold+returns_GE_hold+returns_IBM_hold+returns_MMM_hold+returns_MSFT_hold+returns_PFE_hold+returns_TRV_hold+returns_UNH_hold+returns_UTX_hold)
```

```{r}
CSCO_diff_RSI <- (returns_RSI_CSCO-returns_CSCO_hold)
CVX_diff_RSI <- (returns_RSI_CVX-returns_CVX_hold)
GE_diff_RSI <- (returns_RSI_GE-returns_GE_hold)
IBM_diff_RSI <- (returns_RSI_IBM-returns_IBM_hold)
MMM_diff_RSI <- (returns_RSI_MMM-returns_MMM_hold)
MSFT_diff_RSI <- (returns_RSI_MSFT-returns_MSFT_hold)
PFE_diff_RSI <- (returns_RSI_PFE-returns_PFE_hold)
TRV_diff_RSI <- (returns_RSI_TRV-returns_TRV_hold)
UNH_diff_RSI <- (returns_RSI_UNH-returns_UNH_hold)
UTX_diff_RSI <- (returns_RSI_UTX-returns_UTX_hold)
```


```{r} 
ThisOne <- tribble(
  ~"Stock Ticker", ~"Buy/Hold", ~"RSI Indicator",
  "CSCO", as.numeric(returns_CSCO_hold), as.numeric(returns_RSI_CSCO),
  "CVX", as.numeric(returns_CVX_hold), as.numeric(returns_RSI_CVX),
  "GE", as.numeric(returns_GE_hold), as.numeric(returns_RSI_GE),
  "IBM", as.numeric(returns_IBM_hold), as.numeric(returns_RSI_IBM),
  "MMM", as.numeric(returns_MMM_hold), as.numeric(returns_RSI_MMM),
  "MSFT", as.numeric(returns_MSFT_hold), as.numeric(returns_RSI_MSFT),
  "PFE", as.numeric(returns_PFE_hold), as.numeric(returns_RSI_PFE),
  "TRV", as.numeric(returns_TRV_hold), as.numeric(returns_RSI_TRV),
  "UNH", as.numeric(returns_UNH_hold), as.numeric(returns_RSI_UNH),
  "UTX", as.numeric(returns_UTX_hold), as.numeric(returns_RSI_UTX)
)
library(reshape2)
RSIlong <- melt(ThisOne)
names(RSIlong)[2] <- "Method"
```
```{r}
ggplot(data=RSIlong) +
  geom_col(aes(x=`Stock Ticker`, y=value, fill=Method), position = "dodge") +
  ylab("Performance") +
  ggtitle("Performance Using Original RSI Parameters (60/40)")
```

##RSI Performance vs. Variance

```{r}
var_CSCO <- var(Model_RSI_CSCO$close_CSCO)
var_CVX <- var(Model_RSI_CVX$close_CVX)
var_GE <- var(Model_RSI_GE$close_GE)
var_IBM <- var(Model_RSI_IBM$close_IBM)
var_MMM <- var(Model_RSI_MMM$close_MMM)
var_MSFT <- var(Model_RSI_MSFT$close_MSFT)
var_PFE <- var(Model_RSI_PFE$close_PFE)
var_TRV <- var(Model_RSI_TRV$close_TRV)
var_UNH <- var(Model_RSI_UNH$close_UNH)
var_UTX <- var(Model_RSI_UTX$close_UTX)
```
```{r}
var_RSI <- tribble(
  ~"Stock Ticker", ~"RSI Returns vs. Hold", ~"Variance", ~"RSI Returns",
"CSCO", CSCO_diff_RSI, var_CSCO, returns_RSI_CSCO,
"CVX", CVX_diff_RSI, var_CVX, returns_RSI_CVX,
"GE", GE_diff_RSI, var_GE, returns_RSI_GE,
"IBM", IBM_diff_RSI, var_IBM, returns_RSI_IBM,
"MMM", MMM_diff_RSI, var_MMM,  returns_RSI_MMM,
"MSFT", MSFT_diff_RSI, var_MSFT, returns_RSI_MSFT,
"PFE", PFE_diff_RSI, var_PFE, returns_RSI_PFE,
"TRV", TRV_diff_RSI, var_TRV, returns_RSI_TRV,
"UNH", UNH_diff_RSI, var_UNH, returns_RSI_UNH,
"UTX", UTX_diff_RSI, var_UTX, returns_RSI_UTX
)
```
```{r}
ggplot(var_RSI) +
  geom_point(aes(x=Variance, y=`RSI Returns vs. Hold`))
```

```{r}
ggplot(var_RSI) +
  geom_point(aes(x=Variance, y=`RSI Returns`))
```

```{r}
Model_RSI_All <- Model_RSI_CSCO %>%
  inner_join(Model_RSI_CVX, by="time") %>%
  inner_join(Model_RSI_GE, by="time") %>%
  inner_join(Model_RSI_IBM, by="time") %>%
  inner_join(Model_RSI_MMM, by="time") %>%
  inner_join(Model_RSI_MSFT, by="time") %>%
  inner_join(Model_RSI_PFE, by="time") %>%
  inner_join(Model_RSI_TRV, by="time") %>%
  inner_join(Model_RSI_UNH, by="time") %>%
  inner_join(Model_RSI_UTX, by="time") %>%
    select( -matches("Action"), -matches("StocksHeld")) 
```

#STOCH, Article Portfolio

```{r }
Initial_Capital <- 1000
Upper_STOCH <- 70
Lower_STOCH <- 30

STOCH_model_Article <-function(Initial_Capital, Upper_STOCH, Lower_STOCH){
  
 
STOCH_Tbl <- CSCO_STOCH
Price_Tbl <- CSCO_Price

Model_STOCH_CSCO <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_CSCO > Upper_STOCH, "sell", ifelse(SlowD_CSCO < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_CSCO = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_CSCO", "Action", "Capital_CSCO", "StocksHeld", "close_CSCO") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_STOCH_CSCO$Action)-1)){
  prev=(Model_STOCH_CSCO$Action[i-1])
  curr=(Model_STOCH_CSCO$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_CSCO$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_CSCO$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_CSCO$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_CSCO$Action[i]="none"
  }

if(Model_STOCH_CSCO$Action[1]=="buy"){
    Model_STOCH_CSCO$StocksHeld[1]=(Model_STOCH_CSCO$Capital_CSCO[1]/Model_STOCH_CSCO$close_CSCO[1])
    Model_STOCH_CSCO$Capital_CSCO[1]=0
}}


for(i in 2:(length(Model_STOCH_CSCO$Action)-1)){
  prev=(Model_STOCH_CSCO$Action[i-1])
  curr=(Model_STOCH_CSCO$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_CSCO$StocksHeld[i]=(Model_STOCH_CSCO$Capital_CSCO[i-1]/Model_STOCH_CSCO$close_CSCO[i])
    Model_STOCH_CSCO$Capital_CSCO[i]=0
  }else if(curr=="sell"){
    Model_STOCH_CSCO$Capital_CSCO[i]=(Model_STOCH_CSCO$StocksHeld[i-1]*Model_STOCH_CSCO$close_CSCO[i])
    Model_STOCH_CSCO$StocksHeld[i]=0
  }
  else{
    Model_STOCH_CSCO$Capital_CSCO[i]=Model_STOCH_CSCO$Capital_CSCO[i-1]
    Model_STOCH_CSCO$StocksHeld[i]=Model_STOCH_CSCO$StocksHeld[i-1]
  }

if(Model_STOCH_CSCO$StocksHeld[length(Model_STOCH_CSCO$Action)-1]>0){
    Model_STOCH_CSCO$Capital_CSCO[length(Model_STOCH_CSCO$Action)]=(Model_STOCH_CSCO$StocksHeld[length(Model_STOCH_CSCO$Action)-1]*Model_STOCH_CSCO$close_CSCO[length(Model_STOCH_CSCO$Action)])
    Model_STOCH_CSCO$Action[length(Model_STOCH_CSCO$Action)]="sell"
    Model_STOCH_CSCO$StocksHeld[length(Model_STOCH_CSCO$Action)]=0  
}else{
  Model_STOCH_CSCO$Capital_CSCO[length(Model_STOCH_CSCO$Action)]=Model_STOCH_CSCO$Capital_CSCO[length(Model_STOCH_CSCO$Action)-1]
}}




(returns_STOCH_CSCO <- (Model_STOCH_CSCO$Capital_CSCO[length(Model_STOCH_CSCO$Action)]/Initial_Capital-1)*100)
(returns_CSCO_hold <- (Model_STOCH_CSCO$close_CSCO[length(Model_STOCH_CSCO$Action)]/Model_STOCH_CSCO$close_CSCO[1]-1)*100)


##CVX Using STOCH

STOCH_Tbl <- CVX_STOCH
Price_Tbl <- CVX_Price


Model_STOCH_CVX <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_CVX > Upper_STOCH, "sell", ifelse(SlowD_CVX < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_CVX = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_CVX", "Action", "Capital_CVX", "StocksHeld", "close_CVX") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_STOCH_CVX$Action)-1)){
  prev=(Model_STOCH_CVX$Action[i-1])
  curr=(Model_STOCH_CVX$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_CVX$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_CVX$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_CVX$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_CVX$Action[i]="none"
  }
}


if(Model_STOCH_CVX$Action[1]=="buy"){
    Model_STOCH_CVX$StocksHeld[1]=(Model_STOCH_CVX$Capital_CVX[1]/Model_STOCH_CVX$close_CVX[1])
    Model_STOCH_CVX$Capital_CVX[1]=0
}


for(i in 2:(length(Model_STOCH_CVX$Action)-1)){
  prev=(Model_STOCH_CVX$Action[i-1])
  curr=(Model_STOCH_CVX$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_CVX$StocksHeld[i]=(Model_STOCH_CVX$Capital_CVX[i-1]/Model_STOCH_CVX$close_CVX[i])
    Model_STOCH_CVX$Capital_CVX[i]=0
  }else if(curr=="sell"){
    Model_STOCH_CVX$Capital_CVX[i]=(Model_STOCH_CVX$StocksHeld[i-1]*Model_STOCH_CVX$close_CVX[i])
    Model_STOCH_CVX$StocksHeld[i]=0
  }
  else{
    Model_STOCH_CVX$Capital_CVX[i]=Model_STOCH_CVX$Capital_CVX[i-1]
    Model_STOCH_CVX$StocksHeld[i]=Model_STOCH_CVX$StocksHeld[i-1]
  }
}

if(Model_STOCH_CVX$StocksHeld[length(Model_STOCH_CVX$Action)-1]>0){
    Model_STOCH_CVX$Capital_CVX[length(Model_STOCH_CVX$Action)]=(Model_STOCH_CVX$StocksHeld[length(Model_STOCH_CVX$Action)-1]*Model_STOCH_CVX$close_CVX[length(Model_STOCH_CVX$Action)])
    Model_STOCH_CVX$Action[length(Model_STOCH_CVX$Action)]="sell"
    Model_STOCH_CVX$StocksHeld[length(Model_STOCH_CVX$Action)]=0  
}else{
  Model_STOCH_CVX$Capital_CVX[length(Model_STOCH_CVX$Action)]=Model_STOCH_CVX$Capital_CVX[length(Model_STOCH_CVX$Action)-1]
}




(returns_STOCH_CVX <- (Model_STOCH_CVX$Capital_CVX[length(Model_STOCH_CVX$Action)]/Initial_Capital-1)*100)
(returns_CVX_hold <- (Model_STOCH_CVX$close_CVX[length(Model_STOCH_CVX$Action)]/Model_STOCH_CVX$close_CVX[1]-1)*100)



##GE Using STOCH

STOCH_Tbl <- GE_STOCH
Price_Tbl <- GE_Price


Model_STOCH_GE <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_GE > Upper_STOCH, "sell", ifelse(SlowD_GE < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_GE = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_GE", "Action", "Capital_GE", "StocksHeld", "close_GE") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_STOCH_GE$Action)-1)){
  prev=(Model_STOCH_GE$Action[i-1])
  curr=(Model_STOCH_GE$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_GE$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_GE$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_GE$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_GE$Action[i]="none"
  }
}


if(Model_STOCH_GE$Action[1]=="buy"){
    Model_STOCH_GE$StocksHeld[1]=(Model_STOCH_GE$Capital_GE[1]/Model_STOCH_GE$close_GE[1])
    Model_STOCH_GE$Capital_GE[1]=0
}


for(i in 2:(length(Model_STOCH_GE$Action)-1)){
  prev=(Model_STOCH_GE$Action[i-1])
  curr=(Model_STOCH_GE$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_GE$StocksHeld[i]=(Model_STOCH_GE$Capital_GE[i-1]/Model_STOCH_GE$close_GE[i])
    Model_STOCH_GE$Capital_GE[i]=0
  }else if(curr=="sell"){
    Model_STOCH_GE$Capital_GE[i]=(Model_STOCH_GE$StocksHeld[i-1]*Model_STOCH_GE$close_GE[i])
    Model_STOCH_GE$StocksHeld[i]=0
  }
  else{
    Model_STOCH_GE$Capital_GE[i]=Model_STOCH_GE$Capital_GE[i-1]
    Model_STOCH_GE$StocksHeld[i]=Model_STOCH_GE$StocksHeld[i-1]
  }
}

if(Model_STOCH_GE$StocksHeld[length(Model_STOCH_GE$Action)-1]>0){
    Model_STOCH_GE$Capital_GE[length(Model_STOCH_GE$Action)]=(Model_STOCH_GE$StocksHeld[length(Model_STOCH_GE$Action)-1]*Model_STOCH_GE$close_GE[length(Model_STOCH_GE$Action)])
    Model_STOCH_GE$Action[length(Model_STOCH_GE$Action)]="sell"
    Model_STOCH_GE$StocksHeld[length(Model_STOCH_GE$Action)]=0  
}else{
  Model_STOCH_GE$Capital_GE[length(Model_STOCH_GE$Action)]=Model_STOCH_GE$Capital_GE[length(Model_STOCH_GE$Action)-1]
}




(returns_STOCH_GE <- (Model_STOCH_GE$Capital_GE[length(Model_STOCH_GE$Action)]/Initial_Capital-1)*100)
(returns_GE_hold <- (Model_STOCH_GE$close_GE[length(Model_STOCH_GE$Action)]/Model_STOCH_GE$close_GE[1]-1)*100)


##IBM Using STOCH

STOCH_Tbl <- IBM_STOCH
Price_Tbl <- IBM_Price


Model_STOCH_IBM <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_IBM > Upper_STOCH, "sell", ifelse(SlowD_IBM < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_IBM= Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_IBM", "Action", "Capital_IBM", "StocksHeld", "close_IBM") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_STOCH_IBM$Action)-1)){
  prev=(Model_STOCH_IBM$Action[i-1])
  curr=(Model_STOCH_IBM$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_IBM$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_IBM$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_IBM$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_IBM$Action[i]="none"
  }
}


if(Model_STOCH_IBM$Action[1]=="buy"){
    Model_STOCH_IBM$StocksHeld[1]=(Model_STOCH_IBM$Capital_IBM[1]/Model_STOCH_IBM$close_IBM[1])
    Model_STOCH_IBM$Capital_IBM[1]=0
}


for(i in 2:(length(Model_STOCH_IBM$Action)-1)){
  prev=(Model_STOCH_IBM$Action[i-1])
  curr=(Model_STOCH_IBM$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_IBM$StocksHeld[i]=(Model_STOCH_IBM$Capital_IBM[i-1]/Model_STOCH_IBM$close_IBM[i])
    Model_STOCH_IBM$Capital_IBM[i]=0
  }else if(curr=="sell"){
    Model_STOCH_IBM$Capital_IBM[i]=(Model_STOCH_IBM$StocksHeld[i-1]*Model_STOCH_IBM$close_IBM[i])
    Model_STOCH_IBM$StocksHeld[i]=0
  }
  else{
    Model_STOCH_IBM$Capital_IBM[i]=Model_STOCH_IBM$Capital_IBM[i-1]
    Model_STOCH_IBM$StocksHeld[i]=Model_STOCH_IBM$StocksHeld[i-1]
  }
}

if(Model_STOCH_IBM$StocksHeld[length(Model_STOCH_IBM$Action)-1]>0){
    Model_STOCH_IBM$Capital_IBM[length(Model_STOCH_IBM$Action)]=(Model_STOCH_IBM$StocksHeld[length(Model_STOCH_IBM$Action)-1]*Model_STOCH_IBM$close_IBM[length(Model_STOCH_IBM$Action)])
    Model_STOCH_IBM$Action[length(Model_STOCH_IBM$Action)]="sell"
    Model_STOCH_IBM$StocksHeld[length(Model_STOCH_IBM$Action)]=0  
}else{
  Model_STOCH_IBM$Capital_IBM[length(Model_STOCH_IBM$Action)]=Model_STOCH_IBM$Capital_IBM[length(Model_STOCH_IBM$Action)-1]
}




(returns_STOCH_IBM <- (Model_STOCH_IBM$Capital_IBM[length(Model_STOCH_IBM$Action)]/Initial_Capital-1)*100)
(returns_IBM_hold <- (Model_STOCH_IBM$close_IBM[length(Model_STOCH_IBM$Action)]/Model_STOCH_IBM$close_IBM[1]-1)*100)


##MMM Using STOCH

STOCH_Tbl <- MMM_STOCH
Price_Tbl <- MMM_Price


Model_STOCH_MMM <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_MMM > Upper_STOCH, "sell", ifelse(SlowD_MMM < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_MMM = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_MMM", "Action", "Capital_MMM", "StocksHeld", "close_MMM") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27") 


for(i in 2:(length(Model_STOCH_MMM$Action)-1)){
  prev=(Model_STOCH_MMM$Action[i-1])
  curr=(Model_STOCH_MMM$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_MMM$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_MMM$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_MMM$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_MMM$Action[i]="none"
  }
}


if(Model_STOCH_MMM$Action[1]=="buy"){
    Model_STOCH_MMM$StocksHeld[1]=(Model_STOCH_MMM$Capital_MMM[1]/Model_STOCH_MMM$close_MMM[1])
    Model_STOCH_MMM$Capital_MMM[1]=0
}


for(i in 2:(length(Model_STOCH_MMM$Action)-1)){
  prev=(Model_STOCH_MMM$Action[i-1])
  curr=(Model_STOCH_MMM$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_MMM$StocksHeld[i]=(Model_STOCH_MMM$Capital_MMM[i-1]/Model_STOCH_MMM$close_MMM[i])
    Model_STOCH_MMM$Capital_MMM[i]=0
  }else if(curr=="sell"){
    Model_STOCH_MMM$Capital_MMM[i]=(Model_STOCH_MMM$StocksHeld[i-1]*Model_STOCH_MMM$close_MMM[i])
    Model_STOCH_MMM$StocksHeld[i]=0
  }
  else{
    Model_STOCH_MMM$Capital_MMM[i]=Model_STOCH_MMM$Capital_MMM[i-1]
    Model_STOCH_MMM$StocksHeld[i]=Model_STOCH_MMM$StocksHeld[i-1]
  }
}

if(Model_STOCH_MMM$StocksHeld[length(Model_STOCH_MMM$Action)-1]>0){
    Model_STOCH_MMM$Capital_MMM[length(Model_STOCH_MMM$Action)]=(Model_STOCH_MMM$StocksHeld[length(Model_STOCH_MMM$Action)-1]*Model_STOCH_MMM$close_MMM[length(Model_STOCH_MMM$Action)])
    Model_STOCH_MMM$Action[length(Model_STOCH_MMM$Action)]="sell"
    Model_STOCH_MMM$StocksHeld[length(Model_STOCH_MMM$Action)]=0  
}else{
  Model_STOCH_MMM$Capital_MMM[length(Model_STOCH_MMM$Action)]=Model_STOCH_MMM$Capital_MMM[length(Model_STOCH_MMM$Action)-1]
}




(returns_STOCH_MMM <- (Model_STOCH_MMM$Capital_MMM[length(Model_STOCH_MMM$Action)]/Initial_Capital-1)*100)
(returns_MMM_hold <- (Model_STOCH_MMM$close_MMM[length(Model_STOCH_MMM$Action)]/Model_STOCH_MMM$close_MMM[1]-1)*100)


##MSFT Using STOCH

STOCH_Tbl <- MSFT_STOCH
Price_Tbl <- MSFT_Price


Model_STOCH_MSFT <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_MSFT > Upper_STOCH, "sell", ifelse(SlowD_MSFT < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_MSFT = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_MSFT", "Action", "Capital_MSFT", "StocksHeld", "close_MSFT") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_STOCH_MSFT$Action)-1)){
  prev=(Model_STOCH_MSFT$Action[i-1])
  curr=(Model_STOCH_MSFT$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_MSFT$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_MSFT$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_MSFT$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_MSFT$Action[i]="none"
  }
}


if(Model_STOCH_MSFT$Action[1]=="buy"){
    Model_STOCH_MSFT$StocksHeld[1]=(Model_STOCH_MSFT$Capital_MSFT[1]/Model_STOCH_MSFT$close_MSFT[1])
    Model_STOCH_MSFT$Capital_MSFT[1]=0
}


for(i in 2:(length(Model_STOCH_MSFT$Action)-1)){
  prev=(Model_STOCH_MSFT$Action[i-1])
  curr=(Model_STOCH_MSFT$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_MSFT$StocksHeld[i]=(Model_STOCH_MSFT$Capital_MSFT[i-1]/Model_STOCH_MSFT$close_MSFT[i])
    Model_STOCH_MSFT$Capital_MSFT[i]=0
  }else if(curr=="sell"){
    Model_STOCH_MSFT$Capital_MSFT[i]=(Model_STOCH_MSFT$StocksHeld[i-1]*Model_STOCH_MSFT$close_MSFT[i])
    Model_STOCH_MSFT$StocksHeld[i]=0
  }
  else{
    Model_STOCH_MSFT$Capital_MSFT[i]=Model_STOCH_MSFT$Capital_MSFT[i-1]
    Model_STOCH_MSFT$StocksHeld[i]=Model_STOCH_MSFT$StocksHeld[i-1]
  }
}

if(Model_STOCH_MSFT$StocksHeld[length(Model_STOCH_MSFT$Action)-1]>0){
    Model_STOCH_MSFT$Capital_MSFT[length(Model_STOCH_MSFT$Action)]=(Model_STOCH_MSFT$StocksHeld[length(Model_STOCH_MSFT$Action)-1]*Model_STOCH_MSFT$close_MSFT[length(Model_STOCH_MSFT$Action)])
    Model_STOCH_MSFT$Action[length(Model_STOCH_MSFT$Action)]="sell"
    Model_STOCH_MSFT$StocksHeld[length(Model_STOCH_MSFT$Action)]=0  
  }else{
  Model_STOCH_MSFT$Capital_MSFT[length(Model_STOCH_MSFT$Action)]=Model_STOCH_MSFT$Capital_MSFT[length(Model_STOCH_MSFT$Action)-1]
}
  




(returns_STOCH_MSFT <- (Model_STOCH_MSFT$Capital_MSFT[length(Model_STOCH_MSFT$Action)]/Initial_Capital-1)*100)
(returns_MSFT_hold <- (Model_STOCH_MSFT$close_MSFT[length(Model_STOCH_MSFT$Action)]/Model_STOCH_MSFT$close_MSFT[1]-1)*100)


##PFE Using STOCH

STOCH_Tbl <- PFE_STOCH
Price_Tbl <- PFE_Price


Model_STOCH_PFE <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_PFE > Upper_STOCH, "sell", ifelse(SlowD_PFE < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_PFE = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_PFE", "Action", "Capital_PFE", "StocksHeld", "close_PFE") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_STOCH_PFE$Action)-1)){
  prev=(Model_STOCH_PFE$Action[i-1])
  curr=(Model_STOCH_PFE$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_PFE$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_PFE$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_PFE$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_PFE$Action[i]="none"
  }
}


if(Model_STOCH_PFE$Action[1]=="buy"){
    Model_STOCH_PFE$StocksHeld[1]=(Model_STOCH_PFE$Capital_PFE[1]/Model_STOCH_PFE$close_PFE[1])
    Model_STOCH_PFE$Capital_PFE[1]=0
}


for(i in 2:(length(Model_STOCH_PFE$Action)-1)){
  prev=(Model_STOCH_PFE$Action[i-1])
  curr=(Model_STOCH_PFE$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_PFE$StocksHeld[i]=(Model_STOCH_PFE$Capital_PFE[i-1]/Model_STOCH_PFE$close_PFE[i])
    Model_STOCH_PFE$Capital_PFE[i]=0
  }else if(curr=="sell"){
    Model_STOCH_PFE$Capital_PFE[i]=(Model_STOCH_PFE$StocksHeld[i-1]*Model_STOCH_PFE$close_PFE[i])
    Model_STOCH_PFE$StocksHeld[i]=0
  }
  else{
    Model_STOCH_PFE$Capital_PFE[i]=Model_STOCH_PFE$Capital_PFE[i-1]
    Model_STOCH_PFE$StocksHeld[i]=Model_STOCH_PFE$StocksHeld[i-1]
  }
}

if(Model_STOCH_PFE$StocksHeld[length(Model_STOCH_PFE$Action)-1]>0){
    Model_STOCH_PFE$Capital_PFE[length(Model_STOCH_PFE$Action)]=(Model_STOCH_PFE$StocksHeld[length(Model_STOCH_PFE$Action)-1]*Model_STOCH_PFE$close_PFE[length(Model_STOCH_PFE$Action)])
    Model_STOCH_PFE$Action[length(Model_STOCH_PFE$Action)]="sell"
    Model_STOCH_PFE$StocksHeld[length(Model_STOCH_PFE$Action)]=0  
}else{
  Model_STOCH_PFE$Capital_PFE[length(Model_STOCH_PFE$Action)]=Model_STOCH_PFE$Capital_PFE[length(Model_STOCH_PFE$Action)-1]
}




(returns_STOCH_PFE <- (Model_STOCH_PFE$Capital_PFE[length(Model_STOCH_PFE$Action)]/Initial_Capital-1)*100)
(returns_PFE_hold <- (Model_STOCH_PFE$close_PFE[length(Model_STOCH_PFE$Action)]/Model_STOCH_PFE$close_PFE[1]-1)*100)


##TRV Using STOCH

STOCH_Tbl <- TRV_STOCH
Price_Tbl <- TRV_Price


Model_STOCH_TRV <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_TRV > Upper_STOCH, "sell", ifelse(SlowD_TRV < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_TRV = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_TRV", "Action", "Capital_TRV", "StocksHeld", "close_TRV") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_STOCH_TRV$Action)-1)){
  prev=(Model_STOCH_TRV$Action[i-1])
  curr=(Model_STOCH_TRV$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_TRV$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_TRV$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_TRV$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_TRV$Action[i]="none"
  }
}


if(Model_STOCH_TRV$Action[1]=="buy"){
    Model_STOCH_TRV$StocksHeld[1]=(Model_STOCH_TRV$Capital_TRV[1]/Model_STOCH_TRV$close_TRV[1])
    Model_STOCH_TRV$Capital_TRV[1]=0
}


for(i in 2:(length(Model_STOCH_TRV$Action)-1)){
  prev=(Model_STOCH_TRV$Action[i-1])
  curr=(Model_STOCH_TRV$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_TRV$StocksHeld[i]=(Model_STOCH_TRV$Capital_TRV[i-1]/Model_STOCH_TRV$close_TRV[i])
    Model_STOCH_TRV$Capital_TRV[i]=0
  }else if(curr=="sell"){
    Model_STOCH_TRV$Capital_TRV[i]=(Model_STOCH_TRV$StocksHeld[i-1]*Model_STOCH_TRV$close_TRV[i])
    Model_STOCH_TRV$StocksHeld[i]=0
  }
  else{
    Model_STOCH_TRV$Capital_TRV[i]=Model_STOCH_TRV$Capital_TRV[i-1]
    Model_STOCH_TRV$StocksHeld[i]=Model_STOCH_TRV$StocksHeld[i-1]
  }
}

if(Model_STOCH_TRV$StocksHeld[length(Model_STOCH_TRV$Action)-1]>0){
    Model_STOCH_TRV$Capital_TRV[length(Model_STOCH_TRV$Action)]=(Model_STOCH_TRV$StocksHeld[length(Model_STOCH_TRV$Action)-1]*Model_STOCH_TRV$close_TRV[length(Model_STOCH_TRV$Action)])
    Model_STOCH_TRV$Action[length(Model_STOCH_TRV$Action)]="sell"
    Model_STOCH_TRV$StocksHeld[length(Model_STOCH_TRV$Action)]=0  
}else{
  Model_STOCH_TRV$Capital_TRV[length(Model_STOCH_TRV$Action)]=Model_STOCH_TRV$Capital_TRV[length(Model_STOCH_TRV$Action)-1]
}




(returns_STOCH_TRV <- (Model_STOCH_TRV$Capital_TRV[length(Model_STOCH_TRV$Action)]/Initial_Capital-1)*100)
(returns_TRV_hold <- (Model_STOCH_TRV$close_TRV[length(Model_STOCH_TRV$Action)]/Model_STOCH_TRV$close_TRV[1]-1)*100)


##UNH Using STOCH

STOCH_Tbl <- UNH_STOCH
Price_Tbl <- UNH_Price


Model_STOCH_UNH <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_UNH > Upper_STOCH, "sell", ifelse(SlowD_UNH < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_UNH = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_UNH", "Action", "Capital_UNH", "StocksHeld", "close_UNH") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_STOCH_UNH$Action)-1)){
  prev=(Model_STOCH_UNH$Action[i-1])
  curr=(Model_STOCH_UNH$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_UNH$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_UNH$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_UNH$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_UNH$Action[i]="none"
  }
}


if(Model_STOCH_UNH$Action[1]=="buy"){
    Model_STOCH_UNH$StocksHeld[1]=(Model_STOCH_UNH$Capital_UNH[1]/Model_STOCH_UNH$close_UNH[1])
    Model_STOCH_UNH$Capital_UNH[1]=0
}


for(i in 2:(length(Model_STOCH_UNH$Action)-1)){
  prev=(Model_STOCH_UNH$Action[i-1])
  curr=(Model_STOCH_UNH$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_UNH$StocksHeld[i]=(Model_STOCH_UNH$Capital_UNH[i-1]/Model_STOCH_UNH$close_UNH[i])
    Model_STOCH_UNH$Capital_UNH[i]=0
  }else if(curr=="sell"){
    Model_STOCH_UNH$Capital_UNH[i]=(Model_STOCH_UNH$StocksHeld[i-1]*Model_STOCH_UNH$close_UNH[i])
    Model_STOCH_UNH$StocksHeld[i]=0
  }
  else{
    Model_STOCH_UNH$Capital_UNH[i]=Model_STOCH_UNH$Capital_UNH[i-1]
    Model_STOCH_UNH$StocksHeld[i]=Model_STOCH_UNH$StocksHeld[i-1]
  }
}

if(Model_STOCH_UNH$StocksHeld[length(Model_STOCH_UNH$Action)-1]>0){
    Model_STOCH_UNH$Capital_UNH[length(Model_STOCH_UNH$Action)]=(Model_STOCH_UNH$StocksHeld[length(Model_STOCH_UNH$Action)-1]*Model_STOCH_UNH$close_UNH[length(Model_STOCH_UNH$Action)])
    Model_STOCH_UNH$Action[length(Model_STOCH_UNH$Action)]="sell"
    Model_STOCH_UNH$StocksHeld[length(Model_STOCH_UNH$Action)]=0  
}else{
  Model_STOCH_UNH$Capital_UNH[length(Model_STOCH_UNH$Action)]=Model_STOCH_UNH$Capital_UNH[length(Model_STOCH_UNH$Action)-1]
}




(returns_STOCH_UNH <- (Model_STOCH_UNH$Capital_UNH[length(Model_STOCH_UNH$Action)]/Initial_Capital-1)*100)
(returns_UNH_hold <- (Model_STOCH_UNH$close_UNH[length(Model_STOCH_UNH$Action)]/Model_STOCH_UNH$close_UNH[1]-1)*100)


##UTX Using STOCH

STOCH_Tbl <- UTX_STOCH
Price_Tbl <- UTX_Price


Model_STOCH_UTX <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_UTX > Upper_STOCH, "sell", ifelse(SlowD_UTX < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_UTX = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_UTX", "Action", "Capital_UTX", "StocksHeld", "close_UTX") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27") %>%
  filter(time > "2013-11-25")


for(i in 2:(length(Model_STOCH_UTX$Action)-1)){
  prev=(Model_STOCH_UTX$Action[i-1])
  curr=(Model_STOCH_UTX$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_UTX$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_UTX$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_UTX$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_UTX$Action[i]="none"
  }
}


if(Model_STOCH_UTX$Action[1]=="buy"){
    Model_STOCH_UTX$StocksHeld[1]=(Model_STOCH_UTX$Capital_UTX[1]/Model_STOCH_UTX$close_UTX[1])
    Model_STOCH_UTX$Capital_UTX[1]=0
}


for(i in 2:(length(Model_STOCH_UTX$Action)-1)){
  prev=(Model_STOCH_UTX$Action[i-1])
  curr=(Model_STOCH_UTX$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_UTX$StocksHeld[i]=(Model_STOCH_UTX$Capital_UTX[i-1]/Model_STOCH_UTX$close_UTX[i])
    Model_STOCH_UTX$Capital_UTX[i]=0
  }else if(curr=="sell"){
    Model_STOCH_UTX$Capital_UTX[i]=(Model_STOCH_UTX$StocksHeld[i-1]*Model_STOCH_UTX$close_UTX[i])
    Model_STOCH_UTX$StocksHeld[i]=0
  }
  else{
    Model_STOCH_UTX$Capital_UTX[i]=Model_STOCH_UTX$Capital_UTX[i-1]
    Model_STOCH_UTX$StocksHeld[i]=Model_STOCH_UTX$StocksHeld[i-1]
  }
}

if(Model_STOCH_UTX$StocksHeld[length(Model_STOCH_UTX$Action)-1]>0){
    Model_STOCH_UTX$Capital_UTX[length(Model_STOCH_UTX$Action)]=(Model_STOCH_UTX$StocksHeld[length(Model_STOCH_UTX$Action)-1]*Model_STOCH_UTX$close_UTX[length(Model_STOCH_UTX$Action)])
    Model_STOCH_UTX$Action[length(Model_STOCH_UTX$Action)]="sell"
    Model_STOCH_UTX$StocksHeld[length(Model_STOCH_UTX$Action)]=0  
}else{
  Model_STOCH_UTX$Capital_UTX[length(Model_STOCH_UTX$Action)]=Model_STOCH_UTX$Capital_UTX[length(Model_STOCH_UTX$Action)-1]
}


(returns_STOCH_UTX <- (Model_STOCH_UTX$Capital_UTX[length(Model_STOCH_UTX$Action)]/Initial_Capital-1)*100)
(returns_UTX_hold <- (Model_STOCH_UTX$close_UTX[length(Model_STOCH_UTX$Action)]/Model_STOCH_UTX$close_UTX[1]-1)*100)



STOCH_mean_returns <- mean(returns_STOCH_CSCO+returns_STOCH_CVX+returns_STOCH_GE+returns_STOCH_IBM+returns_STOCH_MMM+returns_STOCH_MSFT+returns_STOCH_PFE+returns_STOCH_TRV+returns_STOCH_UNH+returns_STOCH_UTX)


c(STOCH_mean_returns, Upper_STOCH, Lower_STOCH)

}
```


```{r eval=FALSE}
#This code is the basic framework for our optimizing of the upper and lower bounds for portfolios. It takes the above model, which makes all calculations in one function, and then recurses it and optimized the respective overbought and oversold limits.
#Input radius 
radius_input <- 20
#Number of recursions
recursions <- 3
max_upper_stoch = 80
max_lower_stoch = 40

param_j <- 2*radius_input
stoch_data<-matrix(rep(0, 300),ncol=3)

for(i in 1:recursions){
  
  for(j in 1:param_j){
    output<-STOCH_model(1000, max_upper_stoch, (max_lower_stoch+j)-(radius_input))
    stoch_data[j,]<-output
  }
  max_lower_stoch=stoch_data[which.max(stoch_data[,1]),3]
    
  for(j in 1:param_j){
    output<-STOCH_model(1000, (max_upper_stoch+j)-(radius_input), max_lower_stoch)
    stoch_data[j,]<-output
  }
  max_upper_stoch=stoch_data[which.max(stoch_data[,1]),2]
}
max_lower_stoch
max_upper_stoch
stoch_data

stoch_opt <- as.data.frame(stoch_data)
stoch_opt <- stoch_opt[apply(stoch_opt!=0, 1, all),]
colnames(stoch_opt) <- c("Mean STOCH Returns","Upper Bound STOCH","Lower Bound STOCH") 
stoch_opt

ggplot(stoch_opt, aes(x=`Upper Bound STOCH`)) +
  geom_line(aes(y=`Mean STOCH Returns`)) +
  ggtitle("With Lower Bound Fixed at 24 (After 3rd Iteration)")
```

```{r, CHANGE}
max_lower_stoch <- 24
max_upper_stoch <- 92
```

```{r}
STOCH_mean_returns_max <- STOCH_model(Initial_Capital, max_upper_stoch, max_lower_stoch)[1]

STOCH_mean_returns_old <- STOCH_model(Initial_Capital, 70, 30)[1]
```

#Comparing STOCH performance

```{r}
hold_mean_returns <- mean(returns_CSCO_hold+returns_CVX_hold+returns_GE_hold+returns_IBM_hold+returns_MMM_hold+returns_MSFT_hold+returns_PFE_hold+returns_TRV_hold+returns_UNH_hold+returns_UTX_hold)
```
###MSFT Old v New

```{r}
STOCH_Tbl <- MSFT_STOCH
Price_Tbl <- MSFT_Price
Upper_STOCH <- 70
Lower_STOCH <- 30

STOCH_MSFT_plot <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_MSFT > Upper_STOCH, "sell", ifelse(SlowD_MSFT < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_MSFT = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_MSFT", "Action", "Capital_MSFT", "StocksHeld", "close_MSFT") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(STOCH_MSFT_plot$Action)-1)){
  prev=(STOCH_MSFT_plot$Action[i-1])
  curr=(STOCH_MSFT_plot$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    STOCH_MSFT_plot$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    STOCH_MSFT_plot$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    STOCH_MSFT_plot$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    STOCH_MSFT_plot$Action[i]="none"
  }
}


if(STOCH_MSFT_plot$Action[1]=="buy"){
    STOCH_MSFT_plot$StocksHeld[1]=(STOCH_MSFT_plot$Capital_MSFT[1]/STOCH_MSFT_plot$close_MSFT[1])
    STOCH_MSFT_plot$Capital_MSFT[1]=0
}


for(i in 2:(length(STOCH_MSFT_plot$Action)-1)){
  prev=(STOCH_MSFT_plot$Action[i-1])
  curr=(STOCH_MSFT_plot$Action[i])
  
  if(curr=="buy"){
    STOCH_MSFT_plot$StocksHeld[i]=(STOCH_MSFT_plot$Capital_MSFT[i-1]/STOCH_MSFT_plot$close_MSFT[i])
    STOCH_MSFT_plot$Capital_MSFT[i]=0
  }else if(curr=="sell"){
    STOCH_MSFT_plot$Capital_MSFT[i]=(STOCH_MSFT_plot$StocksHeld[i-1]*STOCH_MSFT_plot$close_MSFT[i])
    STOCH_MSFT_plot$StocksHeld[i]=0
  }
  else{
    STOCH_MSFT_plot$Capital_MSFT[i]=STOCH_MSFT_plot$Capital_MSFT[i-1]
    STOCH_MSFT_plot$StocksHeld[i]=STOCH_MSFT_plot$StocksHeld[i-1]
  }
}

if(STOCH_MSFT_plot$StocksHeld[length(STOCH_MSFT_plot$Action)-1]>0){
    STOCH_MSFT_plot$Capital_MSFT[length(STOCH_MSFT_plot$Action)]=(STOCH_MSFT_plot$StocksHeld[length(STOCH_MSFT_plot$Action)-1]*STOCH_MSFT_plot$close_MSFT[length(STOCH_MSFT_plot$Action)])
    STOCH_MSFT_plot$Action[length(STOCH_MSFT_plot$Action)]="sell"
    STOCH_MSFT_plot$StocksHeld[length(STOCH_MSFT_plot$Action)]=0  
  }else{
  STOCH_MSFT_plot$Capital_MSFT[length(STOCH_MSFT_plot$Action)]=STOCH_MSFT_plot$Capital_MSFT[length(STOCH_MSFT_plot$Action)-1]
}
```
```{r}
STOCH_Tbl <- MSFT_STOCH
Price_Tbl <- MSFT_Price
Upper_STOCH <- max_upper_stoch
Lower_STOCH <- max_lower_stoch

STOCH_MSFT_plot_max <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_MSFT > Upper_STOCH, "sell", ifelse(SlowD_MSFT < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_MSFT = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_MSFT", "Action", "Capital_MSFT", "StocksHeld", "close_MSFT") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(STOCH_MSFT_plot_max$Action)-1)){
  prev=(STOCH_MSFT_plot_max$Action[i-1])
  curr=(STOCH_MSFT_plot_max$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    STOCH_MSFT_plot_max$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    STOCH_MSFT_plot_max$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    STOCH_MSFT_plot_max$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    STOCH_MSFT_plot_max$Action[i]="none"
  }
}


if(STOCH_MSFT_plot_max$Action[1]=="buy"){
    STOCH_MSFT_plot_max$StocksHeld[1]=(STOCH_MSFT_plot_max$Capital_MSFT[1]/STOCH_MSFT_plot_max$close_MSFT[1])
    STOCH_MSFT_plot_max$Capital_MSFT[1]=0
}


for(i in 2:(length(STOCH_MSFT_plot_max$Action)-1)){
  prev=(STOCH_MSFT_plot_max$Action[i-1])
  curr=(STOCH_MSFT_plot_max$Action[i])
  
  if(curr=="buy"){
    STOCH_MSFT_plot_max$StocksHeld[i]=(STOCH_MSFT_plot_max$Capital_MSFT[i-1]/STOCH_MSFT_plot_max$close_MSFT[i])
    STOCH_MSFT_plot_max$Capital_MSFT[i]=0
  }else if(curr=="sell"){
    STOCH_MSFT_plot_max$Capital_MSFT[i]=(STOCH_MSFT_plot_max$StocksHeld[i-1]*STOCH_MSFT_plot_max$close_MSFT[i])
    STOCH_MSFT_plot_max$StocksHeld[i]=0
  }
  else{
    STOCH_MSFT_plot_max$Capital_MSFT[i]=STOCH_MSFT_plot_max$Capital_MSFT[i-1]
    STOCH_MSFT_plot_max$StocksHeld[i]=STOCH_MSFT_plot_max$StocksHeld[i-1]
  }
}

if(STOCH_MSFT_plot_max$StocksHeld[length(STOCH_MSFT_plot_max$Action)-1]>0){
    STOCH_MSFT_plot_max$Capital_MSFT[length(STOCH_MSFT_plot_max$Action)]=(STOCH_MSFT_plot_max$StocksHeld[length(STOCH_MSFT_plot_max$Action)-1]*STOCH_MSFT_plot_max$close_MSFT[length(STOCH_MSFT_plot_max$Action)])
    STOCH_MSFT_plot_max$Action[length(STOCH_MSFT_plot_max$Action)]="sell"
    STOCH_MSFT_plot_max$StocksHeld[length(STOCH_MSFT_plot_max$Action)]=0  
  }else{
  STOCH_MSFT_plot_max$Capital_MSFT[length(STOCH_MSFT_plot_max$Action)]=STOCH_MSFT_plot_max$Capital_MSFT[length(STOCH_MSFT_plot_max$Action)-1]
}
```


```{r}
ggplot(STOCH_MSFT_plot, aes(x=time)) +
  geom_line(aes(y=Capital_MSFT)) +
  geom_line(aes(y=(1000/close_MSFT[1])*close_MSFT)) +
  ylim(0, 3500) +
  ggtitle("MSFT Holding vs. STOCH Technique, Original Parameters (70/30)")

ggplot(STOCH_MSFT_plot_max, aes(x=time)) +
  geom_line(aes(y=Capital_MSFT)) +
  geom_line(aes(y=(1000/close_MSFT[1])*close_MSFT)) +
  ylim(0, 3500) +
  ggtitle("MSFT Holding vs. STOCH Technique, Optimized Parameters (92/24)")
```


```{r}
CSCO_diff_STOCH_max <- STOCH_model(Initial_Capital, max_upper_stoch, max_lower_stoch)[4]
CVX_diff_STOCH_max <- STOCH_model(Initial_Capital, max_upper_stoch, max_lower_stoch)[5]
GE_diff_STOCH_max <- STOCH_model(Initial_Capital, max_upper_stoch, max_lower_stoch)[6]
IBM_diff_STOCH_max <- STOCH_model(Initial_Capital, max_upper_stoch, max_lower_stoch)[7]
MMM_diff_STOCH_max <- STOCH_model(Initial_Capital, max_upper_stoch, max_lower_stoch)[8]
MSFT_diff_STOCH_max <- STOCH_model(Initial_Capital, max_upper_stoch, max_lower_stoch)[9]
PFE_diff_STOCH_max <- STOCH_model(Initial_Capital, max_upper_stoch, max_lower_stoch)[10]
TRV_diff_STOCH_max <- STOCH_model(Initial_Capital, max_upper_stoch, max_lower_stoch)[11]
UNH_diff_STOCH_max <- STOCH_model(Initial_Capital, max_upper_stoch, max_lower_stoch)[12]
UTX_diff_STOCH_max <- STOCH_model(Initial_Capital, max_upper_stoch, max_lower_stoch)[13]
```


```{r}
CSCO_diff_STOCH <- (returns_STOCH_CSCO-returns_CSCO_hold)
CVX_diff_STOCH <- (returns_STOCH_CVX-returns_CVX_hold)
GE_diff_STOCH <- (returns_STOCH_GE-returns_GE_hold)
IBM_diff_STOCH <- (returns_STOCH_IBM-returns_IBM_hold)
MMM_diff_STOCH <- (returns_STOCH_MMM-returns_MMM_hold)
MSFT_diff_STOCH <- (returns_STOCH_MSFT-returns_MSFT_hold)
PFE_diff_STOCH <- (returns_STOCH_PFE-returns_PFE_hold)
TRV_diff_STOCH <- (returns_STOCH_TRV-returns_TRV_hold)
UNH_diff_STOCH <- (returns_STOCH_UNH-returns_UNH_hold)
UTX_diff_STOCH <- (returns_STOCH_UTX-returns_UTX_hold)
```




```{r} 
STOCH_model(Initial_Capital, 70, 30)
ThisOne <- tribble(
  ~"Stock Ticker", ~"Buy/Hold", ~"STOCH Indicator",
  "CSCO", as.numeric(returns_CSCO_hold), as.numeric(returns_STOCH_CSCO),
  "CVX", as.numeric(returns_CVX_hold), as.numeric(returns_STOCH_CVX),
  "GE", as.numeric(returns_GE_hold), as.numeric(returns_STOCH_GE),
  "IBM", as.numeric(returns_IBM_hold), as.numeric(returns_STOCH_IBM),
  "MMM", as.numeric(returns_MMM_hold), as.numeric(returns_STOCH_MMM),
  "MSFT", as.numeric(returns_MSFT_hold), as.numeric(returns_STOCH_MSFT),
  "PFE", as.numeric(returns_PFE_hold), as.numeric(returns_STOCH_PFE),
  "TRV", as.numeric(returns_TRV_hold), as.numeric(returns_STOCH_TRV),
  "UNH", as.numeric(returns_UNH_hold), as.numeric(returns_STOCH_UNH),
  "UTX", as.numeric(returns_UTX_hold), as.numeric(returns_STOCH_UTX)
)
library(reshape2)
STOCHlong <- melt(ThisOne)
names(STOCHlong)[2] <- "Method"



STOCH_model(Initial_Capital, max_upper_stoch, max_lower_stoch)
ThisOne_max <- tribble(
  ~"Stock Ticker", ~"Buy/Hold", ~"STOCH Indicator",
  "CSCO", as.numeric(returns_CSCO_hold), as.numeric(returns_STOCH_CSCO),
  "CVX", as.numeric(returns_CVX_hold), as.numeric(returns_STOCH_CVX),
  "GE", as.numeric(returns_GE_hold), as.numeric(returns_STOCH_GE),
  "IBM", as.numeric(returns_IBM_hold), as.numeric(returns_STOCH_IBM),
  "MMM", as.numeric(returns_MMM_hold), as.numeric(returns_STOCH_MMM),
  "MSFT", as.numeric(returns_MSFT_hold), as.numeric(returns_STOCH_MSFT),
  "PFE", as.numeric(returns_PFE_hold), as.numeric(returns_STOCH_PFE),
  "TRV", as.numeric(returns_TRV_hold), as.numeric(returns_STOCH_TRV),
  "UNH", as.numeric(returns_UNH_hold), as.numeric(returns_STOCH_UNH),
  "UTX", as.numeric(returns_UTX_hold), as.numeric(returns_STOCH_UTX)
)
STOCHlong_max <- melt(ThisOne_max)
names(STOCHlong_max)[2] <- "Method"
```

```{r}
ggplot(data=STOCHlong) +
  geom_col(aes(x=`Stock Ticker`, y=value, fill=Method), position = "dodge") +
  ylab("Performance") +
  ylim(-75, 350) +
  ggtitle("Performance Using Original STOCH Parameters (70/30)") 

ggplot(data=STOCHlong_max) +
  geom_col(aes(x=`Stock Ticker`, y=value, fill=Method), position = "dodge") +
  ylab("Performance") +
  ylim(-75, 350) +
  ggtitle("Performance Using Optimized STOCH Parameters (92/24)")
```

##STOCH Performance vs. Variance

```{r}
var_CSCO <- var(Model_STOCH_CSCO$close_CSCO)
var_CVX <- var(Model_STOCH_CVX$close_CVX)
var_GE <- var(Model_STOCH_GE$close_GE)
var_IBM <- var(Model_STOCH_IBM$close_IBM)
var_MMM <- var(Model_STOCH_MMM$close_MMM)
var_MSFT <- var(Model_STOCH_MSFT$close_MSFT)
var_PFE <- var(Model_STOCH_PFE$close_PFE)
var_TRV <- var(Model_STOCH_TRV$close_TRV)
var_UNH <- var(Model_STOCH_UNH$close_UNH)
var_UTX <- var(Model_STOCH_UTX$close_UTX)
```
```{r}

STOCH_model(Initial_Capital, 70, 30)
var_STOCH <- tribble(
  ~"Stock Ticker", ~"STOCH Returns vs. Hold", ~"Variance", ~"STOCH Returns",
"CSCO", CSCO_diff_STOCH, var_CSCO, returns_STOCH_CSCO,
"CVX", CVX_diff_STOCH, var_CVX, returns_STOCH_CVX,
"GE", GE_diff_STOCH, var_GE, returns_STOCH_GE,
"IBM", IBM_diff_STOCH, var_IBM, returns_STOCH_IBM,
"MMM", MMM_diff_STOCH, var_MMM,  returns_STOCH_MMM,
"MSFT", MSFT_diff_STOCH, var_MSFT, returns_STOCH_MSFT,
"PFE", PFE_diff_STOCH, var_PFE, returns_STOCH_PFE,
"TRV", TRV_diff_STOCH, var_TRV, returns_STOCH_TRV,
"UNH", UNH_diff_STOCH, var_UNH, returns_STOCH_UNH,
"UTX", UTX_diff_STOCH, var_UTX, returns_STOCH_UTX
)



STOCH_model(Initial_Capital, max_upper_stoch, max_lower_stoch)
var_STOCH_max <- tribble(
  ~"Stock Ticker", ~"STOCH Returns vs. Hold", ~"Variance", ~"STOCH Returns",
"CSCO", CSCO_diff_STOCH_max, var_CSCO, returns_STOCH_CSCO,
"CVX", CVX_diff_STOCH_max, var_CVX, returns_STOCH_CVX,
"GE", GE_diff_STOCH_max, var_GE, returns_STOCH_GE,
"IBM", IBM_diff_STOCH_max, var_IBM, returns_STOCH_IBM,
"MMM", MMM_diff_STOCH_max, var_MMM,  returns_STOCH_MMM,
"MSFT", MSFT_diff_STOCH_max, var_MSFT, returns_STOCH_MSFT,
"PFE", PFE_diff_STOCH_max, var_PFE, returns_STOCH_PFE,
"TRV", TRV_diff_STOCH_max, var_TRV, returns_STOCH_TRV,
"UNH", UNH_diff_STOCH_max, var_UNH, returns_STOCH_UNH,
"UTX", UTX_diff_STOCH_max, var_UTX, returns_STOCH_UTX
)
```
```{r}
ggplot(data=var_STOCH, aes(x=Variance, y=`STOCH Returns`)) +
  geom_text(aes(label=`Stock Ticker`)) +
  geom_smooth(method= "lm", se=F) +
  ylim(-100,350) +
  ggtitle("Variance of a Stock vs. Returns, Original Parameters (70/30)") 

ggplot(data=var_STOCH_max, aes(x=Variance, y=`STOCH Returns`)) +
  geom_text(aes(label= `Stock Ticker`)) +
  geom_smooth(method ="lm", se=F) +
  ylim(-100,350) +
  ggtitle("Variance of a Stock vs. Returns, Optimized Parameters (92/24)")

```



```{r}
Model_STOCH_All <- Model_STOCH_CSCO %>%
  inner_join(Model_STOCH_CVX, by="time") %>%
  inner_join(Model_STOCH_GE, by="time") %>%
  inner_join(Model_STOCH_IBM, by="time") %>%
  inner_join(Model_STOCH_MMM, by="time") %>%
  inner_join(Model_STOCH_MSFT, by="time") %>%
  inner_join(Model_STOCH_PFE, by="time") %>%
  inner_join(Model_STOCH_TRV, by="time") %>%
  inner_join(Model_STOCH_UNH, by="time") %>%
  inner_join(Model_STOCH_UTX, by="time") %>%
    select( -matches("Action"), -matches("StocksHeld")) 
```

#RSI, Article Portfolio

```{r}

RSI_model_Article <-function(Initial_Capital, Upper_RSI, Lower_RSI){
  
 
RSI_Tbl <- CSCO_RSI
Price_Tbl <- CSCO_Price



Model_RSI_CSCO_Article <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_CSCO > Upper_RSI, "sell", ifelse(RSI_CSCO < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_CSCO = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_CSCO", "Action", "Capital_CSCO", "StocksHeld", "close_CSCO") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_RSI_CSCO$Action)-1)){
  prev=(Model_RSI_CSCO$Action[i-1])
  curr=(Model_RSI_CSCO$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_CSCO$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_CSCO$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_CSCO$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_CSCO$Action[i]="none"
  }

if(Model_RSI_CSCO$Action[1]=="buy"){
    Model_RSI_CSCO$StocksHeld[1]=(Model_RSI_CSCO$Capital_CSCO[1]/Model_RSI_CSCO$close_CSCO[1])
    Model_RSI_CSCO$Capital_CSCO[1]=0
}}


for(i in 2:(length(Model_RSI_CSCO$Action)-1)){
  prev=(Model_RSI_CSCO$Action[i-1])
  curr=(Model_RSI_CSCO$Action[i])
  
  if(curr=="buy"){
    Model_RSI_CSCO$StocksHeld[i]=(Model_RSI_CSCO$Capital_CSCO[i-1]/Model_RSI_CSCO$close_CSCO[i])
    Model_RSI_CSCO$Capital_CSCO[i]=0
  }else if(curr=="sell"){
    Model_RSI_CSCO$Capital_CSCO[i]=(Model_RSI_CSCO$StocksHeld[i-1]*Model_RSI_CSCO$close_CSCO[i])
    Model_RSI_CSCO$StocksHeld[i]=0
  }
  else{
    Model_RSI_CSCO$Capital_CSCO[i]=Model_RSI_CSCO$Capital_CSCO[i-1]
    Model_RSI_CSCO$StocksHeld[i]=Model_RSI_CSCO$StocksHeld[i-1]
  }

if(Model_RSI_CSCO$StocksHeld[length(Model_RSI_CSCO$Action)-1]>0){
    Model_RSI_CSCO$Capital_CSCO[length(Model_RSI_CSCO$Action)]=(Model_RSI_CSCO$StocksHeld[length(Model_RSI_CSCO$Action)-1]*Model_RSI_CSCO$close_CSCO[length(Model_RSI_CSCO$Action)])
    Model_RSI_CSCO$Action[length(Model_RSI_CSCO$Action)]="sell"
    Model_RSI_CSCO$StocksHeld[length(Model_RSI_CSCO$Action)]=0  
}else{
  Model_RSI_CSCO$Capital_CSCO[length(Model_RSI_CSCO$Action)]=Model_RSI_CSCO$Capital_CSCO[length(Model_RSI_CSCO$Action)-1]
}}




(returns_RSI_CSCO <- (Model_RSI_CSCO$Capital_CSCO[length(Model_RSI_CSCO$Action)]/Initial_Capital-1)*100)
(returns_CSCO_hold <- (Model_RSI_CSCO$close_CSCO[length(Model_RSI_CSCO$Action)]/Model_RSI_CSCO$close_CSCO[1]-1)*100)


##CVX Using RSI

RSI_Tbl <- CVX_RSI
Price_Tbl <- CVX_Price


Model_RSI_CVX <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_CVX > Upper_RSI, "sell", ifelse(RSI_CVX < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_CVX = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_CVX", "Action", "Capital_CVX", "StocksHeld", "close_CVX") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_RSI_CVX$Action)-1)){
  prev=(Model_RSI_CVX$Action[i-1])
  curr=(Model_RSI_CVX$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_CVX$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_CVX$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_CVX$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_CVX$Action[i]="none"
  }
}


if(Model_RSI_CVX$Action[1]=="buy"){
    Model_RSI_CVX$StocksHeld[1]=(Model_RSI_CVX$Capital_CVX[1]/Model_RSI_CVX$close_CVX[1])
    Model_RSI_CVX$Capital_CVX[1]=0
}


for(i in 2:(length(Model_RSI_CVX$Action)-1)){
  prev=(Model_RSI_CVX$Action[i-1])
  curr=(Model_RSI_CVX$Action[i])
  
  if(curr=="buy"){
    Model_RSI_CVX$StocksHeld[i]=(Model_RSI_CVX$Capital_CVX[i-1]/Model_RSI_CVX$close_CVX[i])
    Model_RSI_CVX$Capital_CVX[i]=0
  }else if(curr=="sell"){
    Model_RSI_CVX$Capital_CVX[i]=(Model_RSI_CVX$StocksHeld[i-1]*Model_RSI_CVX$close_CVX[i])
    Model_RSI_CVX$StocksHeld[i]=0
  }
  else{
    Model_RSI_CVX$Capital_CVX[i]=Model_RSI_CVX$Capital_CVX[i-1]
    Model_RSI_CVX$StocksHeld[i]=Model_RSI_CVX$StocksHeld[i-1]
  }
}

if(Model_RSI_CVX$StocksHeld[length(Model_RSI_CVX$Action)-1]>0){
    Model_RSI_CVX$Capital_CVX[length(Model_RSI_CVX$Action)]=(Model_RSI_CVX$StocksHeld[length(Model_RSI_CVX$Action)-1]*Model_RSI_CVX$close_CVX[length(Model_RSI_CVX$Action)])
    Model_RSI_CVX$Action[length(Model_RSI_CVX$Action)]="sell"
    Model_RSI_CVX$StocksHeld[length(Model_RSI_CVX$Action)]=0  
}else{
  Model_RSI_CVX$Capital_CVX[length(Model_RSI_CVX$Action)]=Model_RSI_CVX$Capital_CVX[length(Model_RSI_CVX$Action)-1]
}




(returns_RSI_CVX <- (Model_RSI_CVX$Capital_CVX[length(Model_RSI_CVX$Action)]/Initial_Capital-1)*100)
(returns_CVX_hold <- (Model_RSI_CVX$close_CVX[length(Model_RSI_CVX$Action)]/Model_RSI_CVX$close_CVX[1]-1)*100)



##GE Using RSI

RSI_Tbl <- GE_RSI
Price_Tbl <- GE_Price


Model_RSI_GE <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_GE > Upper_RSI, "sell", ifelse(RSI_GE < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_GE = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_GE", "Action", "Capital_GE", "StocksHeld", "close_GE") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_RSI_GE$Action)-1)){
  prev=(Model_RSI_GE$Action[i-1])
  curr=(Model_RSI_GE$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_GE$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_GE$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_GE$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_GE$Action[i]="none"
  }
}


if(Model_RSI_GE$Action[1]=="buy"){
    Model_RSI_GE$StocksHeld[1]=(Model_RSI_GE$Capital_GE[1]/Model_RSI_GE$close_GE[1])
    Model_RSI_GE$Capital_GE[1]=0
}


for(i in 2:(length(Model_RSI_GE$Action)-1)){
  prev=(Model_RSI_GE$Action[i-1])
  curr=(Model_RSI_GE$Action[i])
  
  if(curr=="buy"){
    Model_RSI_GE$StocksHeld[i]=(Model_RSI_GE$Capital_GE[i-1]/Model_RSI_GE$close_GE[i])
    Model_RSI_GE$Capital_GE[i]=0
  }else if(curr=="sell"){
    Model_RSI_GE$Capital_GE[i]=(Model_RSI_GE$StocksHeld[i-1]*Model_RSI_GE$close_GE[i])
    Model_RSI_GE$StocksHeld[i]=0
  }
  else{
    Model_RSI_GE$Capital_GE[i]=Model_RSI_GE$Capital_GE[i-1]
    Model_RSI_GE$StocksHeld[i]=Model_RSI_GE$StocksHeld[i-1]
  }
}

if(Model_RSI_GE$StocksHeld[length(Model_RSI_GE$Action)-1]>0){
    Model_RSI_GE$Capital_GE[length(Model_RSI_GE$Action)]=(Model_RSI_GE$StocksHeld[length(Model_RSI_GE$Action)-1]*Model_RSI_GE$close_GE[length(Model_RSI_GE$Action)])
    Model_RSI_GE$Action[length(Model_RSI_GE$Action)]="sell"
    Model_RSI_GE$StocksHeld[length(Model_RSI_GE$Action)]=0  
}else{
  Model_RSI_GE$Capital_GE[length(Model_RSI_GE$Action)]=Model_RSI_GE$Capital_GE[length(Model_RSI_GE$Action)-1]
}




(returns_RSI_GE <- (Model_RSI_GE$Capital_GE[length(Model_RSI_GE$Action)]/Initial_Capital-1)*100)
(returns_GE_hold <- (Model_RSI_GE$close_GE[length(Model_RSI_GE$Action)]/Model_RSI_GE$close_GE[1]-1)*100)


##IBM Using RSI

RSI_Tbl <- IBM_RSI
Price_Tbl <- IBM_Price


Model_RSI_IBM <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_IBM > Upper_RSI, "sell", ifelse(RSI_IBM < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_IBM= Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_IBM", "Action", "Capital_IBM", "StocksHeld", "close_IBM") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_RSI_IBM$Action)-1)){
  prev=(Model_RSI_IBM$Action[i-1])
  curr=(Model_RSI_IBM$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_IBM$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_IBM$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_IBM$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_IBM$Action[i]="none"
  }
}


if(Model_RSI_IBM$Action[1]=="buy"){
    Model_RSI_IBM$StocksHeld[1]=(Model_RSI_IBM$Capital_IBM[1]/Model_RSI_IBM$close_IBM[1])
    Model_RSI_IBM$Capital_IBM[1]=0
}


for(i in 2:(length(Model_RSI_IBM$Action)-1)){
  prev=(Model_RSI_IBM$Action[i-1])
  curr=(Model_RSI_IBM$Action[i])
  
  if(curr=="buy"){
    Model_RSI_IBM$StocksHeld[i]=(Model_RSI_IBM$Capital_IBM[i-1]/Model_RSI_IBM$close_IBM[i])
    Model_RSI_IBM$Capital_IBM[i]=0
  }else if(curr=="sell"){
    Model_RSI_IBM$Capital_IBM[i]=(Model_RSI_IBM$StocksHeld[i-1]*Model_RSI_IBM$close_IBM[i])
    Model_RSI_IBM$StocksHeld[i]=0
  }
  else{
    Model_RSI_IBM$Capital_IBM[i]=Model_RSI_IBM$Capital_IBM[i-1]
    Model_RSI_IBM$StocksHeld[i]=Model_RSI_IBM$StocksHeld[i-1]
  }
}

if(Model_RSI_IBM$StocksHeld[length(Model_RSI_IBM$Action)-1]>0){
    Model_RSI_IBM$Capital_IBM[length(Model_RSI_IBM$Action)]=(Model_RSI_IBM$StocksHeld[length(Model_RSI_IBM$Action)-1]*Model_RSI_IBM$close_IBM[length(Model_RSI_IBM$Action)])
    Model_RSI_IBM$Action[length(Model_RSI_IBM$Action)]="sell"
    Model_RSI_IBM$StocksHeld[length(Model_RSI_IBM$Action)]=0  
}else{
  Model_RSI_IBM$Capital_IBM[length(Model_RSI_IBM$Action)]=Model_RSI_IBM$Capital_IBM[length(Model_RSI_IBM$Action)-1]
}




(returns_RSI_IBM <- (Model_RSI_IBM$Capital_IBM[length(Model_RSI_IBM$Action)]/Initial_Capital-1)*100)
(returns_IBM_hold <- (Model_RSI_IBM$close_IBM[length(Model_RSI_IBM$Action)]/Model_RSI_IBM$close_IBM[1]-1)*100)


##MMM Using RSI

RSI_Tbl <- MMM_RSI
Price_Tbl <- MMM_Price


Model_RSI_MMM <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_MMM > Upper_RSI, "sell", ifelse(RSI_MMM < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_MMM = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_MMM", "Action", "Capital_MMM", "StocksHeld", "close_MMM") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27") 


for(i in 2:(length(Model_RSI_MMM$Action)-1)){
  prev=(Model_RSI_MMM$Action[i-1])
  curr=(Model_RSI_MMM$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_MMM$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_MMM$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_MMM$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_MMM$Action[i]="none"
  }
}


if(Model_RSI_MMM$Action[1]=="buy"){
    Model_RSI_MMM$StocksHeld[1]=(Model_RSI_MMM$Capital_MMM[1]/Model_RSI_MMM$close_MMM[1])
    Model_RSI_MMM$Capital_MMM[1]=0
}


for(i in 2:(length(Model_RSI_MMM$Action)-1)){
  prev=(Model_RSI_MMM$Action[i-1])
  curr=(Model_RSI_MMM$Action[i])
  
  if(curr=="buy"){
    Model_RSI_MMM$StocksHeld[i]=(Model_RSI_MMM$Capital_MMM[i-1]/Model_RSI_MMM$close_MMM[i])
    Model_RSI_MMM$Capital_MMM[i]=0
  }else if(curr=="sell"){
    Model_RSI_MMM$Capital_MMM[i]=(Model_RSI_MMM$StocksHeld[i-1]*Model_RSI_MMM$close_MMM[i])
    Model_RSI_MMM$StocksHeld[i]=0
  }
  else{
    Model_RSI_MMM$Capital_MMM[i]=Model_RSI_MMM$Capital_MMM[i-1]
    Model_RSI_MMM$StocksHeld[i]=Model_RSI_MMM$StocksHeld[i-1]
  }
}

if(Model_RSI_MMM$StocksHeld[length(Model_RSI_MMM$Action)-1]>0){
    Model_RSI_MMM$Capital_MMM[length(Model_RSI_MMM$Action)]=(Model_RSI_MMM$StocksHeld[length(Model_RSI_MMM$Action)-1]*Model_RSI_MMM$close_MMM[length(Model_RSI_MMM$Action)])
    Model_RSI_MMM$Action[length(Model_RSI_MMM$Action)]="sell"
    Model_RSI_MMM$StocksHeld[length(Model_RSI_MMM$Action)]=0  
}else{
  Model_RSI_MMM$Capital_MMM[length(Model_RSI_MMM$Action)]=Model_RSI_MMM$Capital_MMM[length(Model_RSI_MMM$Action)-1]
}




(returns_RSI_MMM <- (Model_RSI_MMM$Capital_MMM[length(Model_RSI_MMM$Action)]/Initial_Capital-1)*100)
(returns_MMM_hold <- (Model_RSI_MMM$close_MMM[length(Model_RSI_MMM$Action)]/Model_RSI_MMM$close_MMM[1]-1)*100)


##MSFT Using RSI

RSI_Tbl <- MSFT_RSI
Price_Tbl <- MSFT_Price


Model_RSI_MSFT <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_MSFT > Upper_RSI, "sell", ifelse(RSI_MSFT < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_MSFT = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_MSFT", "Action", "Capital_MSFT", "StocksHeld", "close_MSFT") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_RSI_MSFT$Action)-1)){
  prev=(Model_RSI_MSFT$Action[i-1])
  curr=(Model_RSI_MSFT$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_MSFT$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_MSFT$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_MSFT$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_MSFT$Action[i]="none"
  }
}


if(Model_RSI_MSFT$Action[1]=="buy"){
    Model_RSI_MSFT$StocksHeld[1]=(Model_RSI_MSFT$Capital_MSFT[1]/Model_RSI_MSFT$close_MSFT[1])
    Model_RSI_MSFT$Capital_MSFT[1]=0
}


for(i in 2:(length(Model_RSI_MSFT$Action)-1)){
  prev=(Model_RSI_MSFT$Action[i-1])
  curr=(Model_RSI_MSFT$Action[i])
  
  if(curr=="buy"){
    Model_RSI_MSFT$StocksHeld[i]=(Model_RSI_MSFT$Capital_MSFT[i-1]/Model_RSI_MSFT$close_MSFT[i])
    Model_RSI_MSFT$Capital_MSFT[i]=0
  }else if(curr=="sell"){
    Model_RSI_MSFT$Capital_MSFT[i]=(Model_RSI_MSFT$StocksHeld[i-1]*Model_RSI_MSFT$close_MSFT[i])
    Model_RSI_MSFT$StocksHeld[i]=0
  }
  else{
    Model_RSI_MSFT$Capital_MSFT[i]=Model_RSI_MSFT$Capital_MSFT[i-1]
    Model_RSI_MSFT$StocksHeld[i]=Model_RSI_MSFT$StocksHeld[i-1]
  }
}

if(Model_RSI_MSFT$StocksHeld[length(Model_RSI_MSFT$Action)-1]>0){
    Model_RSI_MSFT$Capital_MSFT[length(Model_RSI_MSFT$Action)]=(Model_RSI_MSFT$StocksHeld[length(Model_RSI_MSFT$Action)-1]*Model_RSI_MSFT$close_MSFT[length(Model_RSI_MSFT$Action)])
    Model_RSI_MSFT$Action[length(Model_RSI_MSFT$Action)]="sell"
    Model_RSI_MSFT$StocksHeld[length(Model_RSI_MSFT$Action)]=0  
  }else{
  Model_RSI_MSFT$Capital_MSFT[length(Model_RSI_MSFT$Action)]=Model_RSI_MSFT$Capital_MSFT[length(Model_RSI_MSFT$Action)-1]
}
  




(returns_RSI_MSFT <- (Model_RSI_MSFT$Capital_MSFT[length(Model_RSI_MSFT$Action)]/Initial_Capital-1)*100)
(returns_MSFT_hold <- (Model_RSI_MSFT$close_MSFT[length(Model_RSI_MSFT$Action)]/Model_RSI_MSFT$close_MSFT[1]-1)*100)


##PFE Using RSI

RSI_Tbl <- PFE_RSI
Price_Tbl <- PFE_Price


Model_RSI_PFE <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_PFE > Upper_RSI, "sell", ifelse(RSI_PFE < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_PFE = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_PFE", "Action", "Capital_PFE", "StocksHeld", "close_PFE") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_RSI_PFE$Action)-1)){
  prev=(Model_RSI_PFE$Action[i-1])
  curr=(Model_RSI_PFE$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_PFE$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_PFE$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_PFE$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_PFE$Action[i]="none"
  }
}


if(Model_RSI_PFE$Action[1]=="buy"){
    Model_RSI_PFE$StocksHeld[1]=(Model_RSI_PFE$Capital_PFE[1]/Model_RSI_PFE$close_PFE[1])
    Model_RSI_PFE$Capital_PFE[1]=0
}


for(i in 2:(length(Model_RSI_PFE$Action)-1)){
  prev=(Model_RSI_PFE$Action[i-1])
  curr=(Model_RSI_PFE$Action[i])
  
  if(curr=="buy"){
    Model_RSI_PFE$StocksHeld[i]=(Model_RSI_PFE$Capital_PFE[i-1]/Model_RSI_PFE$close_PFE[i])
    Model_RSI_PFE$Capital_PFE[i]=0
  }else if(curr=="sell"){
    Model_RSI_PFE$Capital_PFE[i]=(Model_RSI_PFE$StocksHeld[i-1]*Model_RSI_PFE$close_PFE[i])
    Model_RSI_PFE$StocksHeld[i]=0
  }
  else{
    Model_RSI_PFE$Capital_PFE[i]=Model_RSI_PFE$Capital_PFE[i-1]
    Model_RSI_PFE$StocksHeld[i]=Model_RSI_PFE$StocksHeld[i-1]
  }
}

if(Model_RSI_PFE$StocksHeld[length(Model_RSI_PFE$Action)-1]>0){
    Model_RSI_PFE$Capital_PFE[length(Model_RSI_PFE$Action)]=(Model_RSI_PFE$StocksHeld[length(Model_RSI_PFE$Action)-1]*Model_RSI_PFE$close_PFE[length(Model_RSI_PFE$Action)])
    Model_RSI_PFE$Action[length(Model_RSI_PFE$Action)]="sell"
    Model_RSI_PFE$StocksHeld[length(Model_RSI_PFE$Action)]=0  
}else{
  Model_RSI_PFE$Capital_PFE[length(Model_RSI_PFE$Action)]=Model_RSI_PFE$Capital_PFE[length(Model_RSI_PFE$Action)-1]
}




(returns_RSI_PFE <- (Model_RSI_PFE$Capital_PFE[length(Model_RSI_PFE$Action)]/Initial_Capital-1)*100)
(returns_PFE_hold <- (Model_RSI_PFE$close_PFE[length(Model_RSI_PFE$Action)]/Model_RSI_PFE$close_PFE[1]-1)*100)


##TRV Using RSI

RSI_Tbl <- TRV_RSI
Price_Tbl <- TRV_Price


Model_RSI_TRV <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_TRV > Upper_RSI, "sell", ifelse(RSI_TRV < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_TRV = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_TRV", "Action", "Capital_TRV", "StocksHeld", "close_TRV") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_RSI_TRV$Action)-1)){
  prev=(Model_RSI_TRV$Action[i-1])
  curr=(Model_RSI_TRV$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_TRV$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_TRV$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_TRV$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_TRV$Action[i]="none"
  }
}


if(Model_RSI_TRV$Action[1]=="buy"){
    Model_RSI_TRV$StocksHeld[1]=(Model_RSI_TRV$Capital_TRV[1]/Model_RSI_TRV$close_TRV[1])
    Model_RSI_TRV$Capital_TRV[1]=0
}


for(i in 2:(length(Model_RSI_TRV$Action)-1)){
  prev=(Model_RSI_TRV$Action[i-1])
  curr=(Model_RSI_TRV$Action[i])
  
  if(curr=="buy"){
    Model_RSI_TRV$StocksHeld[i]=(Model_RSI_TRV$Capital_TRV[i-1]/Model_RSI_TRV$close_TRV[i])
    Model_RSI_TRV$Capital_TRV[i]=0
  }else if(curr=="sell"){
    Model_RSI_TRV$Capital_TRV[i]=(Model_RSI_TRV$StocksHeld[i-1]*Model_RSI_TRV$close_TRV[i])
    Model_RSI_TRV$StocksHeld[i]=0
  }
  else{
    Model_RSI_TRV$Capital_TRV[i]=Model_RSI_TRV$Capital_TRV[i-1]
    Model_RSI_TRV$StocksHeld[i]=Model_RSI_TRV$StocksHeld[i-1]
  }
}

if(Model_RSI_TRV$StocksHeld[length(Model_RSI_TRV$Action)-1]>0){
    Model_RSI_TRV$Capital_TRV[length(Model_RSI_TRV$Action)]=(Model_RSI_TRV$StocksHeld[length(Model_RSI_TRV$Action)-1]*Model_RSI_TRV$close_TRV[length(Model_RSI_TRV$Action)])
    Model_RSI_TRV$Action[length(Model_RSI_TRV$Action)]="sell"
    Model_RSI_TRV$StocksHeld[length(Model_RSI_TRV$Action)]=0  
}else{
  Model_RSI_TRV$Capital_TRV[length(Model_RSI_TRV$Action)]=Model_RSI_TRV$Capital_TRV[length(Model_RSI_TRV$Action)-1]
}




(returns_RSI_TRV <- (Model_RSI_TRV$Capital_TRV[length(Model_RSI_TRV$Action)]/Initial_Capital-1)*100)
(returns_TRV_hold <- (Model_RSI_TRV$close_TRV[length(Model_RSI_TRV$Action)]/Model_RSI_TRV$close_TRV[1]-1)*100)


##UNH Using RSI

RSI_Tbl <- UNH_RSI
Price_Tbl <- UNH_Price


Model_RSI_UNH <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_UNH > Upper_RSI, "sell", ifelse(RSI_UNH < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_UNH = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_UNH", "Action", "Capital_UNH", "StocksHeld", "close_UNH") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_RSI_UNH$Action)-1)){
  prev=(Model_RSI_UNH$Action[i-1])
  curr=(Model_RSI_UNH$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_UNH$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_UNH$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_UNH$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_UNH$Action[i]="none"
  }
}


if(Model_RSI_UNH$Action[1]=="buy"){
    Model_RSI_UNH$StocksHeld[1]=(Model_RSI_UNH$Capital_UNH[1]/Model_RSI_UNH$close_UNH[1])
    Model_RSI_UNH$Capital_UNH[1]=0
}


for(i in 2:(length(Model_RSI_UNH$Action)-1)){
  prev=(Model_RSI_UNH$Action[i-1])
  curr=(Model_RSI_UNH$Action[i])
  
  if(curr=="buy"){
    Model_RSI_UNH$StocksHeld[i]=(Model_RSI_UNH$Capital_UNH[i-1]/Model_RSI_UNH$close_UNH[i])
    Model_RSI_UNH$Capital_UNH[i]=0
  }else if(curr=="sell"){
    Model_RSI_UNH$Capital_UNH[i]=(Model_RSI_UNH$StocksHeld[i-1]*Model_RSI_UNH$close_UNH[i])
    Model_RSI_UNH$StocksHeld[i]=0
  }
  else{
    Model_RSI_UNH$Capital_UNH[i]=Model_RSI_UNH$Capital_UNH[i-1]
    Model_RSI_UNH$StocksHeld[i]=Model_RSI_UNH$StocksHeld[i-1]
  }
}

if(Model_RSI_UNH$StocksHeld[length(Model_RSI_UNH$Action)-1]>0){
    Model_RSI_UNH$Capital_UNH[length(Model_RSI_UNH$Action)]=(Model_RSI_UNH$StocksHeld[length(Model_RSI_UNH$Action)-1]*Model_RSI_UNH$close_UNH[length(Model_RSI_UNH$Action)])
    Model_RSI_UNH$Action[length(Model_RSI_UNH$Action)]="sell"
    Model_RSI_UNH$StocksHeld[length(Model_RSI_UNH$Action)]=0  
}else{
  Model_RSI_UNH$Capital_UNH[length(Model_RSI_UNH$Action)]=Model_RSI_UNH$Capital_UNH[length(Model_RSI_UNH$Action)-1]
}




(returns_RSI_UNH <- (Model_RSI_UNH$Capital_UNH[length(Model_RSI_UNH$Action)]/Initial_Capital-1)*100)
(returns_UNH_hold <- (Model_RSI_UNH$close_UNH[length(Model_RSI_UNH$Action)]/Model_RSI_UNH$close_UNH[1]-1)*100)


##UTX Using RSI

RSI_Tbl <- UTX_RSI
Price_Tbl <- UTX_Price


Model_RSI_UTX <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_UTX > Upper_RSI, "sell", ifelse(RSI_UTX < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_UTX = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_UTX", "Action", "Capital_UTX", "StocksHeld", "close_UTX") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27") %>%
  filter(time > "2013-11-25")


for(i in 2:(length(Model_RSI_UTX$Action)-1)){
  prev=(Model_RSI_UTX$Action[i-1])
  curr=(Model_RSI_UTX$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_UTX$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_UTX$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_UTX$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_UTX$Action[i]="none"
  }
}


if(Model_RSI_UTX$Action[1]=="buy"){
    Model_RSI_UTX$StocksHeld[1]=(Model_RSI_UTX$Capital_UTX[1]/Model_RSI_UTX$close_UTX[1])
    Model_RSI_UTX$Capital_UTX[1]=0
}


for(i in 2:(length(Model_RSI_UTX$Action)-1)){
  prev=(Model_RSI_UTX$Action[i-1])
  curr=(Model_RSI_UTX$Action[i])
  
  if(curr=="buy"){
    Model_RSI_UTX$StocksHeld[i]=(Model_RSI_UTX$Capital_UTX[i-1]/Model_RSI_UTX$close_UTX[i])
    Model_RSI_UTX$Capital_UTX[i]=0
  }else if(curr=="sell"){
    Model_RSI_UTX$Capital_UTX[i]=(Model_RSI_UTX$StocksHeld[i-1]*Model_RSI_UTX$close_UTX[i])
    Model_RSI_UTX$StocksHeld[i]=0
  }
  else{
    Model_RSI_UTX$Capital_UTX[i]=Model_RSI_UTX$Capital_UTX[i-1]
    Model_RSI_UTX$StocksHeld[i]=Model_RSI_UTX$StocksHeld[i-1]
  }
}

if(Model_RSI_UTX$StocksHeld[length(Model_RSI_UTX$Action)-1]>0){
    Model_RSI_UTX$Capital_UTX[length(Model_RSI_UTX$Action)]=(Model_RSI_UTX$StocksHeld[length(Model_RSI_UTX$Action)-1]*Model_RSI_UTX$close_UTX[length(Model_RSI_UTX$Action)])
    Model_RSI_UTX$Action[length(Model_RSI_UTX$Action)]="sell"
    Model_RSI_UTX$StocksHeld[length(Model_RSI_UTX$Action)]=0  
}else{
  Model_RSI_UTX$Capital_UTX[length(Model_RSI_UTX$Action)]=Model_RSI_UTX$Capital_UTX[length(Model_RSI_UTX$Action)-1]
}


(returns_RSI_UTX <- (Model_RSI_UTX$Capital_UTX[length(Model_RSI_UTX$Action)]/Initial_Capital-1)*100)
(returns_UTX_hold <- (Model_RSI_UTX$close_UTX[length(Model_RSI_UTX$Action)]/Model_RSI_UTX$close_UTX[1]-1)*100)



RSI_mean_returns <- mean(returns_RSI_CSCO+returns_RSI_CVX+returns_RSI_GE+returns_RSI_IBM+returns_RSI_MMM+returns_RSI_MSFT+returns_RSI_PFE+returns_RSI_TRV+returns_RSI_UNH+returns_RSI_UTX)


c(RSI_mean_returns, Upper_RSI, Lower_RSI)

}
```
```{r eval=FALSE}
#input radius 
radius_input <- 20
#number of recursions
recursions <- 3
max_upper_RSI = 80
max_lower_RSI = 40

param_j <- 2*radius_input
RSI_data<-matrix(rep(0, 300),ncol=3)

for(i in 1:recursions){
  
  for(j in 1:param_j){
    output<-RSI_model_Article(1000, max_upper_RSI, (max_lower_RSI+j)-(radius_input))
    RSI_data[j,]<-output
  }
  max_lower_RSI=RSI_data[which.max(RSI_data[,1]),3]
    
  for(j in 1:param_j){
    output<-RSI_model_Article(1000, (max_upper_RSI+j)-(radius_input), max_lower_RSI)
    RSI_data[j,]<-output
  }
  max_upper_RSI=RSI_data[which.max(RSI_data[,1]),2]
}
max_lower_RSI
max_upper_RSI
RSI_data

RSI_opt <- as.data.frame(RSI_data)
RSI_opt <- RSI_opt[apply(RSI_opt!=0, 1, all),]
colnames(RSI_opt) <- c("Mean RSI Returns","Upper Bound RSI","Lower Bound RSI") 
RSI_opt

ggplot(RSI_opt, aes(x=`Upper Bound RSI`)) +
  geom_line(aes(y=`Mean RSI Returns`)) +
  ggtitle("With Lower Bound Fixed at 24 (After 3rd Iteration)")
```






#STOCH, Fidelity Portfolio

```{r}
Initial_Capital <- 1000
Upper_STOCH <- 70
Lower_STOCH <- 30

STOCH_model_Fidelity<-function(Initial_Capital, Upper_STOCH, Lower_STOCH){
  
 
STOCH_Tbl <- CMCSA_STOCH
Price_Tbl <- CMCSA_Price



Model_STOCH_CMCSA <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_CMCSA > Upper_STOCH, "sell", ifelse(SlowD_CMCSA < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_CMCSA = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_CMCSA", "Action", "Capital_CMCSA", "StocksHeld", "close_CMCSA") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_STOCH_CMCSA$Action)-1)){
  prev=(Model_STOCH_CMCSA$Action[i-1])
  curr=(Model_STOCH_CMCSA$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_CMCSA$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_CMCSA$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_CMCSA$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_CMCSA$Action[i]="none"
  }

if(Model_STOCH_CMCSA$Action[1]=="buy"){
    Model_STOCH_CMCSA$StocksHeld[1]=(Model_STOCH_CMCSA$Capital_CMCSA[1]/Model_STOCH_CMCSA$close_CMCSA[1])
    Model_STOCH_CMCSA$Capital_CMCSA[1]=0
}}


for(i in 2:(length(Model_STOCH_CMCSA$Action)-1)){
  prev=(Model_STOCH_CMCSA$Action[i-1])
  curr=(Model_STOCH_CMCSA$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_CMCSA$StocksHeld[i]=(Model_STOCH_CMCSA$Capital_CMCSA[i-1]/Model_STOCH_CMCSA$close_CMCSA[i])
    Model_STOCH_CMCSA$Capital_CMCSA[i]=0
  }else if(curr=="sell"){
    Model_STOCH_CMCSA$Capital_CMCSA[i]=(Model_STOCH_CMCSA$StocksHeld[i-1]*Model_STOCH_CMCSA$close_CMCSA[i])
    Model_STOCH_CMCSA$StocksHeld[i]=0
  }
  else{
    Model_STOCH_CMCSA$Capital_CMCSA[i]=Model_STOCH_CMCSA$Capital_CMCSA[i-1]
    Model_STOCH_CMCSA$StocksHeld[i]=Model_STOCH_CMCSA$StocksHeld[i-1]
  }

if(Model_STOCH_CMCSA$StocksHeld[length(Model_STOCH_CMCSA$Action)-1]>0){
    Model_STOCH_CMCSA$Capital_CMCSA[length(Model_STOCH_CMCSA$Action)]=(Model_STOCH_CMCSA$StocksHeld[length(Model_STOCH_CMCSA$Action)-1]*Model_STOCH_CMCSA$close_CMCSA[length(Model_STOCH_CMCSA$Action)])
    Model_STOCH_CMCSA$Action[length(Model_STOCH_CMCSA$Action)]="sell"
    Model_STOCH_CMCSA$StocksHeld[length(Model_STOCH_CMCSA$Action)]=0  
}else{
  Model_STOCH_CMCSA$Capital_CMCSA[length(Model_STOCH_CMCSA$Action)]=Model_STOCH_CMCSA$Capital_CMCSA[length(Model_STOCH_CMCSA$Action)-1]
}}




(returns_STOCH_CMCSA <- (Model_STOCH_CMCSA$Capital_CMCSA[length(Model_STOCH_CMCSA$Action)]/Initial_Capital-1)*100)
(returns_CMCSA_hold <- (Model_STOCH_CMCSA$close_CMCSA[length(Model_STOCH_CMCSA$Action)]/Model_STOCH_CMCSA$close_CMCSA[1]-1)*100)


##CVX Using STOCH

STOCH_Tbl <- CVX_STOCH
Price_Tbl <- CVX_Price


Model_STOCH_CVX <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_CVX > Upper_STOCH, "sell", ifelse(SlowD_CVX < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_CVX = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_CVX", "Action", "Capital_CVX", "StocksHeld", "close_CVX") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_STOCH_CVX$Action)-1)){
  prev=(Model_STOCH_CVX$Action[i-1])
  curr=(Model_STOCH_CVX$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_CVX$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_CVX$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_CVX$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_CVX$Action[i]="none"
  }
}


if(Model_STOCH_CVX$Action[1]=="buy"){
    Model_STOCH_CVX$StocksHeld[1]=(Model_STOCH_CVX$Capital_CVX[1]/Model_STOCH_CVX$close_CVX[1])
    Model_STOCH_CVX$Capital_CVX[1]=0
}


for(i in 2:(length(Model_STOCH_CVX$Action)-1)){
  prev=(Model_STOCH_CVX$Action[i-1])
  curr=(Model_STOCH_CVX$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_CVX$StocksHeld[i]=(Model_STOCH_CVX$Capital_CVX[i-1]/Model_STOCH_CVX$close_CVX[i])
    Model_STOCH_CVX$Capital_CVX[i]=0
  }else if(curr=="sell"){
    Model_STOCH_CVX$Capital_CVX[i]=(Model_STOCH_CVX$StocksHeld[i-1]*Model_STOCH_CVX$close_CVX[i])
    Model_STOCH_CVX$StocksHeld[i]=0
  }
  else{
    Model_STOCH_CVX$Capital_CVX[i]=Model_STOCH_CVX$Capital_CVX[i-1]
    Model_STOCH_CVX$StocksHeld[i]=Model_STOCH_CVX$StocksHeld[i-1]
  }
}

if(Model_STOCH_CVX$StocksHeld[length(Model_STOCH_CVX$Action)-1]>0){
    Model_STOCH_CVX$Capital_CVX[length(Model_STOCH_CVX$Action)]=(Model_STOCH_CVX$StocksHeld[length(Model_STOCH_CVX$Action)-1]*Model_STOCH_CVX$close_CVX[length(Model_STOCH_CVX$Action)])
    Model_STOCH_CVX$Action[length(Model_STOCH_CVX$Action)]="sell"
    Model_STOCH_CVX$StocksHeld[length(Model_STOCH_CVX$Action)]=0  
}else{
  Model_STOCH_CVX$Capital_CVX[length(Model_STOCH_CVX$Action)]=Model_STOCH_CVX$Capital_CVX[length(Model_STOCH_CVX$Action)-1]
}




(returns_STOCH_CVX <- (Model_STOCH_CVX$Capital_CVX[length(Model_STOCH_CVX$Action)]/Initial_Capital-1)*100)
(returns_CVX_hold <- (Model_STOCH_CVX$close_CVX[length(Model_STOCH_CVX$Action)]/Model_STOCH_CVX$close_CVX[1]-1)*100)



##GE Using STOCH

STOCH_Tbl <- GE_STOCH
Price_Tbl <- GE_Price


Model_STOCH_GE <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_GE > Upper_STOCH, "sell", ifelse(SlowD_GE < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_GE = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_GE", "Action", "Capital_GE", "StocksHeld", "close_GE") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_STOCH_GE$Action)-1)){
  prev=(Model_STOCH_GE$Action[i-1])
  curr=(Model_STOCH_GE$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_GE$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_GE$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_GE$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_GE$Action[i]="none"
  }
}


if(Model_STOCH_GE$Action[1]=="buy"){
    Model_STOCH_GE$StocksHeld[1]=(Model_STOCH_GE$Capital_GE[1]/Model_STOCH_GE$close_GE[1])
    Model_STOCH_GE$Capital_GE[1]=0
}


for(i in 2:(length(Model_STOCH_GE$Action)-1)){
  prev=(Model_STOCH_GE$Action[i-1])
  curr=(Model_STOCH_GE$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_GE$StocksHeld[i]=(Model_STOCH_GE$Capital_GE[i-1]/Model_STOCH_GE$close_GE[i])
    Model_STOCH_GE$Capital_GE[i]=0
  }else if(curr=="sell"){
    Model_STOCH_GE$Capital_GE[i]=(Model_STOCH_GE$StocksHeld[i-1]*Model_STOCH_GE$close_GE[i])
    Model_STOCH_GE$StocksHeld[i]=0
  }
  else{
    Model_STOCH_GE$Capital_GE[i]=Model_STOCH_GE$Capital_GE[i-1]
    Model_STOCH_GE$StocksHeld[i]=Model_STOCH_GE$StocksHeld[i-1]
  }
}

if(Model_STOCH_GE$StocksHeld[length(Model_STOCH_GE$Action)-1]>0){
    Model_STOCH_GE$Capital_GE[length(Model_STOCH_GE$Action)]=(Model_STOCH_GE$StocksHeld[length(Model_STOCH_GE$Action)-1]*Model_STOCH_GE$close_GE[length(Model_STOCH_GE$Action)])
    Model_STOCH_GE$Action[length(Model_STOCH_GE$Action)]="sell"
    Model_STOCH_GE$StocksHeld[length(Model_STOCH_GE$Action)]=0  
}else{
  Model_STOCH_GE$Capital_GE[length(Model_STOCH_GE$Action)]=Model_STOCH_GE$Capital_GE[length(Model_STOCH_GE$Action)-1]
}




(returns_STOCH_GE <- (Model_STOCH_GE$Capital_GE[length(Model_STOCH_GE$Action)]/Initial_Capital-1)*100)
(returns_GE_hold <- (Model_STOCH_GE$close_GE[length(Model_STOCH_GE$Action)]/Model_STOCH_GE$close_GE[1]-1)*100)


##JNJ Using STOCH

STOCH_Tbl <- JNJ_STOCH
Price_Tbl <- JNJ_Price


Model_STOCH_JNJ <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_JNJ > Upper_STOCH, "sell", ifelse(SlowD_JNJ < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_JNJ= Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_JNJ", "Action", "Capital_JNJ", "StocksHeld", "close_JNJ") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_STOCH_JNJ$Action)-1)){
  prev=(Model_STOCH_JNJ$Action[i-1])
  curr=(Model_STOCH_JNJ$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_JNJ$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_JNJ$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_JNJ$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_JNJ$Action[i]="none"
  }
}


if(Model_STOCH_JNJ$Action[1]=="buy"){
    Model_STOCH_JNJ$StocksHeld[1]=(Model_STOCH_JNJ$Capital_JNJ[1]/Model_STOCH_JNJ$close_JNJ[1])
    Model_STOCH_JNJ$Capital_JNJ[1]=0
}


for(i in 2:(length(Model_STOCH_JNJ$Action)-1)){
  prev=(Model_STOCH_JNJ$Action[i-1])
  curr=(Model_STOCH_JNJ$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_JNJ$StocksHeld[i]=(Model_STOCH_JNJ$Capital_JNJ[i-1]/Model_STOCH_JNJ$close_JNJ[i])
    Model_STOCH_JNJ$Capital_JNJ[i]=0
  }else if(curr=="sell"){
    Model_STOCH_JNJ$Capital_JNJ[i]=(Model_STOCH_JNJ$StocksHeld[i-1]*Model_STOCH_JNJ$close_JNJ[i])
    Model_STOCH_JNJ$StocksHeld[i]=0
  }
  else{
    Model_STOCH_JNJ$Capital_JNJ[i]=Model_STOCH_JNJ$Capital_JNJ[i-1]
    Model_STOCH_JNJ$StocksHeld[i]=Model_STOCH_JNJ$StocksHeld[i-1]
  }
}

if(Model_STOCH_JNJ$StocksHeld[length(Model_STOCH_JNJ$Action)-1]>0){
    Model_STOCH_JNJ$Capital_JNJ[length(Model_STOCH_JNJ$Action)]=(Model_STOCH_JNJ$StocksHeld[length(Model_STOCH_JNJ$Action)-1]*Model_STOCH_JNJ$close_JNJ[length(Model_STOCH_JNJ$Action)])
    Model_STOCH_JNJ$Action[length(Model_STOCH_JNJ$Action)]="sell"
    Model_STOCH_JNJ$StocksHeld[length(Model_STOCH_JNJ$Action)]=0  
}else{
  Model_STOCH_JNJ$Capital_JNJ[length(Model_STOCH_JNJ$Action)]=Model_STOCH_JNJ$Capital_JNJ[length(Model_STOCH_JNJ$Action)-1]
}




(returns_STOCH_JNJ <- (Model_STOCH_JNJ$Capital_JNJ[length(Model_STOCH_JNJ$Action)]/Initial_Capital-1)*100)
(returns_JNJ_hold <- (Model_STOCH_JNJ$close_JNJ[length(Model_STOCH_JNJ$Action)]/Model_STOCH_JNJ$close_JNJ[1]-1)*100)


##JPM Using STOCH

STOCH_Tbl <- JPM_STOCH
Price_Tbl <- JPM_Price


Model_STOCH_JPM <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_JPM > Upper_STOCH, "sell", ifelse(SlowD_JPM < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_JPM = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_JPM", "Action", "Capital_JPM", "StocksHeld", "close_JPM") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27") 


for(i in 2:(length(Model_STOCH_JPM$Action)-1)){
  prev=(Model_STOCH_JPM$Action[i-1])
  curr=(Model_STOCH_JPM$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_JPM$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_JPM$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_JPM$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_JPM$Action[i]="none"
  }
}


if(Model_STOCH_JPM$Action[1]=="buy"){
    Model_STOCH_JPM$StocksHeld[1]=(Model_STOCH_JPM$Capital_JPM[1]/Model_STOCH_JPM$close_JPM[1])
    Model_STOCH_JPM$Capital_JPM[1]=0
}


for(i in 2:(length(Model_STOCH_JPM$Action)-1)){
  prev=(Model_STOCH_JPM$Action[i-1])
  curr=(Model_STOCH_JPM$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_JPM$StocksHeld[i]=(Model_STOCH_JPM$Capital_JPM[i-1]/Model_STOCH_JPM$close_JPM[i])
    Model_STOCH_JPM$Capital_JPM[i]=0
  }else if(curr=="sell"){
    Model_STOCH_JPM$Capital_JPM[i]=(Model_STOCH_JPM$StocksHeld[i-1]*Model_STOCH_JPM$close_JPM[i])
    Model_STOCH_JPM$StocksHeld[i]=0
  }
  else{
    Model_STOCH_JPM$Capital_JPM[i]=Model_STOCH_JPM$Capital_JPM[i-1]
    Model_STOCH_JPM$StocksHeld[i]=Model_STOCH_JPM$StocksHeld[i-1]
  }
}

if(Model_STOCH_JPM$StocksHeld[length(Model_STOCH_JPM$Action)-1]>0){
    Model_STOCH_JPM$Capital_JPM[length(Model_STOCH_JPM$Action)]=(Model_STOCH_JPM$StocksHeld[length(Model_STOCH_JPM$Action)-1]*Model_STOCH_JPM$close_JPM[length(Model_STOCH_JPM$Action)])
    Model_STOCH_JPM$Action[length(Model_STOCH_JPM$Action)]="sell"
    Model_STOCH_JPM$StocksHeld[length(Model_STOCH_JPM$Action)]=0  
}else{
  Model_STOCH_JPM$Capital_JPM[length(Model_STOCH_JPM$Action)]=Model_STOCH_JPM$Capital_JPM[length(Model_STOCH_JPM$Action)-1]
}




(returns_STOCH_JPM <- (Model_STOCH_JPM$Capital_JPM[length(Model_STOCH_JPM$Action)]/Initial_Capital-1)*100)
(returns_JPM_hold <- (Model_STOCH_JPM$close_JPM[length(Model_STOCH_JPM$Action)]/Model_STOCH_JPM$close_JPM[1]-1)*100)


##MRK Using STOCH

STOCH_Tbl <- MRK_STOCH
Price_Tbl <- MRK_Price


Model_STOCH_MRK <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_MRK > Upper_STOCH, "sell", ifelse(SlowD_MRK < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_MRK = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_MRK", "Action", "Capital_MRK", "StocksHeld", "close_MRK") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_STOCH_MRK$Action)-1)){
  prev=(Model_STOCH_MRK$Action[i-1])
  curr=(Model_STOCH_MRK$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_MRK$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_MRK$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_MRK$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_MRK$Action[i]="none"
  }
}


if(Model_STOCH_MRK$Action[1]=="buy"){
    Model_STOCH_MRK$StocksHeld[1]=(Model_STOCH_MRK$Capital_MRK[1]/Model_STOCH_MRK$close_MRK[1])
    Model_STOCH_MRK$Capital_MRK[1]=0
}


for(i in 2:(length(Model_STOCH_MRK$Action)-1)){
  prev=(Model_STOCH_MRK$Action[i-1])
  curr=(Model_STOCH_MRK$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_MRK$StocksHeld[i]=(Model_STOCH_MRK$Capital_MRK[i-1]/Model_STOCH_MRK$close_MRK[i])
    Model_STOCH_MRK$Capital_MRK[i]=0
  }else if(curr=="sell"){
    Model_STOCH_MRK$Capital_MRK[i]=(Model_STOCH_MRK$StocksHeld[i-1]*Model_STOCH_MRK$close_MRK[i])
    Model_STOCH_MRK$StocksHeld[i]=0
  }
  else{
    Model_STOCH_MRK$Capital_MRK[i]=Model_STOCH_MRK$Capital_MRK[i-1]
    Model_STOCH_MRK$StocksHeld[i]=Model_STOCH_MRK$StocksHeld[i-1]
  }
}

if(Model_STOCH_MRK$StocksHeld[length(Model_STOCH_MRK$Action)-1]>0){
    Model_STOCH_MRK$Capital_MRK[length(Model_STOCH_MRK$Action)]=(Model_STOCH_MRK$StocksHeld[length(Model_STOCH_MRK$Action)-1]*Model_STOCH_MRK$close_MRK[length(Model_STOCH_MRK$Action)])
    Model_STOCH_MRK$Action[length(Model_STOCH_MRK$Action)]="sell"
    Model_STOCH_MRK$StocksHeld[length(Model_STOCH_MRK$Action)]=0  
  }else{
  Model_STOCH_MRK$Capital_MRK[length(Model_STOCH_MRK$Action)]=Model_STOCH_MRK$Capital_MRK[length(Model_STOCH_MRK$Action)-1]
}
  




(returns_STOCH_MRK <- (Model_STOCH_MRK$Capital_MRK[length(Model_STOCH_MRK$Action)]/Initial_Capital-1)*100)
(returns_MRK_hold <- (Model_STOCH_MRK$close_MRK[length(Model_STOCH_MRK$Action)]/Model_STOCH_MRK$close_MRK[1]-1)*100)


##PFE Using STOCH

STOCH_Tbl <- PFE_STOCH
Price_Tbl <- PFE_Price


Model_STOCH_PFE <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_PFE > Upper_STOCH, "sell", ifelse(SlowD_PFE < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_PFE = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_PFE", "Action", "Capital_PFE", "StocksHeld", "close_PFE") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_STOCH_PFE$Action)-1)){
  prev=(Model_STOCH_PFE$Action[i-1])
  curr=(Model_STOCH_PFE$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_PFE$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_PFE$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_PFE$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_PFE$Action[i]="none"
  }
}


if(Model_STOCH_PFE$Action[1]=="buy"){
    Model_STOCH_PFE$StocksHeld[1]=(Model_STOCH_PFE$Capital_PFE[1]/Model_STOCH_PFE$close_PFE[1])
    Model_STOCH_PFE$Capital_PFE[1]=0
}


for(i in 2:(length(Model_STOCH_PFE$Action)-1)){
  prev=(Model_STOCH_PFE$Action[i-1])
  curr=(Model_STOCH_PFE$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_PFE$StocksHeld[i]=(Model_STOCH_PFE$Capital_PFE[i-1]/Model_STOCH_PFE$close_PFE[i])
    Model_STOCH_PFE$Capital_PFE[i]=0
  }else if(curr=="sell"){
    Model_STOCH_PFE$Capital_PFE[i]=(Model_STOCH_PFE$StocksHeld[i-1]*Model_STOCH_PFE$close_PFE[i])
    Model_STOCH_PFE$StocksHeld[i]=0
  }
  else{
    Model_STOCH_PFE$Capital_PFE[i]=Model_STOCH_PFE$Capital_PFE[i-1]
    Model_STOCH_PFE$StocksHeld[i]=Model_STOCH_PFE$StocksHeld[i-1]
  }
}

if(Model_STOCH_PFE$StocksHeld[length(Model_STOCH_PFE$Action)-1]>0){
    Model_STOCH_PFE$Capital_PFE[length(Model_STOCH_PFE$Action)]=(Model_STOCH_PFE$StocksHeld[length(Model_STOCH_PFE$Action)-1]*Model_STOCH_PFE$close_PFE[length(Model_STOCH_PFE$Action)])
    Model_STOCH_PFE$Action[length(Model_STOCH_PFE$Action)]="sell"
    Model_STOCH_PFE$StocksHeld[length(Model_STOCH_PFE$Action)]=0  
}else{
  Model_STOCH_PFE$Capital_PFE[length(Model_STOCH_PFE$Action)]=Model_STOCH_PFE$Capital_PFE[length(Model_STOCH_PFE$Action)-1]
}




(returns_STOCH_PFE <- (Model_STOCH_PFE$Capital_PFE[length(Model_STOCH_PFE$Action)]/Initial_Capital-1)*100)
(returns_PFE_hold <- (Model_STOCH_PFE$close_PFE[length(Model_STOCH_PFE$Action)]/Model_STOCH_PFE$close_PFE[1]-1)*100)


##PAYX Using STOCH

STOCH_Tbl <- PAYX_STOCH
Price_Tbl <- PAYX_Price


Model_STOCH_PAYX <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_PAYX > Upper_STOCH, "sell", ifelse(SlowD_PAYX < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_PAYX = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_PAYX", "Action", "Capital_PAYX", "StocksHeld", "close_PAYX") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_STOCH_PAYX$Action)-1)){
  prev=(Model_STOCH_PAYX$Action[i-1])
  curr=(Model_STOCH_PAYX$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_PAYX$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_PAYX$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_PAYX$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_PAYX$Action[i]="none"
  }
}


if(Model_STOCH_PAYX$Action[1]=="buy"){
    Model_STOCH_PAYX$StocksHeld[1]=(Model_STOCH_PAYX$Capital_PAYX[1]/Model_STOCH_PAYX$close_PAYX[1])
    Model_STOCH_PAYX$Capital_PAYX[1]=0
}


for(i in 2:(length(Model_STOCH_PAYX$Action)-1)){
  prev=(Model_STOCH_PAYX$Action[i-1])
  curr=(Model_STOCH_PAYX$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_PAYX$StocksHeld[i]=(Model_STOCH_PAYX$Capital_PAYX[i-1]/Model_STOCH_PAYX$close_PAYX[i])
    Model_STOCH_PAYX$Capital_PAYX[i]=0
  }else if(curr=="sell"){
    Model_STOCH_PAYX$Capital_PAYX[i]=(Model_STOCH_PAYX$StocksHeld[i-1]*Model_STOCH_PAYX$close_PAYX[i])
    Model_STOCH_PAYX$StocksHeld[i]=0
  }
  else{
    Model_STOCH_PAYX$Capital_PAYX[i]=Model_STOCH_PAYX$Capital_PAYX[i-1]
    Model_STOCH_PAYX$StocksHeld[i]=Model_STOCH_PAYX$StocksHeld[i-1]
  }
}

if(Model_STOCH_PAYX$StocksHeld[length(Model_STOCH_PAYX$Action)-1]>0){
    Model_STOCH_PAYX$Capital_PAYX[length(Model_STOCH_PAYX$Action)]=(Model_STOCH_PAYX$StocksHeld[length(Model_STOCH_PAYX$Action)-1]*Model_STOCH_PAYX$close_PAYX[length(Model_STOCH_PAYX$Action)])
    Model_STOCH_PAYX$Action[length(Model_STOCH_PAYX$Action)]="sell"
    Model_STOCH_PAYX$StocksHeld[length(Model_STOCH_PAYX$Action)]=0  
}else{
  Model_STOCH_PAYX$Capital_PAYX[length(Model_STOCH_PAYX$Action)]=Model_STOCH_PAYX$Capital_PAYX[length(Model_STOCH_PAYX$Action)-1]
}




(returns_STOCH_PAYX <- (Model_STOCH_PAYX$Capital_PAYX[length(Model_STOCH_PAYX$Action)]/Initial_Capital-1)*100)
(returns_PAYX_hold <- (Model_STOCH_PAYX$close_PAYX[length(Model_STOCH_PAYX$Action)]/Model_STOCH_PAYX$close_PAYX[1]-1)*100)


##RDS.A Using STOCH

STOCH_Tbl <- RDS.A_STOCH
Price_Tbl <- RDS.A_Price


Model_STOCH_RDS.A <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_RDS.A > Upper_STOCH, "sell", ifelse(SlowD_RDS.A < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_RDS.A = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_RDS.A", "Action", "Capital_RDS.A", "StocksHeld", "close_RDS.A") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_STOCH_RDS.A$Action)-1)){
  prev=(Model_STOCH_RDS.A$Action[i-1])
  curr=(Model_STOCH_RDS.A$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_RDS.A$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_RDS.A$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_RDS.A$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_RDS.A$Action[i]="none"
  }
}


if(Model_STOCH_RDS.A$Action[1]=="buy"){
    Model_STOCH_RDS.A$StocksHeld[1]=(Model_STOCH_RDS.A$Capital_RDS.A[1]/Model_STOCH_RDS.A$close_RDS.A[1])
    Model_STOCH_RDS.A$Capital_RDS.A[1]=0
}


for(i in 2:(length(Model_STOCH_RDS.A$Action)-1)){
  prev=(Model_STOCH_RDS.A$Action[i-1])
  curr=(Model_STOCH_RDS.A$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_RDS.A$StocksHeld[i]=(Model_STOCH_RDS.A$Capital_RDS.A[i-1]/Model_STOCH_RDS.A$close_RDS.A[i])
    Model_STOCH_RDS.A$Capital_RDS.A[i]=0
  }else if(curr=="sell"){
    Model_STOCH_RDS.A$Capital_RDS.A[i]=(Model_STOCH_RDS.A$StocksHeld[i-1]*Model_STOCH_RDS.A$close_RDS.A[i])
    Model_STOCH_RDS.A$StocksHeld[i]=0
  }
  else{
    Model_STOCH_RDS.A$Capital_RDS.A[i]=Model_STOCH_RDS.A$Capital_RDS.A[i-1]
    Model_STOCH_RDS.A$StocksHeld[i]=Model_STOCH_RDS.A$StocksHeld[i-1]
  }
}

if(Model_STOCH_RDS.A$StocksHeld[length(Model_STOCH_RDS.A$Action)-1]>0){
    Model_STOCH_RDS.A$Capital_RDS.A[length(Model_STOCH_RDS.A$Action)]=(Model_STOCH_RDS.A$StocksHeld[length(Model_STOCH_RDS.A$Action)-1]*Model_STOCH_RDS.A$close_RDS.A[length(Model_STOCH_RDS.A$Action)])
    Model_STOCH_RDS.A$Action[length(Model_STOCH_RDS.A$Action)]="sell"
    Model_STOCH_RDS.A$StocksHeld[length(Model_STOCH_RDS.A$Action)]=0  
}else{
  Model_STOCH_RDS.A$Capital_RDS.A[length(Model_STOCH_RDS.A$Action)]=Model_STOCH_RDS.A$Capital_RDS.A[length(Model_STOCH_RDS.A$Action)-1]
}




(returns_STOCH_RDS.A <- (Model_STOCH_RDS.A$Capital_RDS.A[length(Model_STOCH_RDS.A$Action)]/Initial_Capital-1)*100)
(returns_RDS.A_hold <- (Model_STOCH_RDS.A$close_RDS.A[length(Model_STOCH_RDS.A$Action)]/Model_STOCH_RDS.A$close_RDS.A[1]-1)*100)


##WFC Using STOCH

STOCH_Tbl <- WFC_STOCH
Price_Tbl <- WFC_Price


Model_STOCH_WFC <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_WFC > Upper_STOCH, "sell", ifelse(SlowD_WFC < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_WFC = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_WFC", "Action", "Capital_WFC", "StocksHeld", "close_WFC") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27") %>%
  filter(time > "2013-11-25")


for(i in 2:(length(Model_STOCH_WFC$Action)-1)){
  prev=(Model_STOCH_WFC$Action[i-1])
  curr=(Model_STOCH_WFC$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_WFC$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_WFC$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_WFC$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_WFC$Action[i]="none"
  }
}


if(Model_STOCH_WFC$Action[1]=="buy"){
    Model_STOCH_WFC$StocksHeld[1]=(Model_STOCH_WFC$Capital_WFC[1]/Model_STOCH_WFC$close_WFC[1])
    Model_STOCH_WFC$Capital_WFC[1]=0
}


for(i in 2:(length(Model_STOCH_WFC$Action)-1)){
  prev=(Model_STOCH_WFC$Action[i-1])
  curr=(Model_STOCH_WFC$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_WFC$StocksHeld[i]=(Model_STOCH_WFC$Capital_WFC[i-1]/Model_STOCH_WFC$close_WFC[i])
    Model_STOCH_WFC$Capital_WFC[i]=0
  }else if(curr=="sell"){
    Model_STOCH_WFC$Capital_WFC[i]=(Model_STOCH_WFC$StocksHeld[i-1]*Model_STOCH_WFC$close_WFC[i])
    Model_STOCH_WFC$StocksHeld[i]=0
  }
  else{
    Model_STOCH_WFC$Capital_WFC[i]=Model_STOCH_WFC$Capital_WFC[i-1]
    Model_STOCH_WFC$StocksHeld[i]=Model_STOCH_WFC$StocksHeld[i-1]
  }
}

if(Model_STOCH_WFC$StocksHeld[length(Model_STOCH_WFC$Action)-1]>0){
    Model_STOCH_WFC$Capital_WFC[length(Model_STOCH_WFC$Action)]=(Model_STOCH_WFC$StocksHeld[length(Model_STOCH_WFC$Action)-1]*Model_STOCH_WFC$close_WFC[length(Model_STOCH_WFC$Action)])
    Model_STOCH_WFC$Action[length(Model_STOCH_WFC$Action)]="sell"
    Model_STOCH_WFC$StocksHeld[length(Model_STOCH_WFC$Action)]=0  
}else{
  Model_STOCH_WFC$Capital_WFC[length(Model_STOCH_WFC$Action)]=Model_STOCH_WFC$Capital_WFC[length(Model_STOCH_WFC$Action)-1]
}


(returns_STOCH_WFC <- (Model_STOCH_WFC$Capital_WFC[length(Model_STOCH_WFC$Action)]/Initial_Capital-1)*100)
(returns_WFC_hold <- (Model_STOCH_WFC$close_WFC[length(Model_STOCH_WFC$Action)]/Model_STOCH_WFC$close_WFC[1]-1)*100)



STOCH_mean_returns_Fidelity <- mean(returns_STOCH_CMCSA+returns_STOCH_CVX+returns_STOCH_GE+returns_STOCH_JNJ+returns_STOCH_JPM+returns_STOCH_MRK+returns_STOCH_PFE+returns_STOCH_PAYX+returns_STOCH_RDS.A+returns_STOCH_WFC)


c(STOCH_mean_returns_Fidelity, Upper_STOCH, Lower_STOCH)

}
```

  
```{r eval=FALSE}
#input radius 
radius_input <- 20
#number of recursions
recursions <- 3
max_upper_stoch = 80
max_lower_stoch = 40

param_j <- 2*radius_input
stoch_data<-matrix(rep(0, 300),ncol=3)

for(i in 1:recursions){
  
  for(j in 1:param_j){
    output<-STOCH_model_Fidelity(1000, max_upper_stoch, (max_lower_stoch+j)-(radius_input))
    stoch_data[j,]<-output
  }
  max_lower_stoch=stoch_data[which.max(stoch_data[,1]),3]
    
  for(j in 1:param_j){
    output<-STOCH_model_Fidelity(1000, (max_upper_stoch+j)-(radius_input), max_lower_stoch)
    stoch_data[j,]<-output
  }
  max_upper_stoch=stoch_data[which.max(stoch_data[,1]),2]
}
max_lower_stoch
max_upper_stoch
stoch_data

stoch_opt <- as.data.frame(stoch_data)
stoch_opt <- stoch_opt[apply(stoch_opt!=0, 1, all),]
colnames(stoch_opt) <- c("Mean STOCH Returns","Upper Bound STOCH","Lower Bound STOCH") 
stoch_opt

ggplot(stoch_opt, aes(x=`Upper Bound STOCH`)) +
  geom_line(aes(y=`Mean STOCH Returns`)) +
  ggtitle("With Lower Bound Fixed at 24 (After 3rd Iteration)")
```


#RSI, Fidelity Portfolio

```{r}
Initial_Capital <- 1000
Upper_RSI <- 70
Lower_RSI <- 30

RSI_model_Fidelity <-function(Initial_Capital, Upper_RSI, Lower_RSI){
  
 
RSI_Tbl <- CMCSA_RSI
Price_Tbl <- CMCSA_Price



Model_RSI_CMCSA <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_CMCSA > Upper_RSI, "sell", ifelse(RSI_CMCSA < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_CMCSA = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_CMCSA", "Action", "Capital_CMCSA", "StocksHeld", "close_CMCSA") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_RSI_CMCSA$Action)-1)){
  prev=(Model_RSI_CMCSA$Action[i-1])
  curr=(Model_RSI_CMCSA$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_CMCSA$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_CMCSA$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_CMCSA$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_CMCSA$Action[i]="none"
  }

if(Model_RSI_CMCSA$Action[1]=="buy"){
    Model_RSI_CMCSA$StocksHeld[1]=(Model_RSI_CMCSA$Capital_CMCSA[1]/Model_RSI_CMCSA$close_CMCSA[1])
    Model_RSI_CMCSA$Capital_CMCSA[1]=0
}}


for(i in 2:(length(Model_RSI_CMCSA$Action)-1)){
  prev=(Model_RSI_CMCSA$Action[i-1])
  curr=(Model_RSI_CMCSA$Action[i])
  
  if(curr=="buy"){
    Model_RSI_CMCSA$StocksHeld[i]=(Model_RSI_CMCSA$Capital_CMCSA[i-1]/Model_RSI_CMCSA$close_CMCSA[i])
    Model_RSI_CMCSA$Capital_CMCSA[i]=0
  }else if(curr=="sell"){
    Model_RSI_CMCSA$Capital_CMCSA[i]=(Model_RSI_CMCSA$StocksHeld[i-1]*Model_RSI_CMCSA$close_CMCSA[i])
    Model_RSI_CMCSA$StocksHeld[i]=0
  }
  else{
    Model_RSI_CMCSA$Capital_CMCSA[i]=Model_RSI_CMCSA$Capital_CMCSA[i-1]
    Model_RSI_CMCSA$StocksHeld[i]=Model_RSI_CMCSA$StocksHeld[i-1]
  }

if(Model_RSI_CMCSA$StocksHeld[length(Model_RSI_CMCSA$Action)-1]>0){
    Model_RSI_CMCSA$Capital_CMCSA[length(Model_RSI_CMCSA$Action)]=(Model_RSI_CMCSA$StocksHeld[length(Model_RSI_CMCSA$Action)-1]*Model_RSI_CMCSA$close_CMCSA[length(Model_RSI_CMCSA$Action)])
    Model_RSI_CMCSA$Action[length(Model_RSI_CMCSA$Action)]="sell"
    Model_RSI_CMCSA$StocksHeld[length(Model_RSI_CMCSA$Action)]=0  
}else{
  Model_RSI_CMCSA$Capital_CMCSA[length(Model_RSI_CMCSA$Action)]=Model_RSI_CMCSA$Capital_CMCSA[length(Model_RSI_CMCSA$Action)-1]
}}




(returns_RSI_CMCSA <- (Model_RSI_CMCSA$Capital_CMCSA[length(Model_RSI_CMCSA$Action)]/Initial_Capital-1)*100)
(returns_CMCSA_hold <- (Model_RSI_CMCSA$close_CMCSA[length(Model_RSI_CMCSA$Action)]/Model_RSI_CMCSA$close_CMCSA[1]-1)*100)


##CVX Using RSI

RSI_Tbl <- CVX_RSI
Price_Tbl <- CVX_Price


Model_RSI_CVX <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_CVX > Upper_RSI, "sell", ifelse(RSI_CVX < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_CVX = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_CVX", "Action", "Capital_CVX", "StocksHeld", "close_CVX") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_RSI_CVX$Action)-1)){
  prev=(Model_RSI_CVX$Action[i-1])
  curr=(Model_RSI_CVX$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_CVX$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_CVX$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_CVX$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_CVX$Action[i]="none"
  }
}


if(Model_RSI_CVX$Action[1]=="buy"){
    Model_RSI_CVX$StocksHeld[1]=(Model_RSI_CVX$Capital_CVX[1]/Model_RSI_CVX$close_CVX[1])
    Model_RSI_CVX$Capital_CVX[1]=0
}


for(i in 2:(length(Model_RSI_CVX$Action)-1)){
  prev=(Model_RSI_CVX$Action[i-1])
  curr=(Model_RSI_CVX$Action[i])
  
  if(curr=="buy"){
    Model_RSI_CVX$StocksHeld[i]=(Model_RSI_CVX$Capital_CVX[i-1]/Model_RSI_CVX$close_CVX[i])
    Model_RSI_CVX$Capital_CVX[i]=0
  }else if(curr=="sell"){
    Model_RSI_CVX$Capital_CVX[i]=(Model_RSI_CVX$StocksHeld[i-1]*Model_RSI_CVX$close_CVX[i])
    Model_RSI_CVX$StocksHeld[i]=0
  }
  else{
    Model_RSI_CVX$Capital_CVX[i]=Model_RSI_CVX$Capital_CVX[i-1]
    Model_RSI_CVX$StocksHeld[i]=Model_RSI_CVX$StocksHeld[i-1]
  }
}

if(Model_RSI_CVX$StocksHeld[length(Model_RSI_CVX$Action)-1]>0){
    Model_RSI_CVX$Capital_CVX[length(Model_RSI_CVX$Action)]=(Model_RSI_CVX$StocksHeld[length(Model_RSI_CVX$Action)-1]*Model_RSI_CVX$close_CVX[length(Model_RSI_CVX$Action)])
    Model_RSI_CVX$Action[length(Model_RSI_CVX$Action)]="sell"
    Model_RSI_CVX$StocksHeld[length(Model_RSI_CVX$Action)]=0  
}else{
  Model_RSI_CVX$Capital_CVX[length(Model_RSI_CVX$Action)]=Model_RSI_CVX$Capital_CVX[length(Model_RSI_CVX$Action)-1]
}




(returns_RSI_CVX <- (Model_RSI_CVX$Capital_CVX[length(Model_RSI_CVX$Action)]/Initial_Capital-1)*100)
(returns_CVX_hold <- (Model_RSI_CVX$close_CVX[length(Model_RSI_CVX$Action)]/Model_RSI_CVX$close_CVX[1]-1)*100)



##GE Using RSI

RSI_Tbl <- GE_RSI
Price_Tbl <- GE_Price


Model_RSI_GE <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_GE > Upper_RSI, "sell", ifelse(RSI_GE < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_GE = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_GE", "Action", "Capital_GE", "StocksHeld", "close_GE") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_RSI_GE$Action)-1)){
  prev=(Model_RSI_GE$Action[i-1])
  curr=(Model_RSI_GE$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_GE$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_GE$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_GE$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_GE$Action[i]="none"
  }
}


if(Model_RSI_GE$Action[1]=="buy"){
    Model_RSI_GE$StocksHeld[1]=(Model_RSI_GE$Capital_GE[1]/Model_RSI_GE$close_GE[1])
    Model_RSI_GE$Capital_GE[1]=0
}


for(i in 2:(length(Model_RSI_GE$Action)-1)){
  prev=(Model_RSI_GE$Action[i-1])
  curr=(Model_RSI_GE$Action[i])
  
  if(curr=="buy"){
    Model_RSI_GE$StocksHeld[i]=(Model_RSI_GE$Capital_GE[i-1]/Model_RSI_GE$close_GE[i])
    Model_RSI_GE$Capital_GE[i]=0
  }else if(curr=="sell"){
    Model_RSI_GE$Capital_GE[i]=(Model_RSI_GE$StocksHeld[i-1]*Model_RSI_GE$close_GE[i])
    Model_RSI_GE$StocksHeld[i]=0
  }
  else{
    Model_RSI_GE$Capital_GE[i]=Model_RSI_GE$Capital_GE[i-1]
    Model_RSI_GE$StocksHeld[i]=Model_RSI_GE$StocksHeld[i-1]
  }
}

if(Model_RSI_GE$StocksHeld[length(Model_RSI_GE$Action)-1]>0){
    Model_RSI_GE$Capital_GE[length(Model_RSI_GE$Action)]=(Model_RSI_GE$StocksHeld[length(Model_RSI_GE$Action)-1]*Model_RSI_GE$close_GE[length(Model_RSI_GE$Action)])
    Model_RSI_GE$Action[length(Model_RSI_GE$Action)]="sell"
    Model_RSI_GE$StocksHeld[length(Model_RSI_GE$Action)]=0  
}else{
  Model_RSI_GE$Capital_GE[length(Model_RSI_GE$Action)]=Model_RSI_GE$Capital_GE[length(Model_RSI_GE$Action)-1]
}




(returns_RSI_GE <- (Model_RSI_GE$Capital_GE[length(Model_RSI_GE$Action)]/Initial_Capital-1)*100)
(returns_GE_hold <- (Model_RSI_GE$close_GE[length(Model_RSI_GE$Action)]/Model_RSI_GE$close_GE[1]-1)*100)


##JNJ Using RSI

RSI_Tbl <- JNJ_RSI
Price_Tbl <- JNJ_Price


Model_RSI_JNJ <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_JNJ > Upper_RSI, "sell", ifelse(RSI_JNJ < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_JNJ= Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_JNJ", "Action", "Capital_JNJ", "StocksHeld", "close_JNJ") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_RSI_JNJ$Action)-1)){
  prev=(Model_RSI_JNJ$Action[i-1])
  curr=(Model_RSI_JNJ$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_JNJ$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_JNJ$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_JNJ$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_JNJ$Action[i]="none"
  }
}


if(Model_RSI_JNJ$Action[1]=="buy"){
    Model_RSI_JNJ$StocksHeld[1]=(Model_RSI_JNJ$Capital_JNJ[1]/Model_RSI_JNJ$close_JNJ[1])
    Model_RSI_JNJ$Capital_JNJ[1]=0
}


for(i in 2:(length(Model_RSI_JNJ$Action)-1)){
  prev=(Model_RSI_JNJ$Action[i-1])
  curr=(Model_RSI_JNJ$Action[i])
  
  if(curr=="buy"){
    Model_RSI_JNJ$StocksHeld[i]=(Model_RSI_JNJ$Capital_JNJ[i-1]/Model_RSI_JNJ$close_JNJ[i])
    Model_RSI_JNJ$Capital_JNJ[i]=0
  }else if(curr=="sell"){
    Model_RSI_JNJ$Capital_JNJ[i]=(Model_RSI_JNJ$StocksHeld[i-1]*Model_RSI_JNJ$close_JNJ[i])
    Model_RSI_JNJ$StocksHeld[i]=0
  }
  else{
    Model_RSI_JNJ$Capital_JNJ[i]=Model_RSI_JNJ$Capital_JNJ[i-1]
    Model_RSI_JNJ$StocksHeld[i]=Model_RSI_JNJ$StocksHeld[i-1]
  }
}

if(Model_RSI_JNJ$StocksHeld[length(Model_RSI_JNJ$Action)-1]>0){
    Model_RSI_JNJ$Capital_JNJ[length(Model_RSI_JNJ$Action)]=(Model_RSI_JNJ$StocksHeld[length(Model_RSI_JNJ$Action)-1]*Model_RSI_JNJ$close_JNJ[length(Model_RSI_JNJ$Action)])
    Model_RSI_JNJ$Action[length(Model_RSI_JNJ$Action)]="sell"
    Model_RSI_JNJ$StocksHeld[length(Model_RSI_JNJ$Action)]=0  
}else{
  Model_RSI_JNJ$Capital_JNJ[length(Model_RSI_JNJ$Action)]=Model_RSI_JNJ$Capital_JNJ[length(Model_RSI_JNJ$Action)-1]
}




(returns_RSI_JNJ <- (Model_RSI_JNJ$Capital_JNJ[length(Model_RSI_JNJ$Action)]/Initial_Capital-1)*100)
(returns_JNJ_hold <- (Model_RSI_JNJ$close_JNJ[length(Model_RSI_JNJ$Action)]/Model_RSI_JNJ$close_JNJ[1]-1)*100)


##JPM Using RSI

RSI_Tbl <- JPM_RSI
Price_Tbl <- JPM_Price


Model_RSI_JPM <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_JPM > Upper_RSI, "sell", ifelse(RSI_JPM < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_JPM = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_JPM", "Action", "Capital_JPM", "StocksHeld", "close_JPM") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27") 


for(i in 2:(length(Model_RSI_JPM$Action)-1)){
  prev=(Model_RSI_JPM$Action[i-1])
  curr=(Model_RSI_JPM$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_JPM$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_JPM$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_JPM$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_JPM$Action[i]="none"
  }
}


if(Model_RSI_JPM$Action[1]=="buy"){
    Model_RSI_JPM$StocksHeld[1]=(Model_RSI_JPM$Capital_JPM[1]/Model_RSI_JPM$close_JPM[1])
    Model_RSI_JPM$Capital_JPM[1]=0
}


for(i in 2:(length(Model_RSI_JPM$Action)-1)){
  prev=(Model_RSI_JPM$Action[i-1])
  curr=(Model_RSI_JPM$Action[i])
  
  if(curr=="buy"){
    Model_RSI_JPM$StocksHeld[i]=(Model_RSI_JPM$Capital_JPM[i-1]/Model_RSI_JPM$close_JPM[i])
    Model_RSI_JPM$Capital_JPM[i]=0
  }else if(curr=="sell"){
    Model_RSI_JPM$Capital_JPM[i]=(Model_RSI_JPM$StocksHeld[i-1]*Model_RSI_JPM$close_JPM[i])
    Model_RSI_JPM$StocksHeld[i]=0
  }
  else{
    Model_RSI_JPM$Capital_JPM[i]=Model_RSI_JPM$Capital_JPM[i-1]
    Model_RSI_JPM$StocksHeld[i]=Model_RSI_JPM$StocksHeld[i-1]
  }
}

if(Model_RSI_JPM$StocksHeld[length(Model_RSI_JPM$Action)-1]>0){
    Model_RSI_JPM$Capital_JPM[length(Model_RSI_JPM$Action)]=(Model_RSI_JPM$StocksHeld[length(Model_RSI_JPM$Action)-1]*Model_RSI_JPM$close_JPM[length(Model_RSI_JPM$Action)])
    Model_RSI_JPM$Action[length(Model_RSI_JPM$Action)]="sell"
    Model_RSI_JPM$StocksHeld[length(Model_RSI_JPM$Action)]=0  
}else{
  Model_RSI_JPM$Capital_JPM[length(Model_RSI_JPM$Action)]=Model_RSI_JPM$Capital_JPM[length(Model_RSI_JPM$Action)-1]
}




(returns_RSI_JPM <- (Model_RSI_JPM$Capital_JPM[length(Model_RSI_JPM$Action)]/Initial_Capital-1)*100)
(returns_JPM_hold <- (Model_RSI_JPM$close_JPM[length(Model_RSI_JPM$Action)]/Model_RSI_JPM$close_JPM[1]-1)*100)


##MRK Using RSI

RSI_Tbl <- MRK_RSI
Price_Tbl <- MRK_Price


Model_RSI_MRK <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_MRK > Upper_RSI, "sell", ifelse(RSI_MRK < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_MRK = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_MRK", "Action", "Capital_MRK", "StocksHeld", "close_MRK") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_RSI_MRK$Action)-1)){
  prev=(Model_RSI_MRK$Action[i-1])
  curr=(Model_RSI_MRK$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_MRK$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_MRK$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_MRK$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_MRK$Action[i]="none"
  }
}


if(Model_RSI_MRK$Action[1]=="buy"){
    Model_RSI_MRK$StocksHeld[1]=(Model_RSI_MRK$Capital_MRK[1]/Model_RSI_MRK$close_MRK[1])
    Model_RSI_MRK$Capital_MRK[1]=0
}


for(i in 2:(length(Model_RSI_MRK$Action)-1)){
  prev=(Model_RSI_MRK$Action[i-1])
  curr=(Model_RSI_MRK$Action[i])
  
  if(curr=="buy"){
    Model_RSI_MRK$StocksHeld[i]=(Model_RSI_MRK$Capital_MRK[i-1]/Model_RSI_MRK$close_MRK[i])
    Model_RSI_MRK$Capital_MRK[i]=0
  }else if(curr=="sell"){
    Model_RSI_MRK$Capital_MRK[i]=(Model_RSI_MRK$StocksHeld[i-1]*Model_RSI_MRK$close_MRK[i])
    Model_RSI_MRK$StocksHeld[i]=0
  }
  else{
    Model_RSI_MRK$Capital_MRK[i]=Model_RSI_MRK$Capital_MRK[i-1]
    Model_RSI_MRK$StocksHeld[i]=Model_RSI_MRK$StocksHeld[i-1]
  }
}

if(Model_RSI_MRK$StocksHeld[length(Model_RSI_MRK$Action)-1]>0){
    Model_RSI_MRK$Capital_MRK[length(Model_RSI_MRK$Action)]=(Model_RSI_MRK$StocksHeld[length(Model_RSI_MRK$Action)-1]*Model_RSI_MRK$close_MRK[length(Model_RSI_MRK$Action)])
    Model_RSI_MRK$Action[length(Model_RSI_MRK$Action)]="sell"
    Model_RSI_MRK$StocksHeld[length(Model_RSI_MRK$Action)]=0  
  }else{
  Model_RSI_MRK$Capital_MRK[length(Model_RSI_MRK$Action)]=Model_RSI_MRK$Capital_MRK[length(Model_RSI_MRK$Action)-1]
}
  




(returns_RSI_MRK <- (Model_RSI_MRK$Capital_MRK[length(Model_RSI_MRK$Action)]/Initial_Capital-1)*100)
(returns_MRK_hold <- (Model_RSI_MRK$close_MRK[length(Model_RSI_MRK$Action)]/Model_RSI_MRK$close_MRK[1]-1)*100)


##PFE Using RSI

RSI_Tbl <- PFE_RSI
Price_Tbl <- PFE_Price


Model_RSI_PFE <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_PFE > Upper_RSI, "sell", ifelse(RSI_PFE < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_PFE = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_PFE", "Action", "Capital_PFE", "StocksHeld", "close_PFE") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_RSI_PFE$Action)-1)){
  prev=(Model_RSI_PFE$Action[i-1])
  curr=(Model_RSI_PFE$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_PFE$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_PFE$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_PFE$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_PFE$Action[i]="none"
  }
}


if(Model_RSI_PFE$Action[1]=="buy"){
    Model_RSI_PFE$StocksHeld[1]=(Model_RSI_PFE$Capital_PFE[1]/Model_RSI_PFE$close_PFE[1])
    Model_RSI_PFE$Capital_PFE[1]=0
}


for(i in 2:(length(Model_RSI_PFE$Action)-1)){
  prev=(Model_RSI_PFE$Action[i-1])
  curr=(Model_RSI_PFE$Action[i])
  
  if(curr=="buy"){
    Model_RSI_PFE$StocksHeld[i]=(Model_RSI_PFE$Capital_PFE[i-1]/Model_RSI_PFE$close_PFE[i])
    Model_RSI_PFE$Capital_PFE[i]=0
  }else if(curr=="sell"){
    Model_RSI_PFE$Capital_PFE[i]=(Model_RSI_PFE$StocksHeld[i-1]*Model_RSI_PFE$close_PFE[i])
    Model_RSI_PFE$StocksHeld[i]=0
  }
  else{
    Model_RSI_PFE$Capital_PFE[i]=Model_RSI_PFE$Capital_PFE[i-1]
    Model_RSI_PFE$StocksHeld[i]=Model_RSI_PFE$StocksHeld[i-1]
  }
}

if(Model_RSI_PFE$StocksHeld[length(Model_RSI_PFE$Action)-1]>0){
    Model_RSI_PFE$Capital_PFE[length(Model_RSI_PFE$Action)]=(Model_RSI_PFE$StocksHeld[length(Model_RSI_PFE$Action)-1]*Model_RSI_PFE$close_PFE[length(Model_RSI_PFE$Action)])
    Model_RSI_PFE$Action[length(Model_RSI_PFE$Action)]="sell"
    Model_RSI_PFE$StocksHeld[length(Model_RSI_PFE$Action)]=0  
}else{
  Model_RSI_PFE$Capital_PFE[length(Model_RSI_PFE$Action)]=Model_RSI_PFE$Capital_PFE[length(Model_RSI_PFE$Action)-1]
}




(returns_RSI_PFE <- (Model_RSI_PFE$Capital_PFE[length(Model_RSI_PFE$Action)]/Initial_Capital-1)*100)
(returns_PFE_hold <- (Model_RSI_PFE$close_PFE[length(Model_RSI_PFE$Action)]/Model_RSI_PFE$close_PFE[1]-1)*100)


##PAYX Using RSI

RSI_Tbl <- PAYX_RSI
Price_Tbl <- PAYX_Price


Model_RSI_PAYX <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_PAYX > Upper_RSI, "sell", ifelse(RSI_PAYX < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_PAYX = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_PAYX", "Action", "Capital_PAYX", "StocksHeld", "close_PAYX") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_RSI_PAYX$Action)-1)){
  prev=(Model_RSI_PAYX$Action[i-1])
  curr=(Model_RSI_PAYX$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_PAYX$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_PAYX$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_PAYX$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_PAYX$Action[i]="none"
  }
}


if(Model_RSI_PAYX$Action[1]=="buy"){
    Model_RSI_PAYX$StocksHeld[1]=(Model_RSI_PAYX$Capital_PAYX[1]/Model_RSI_PAYX$close_PAYX[1])
    Model_RSI_PAYX$Capital_PAYX[1]=0
}


for(i in 2:(length(Model_RSI_PAYX$Action)-1)){
  prev=(Model_RSI_PAYX$Action[i-1])
  curr=(Model_RSI_PAYX$Action[i])
  
  if(curr=="buy"){
    Model_RSI_PAYX$StocksHeld[i]=(Model_RSI_PAYX$Capital_PAYX[i-1]/Model_RSI_PAYX$close_PAYX[i])
    Model_RSI_PAYX$Capital_PAYX[i]=0
  }else if(curr=="sell"){
    Model_RSI_PAYX$Capital_PAYX[i]=(Model_RSI_PAYX$StocksHeld[i-1]*Model_RSI_PAYX$close_PAYX[i])
    Model_RSI_PAYX$StocksHeld[i]=0
  }
  else{
    Model_RSI_PAYX$Capital_PAYX[i]=Model_RSI_PAYX$Capital_PAYX[i-1]
    Model_RSI_PAYX$StocksHeld[i]=Model_RSI_PAYX$StocksHeld[i-1]
  }
}

if(Model_RSI_PAYX$StocksHeld[length(Model_RSI_PAYX$Action)-1]>0){
    Model_RSI_PAYX$Capital_PAYX[length(Model_RSI_PAYX$Action)]=(Model_RSI_PAYX$StocksHeld[length(Model_RSI_PAYX$Action)-1]*Model_RSI_PAYX$close_PAYX[length(Model_RSI_PAYX$Action)])
    Model_RSI_PAYX$Action[length(Model_RSI_PAYX$Action)]="sell"
    Model_RSI_PAYX$StocksHeld[length(Model_RSI_PAYX$Action)]=0  
}else{
  Model_RSI_PAYX$Capital_PAYX[length(Model_RSI_PAYX$Action)]=Model_RSI_PAYX$Capital_PAYX[length(Model_RSI_PAYX$Action)-1]
}




(returns_RSI_PAYX <- (Model_RSI_PAYX$Capital_PAYX[length(Model_RSI_PAYX$Action)]/Initial_Capital-1)*100)
(returns_PAYX_hold <- (Model_RSI_PAYX$close_PAYX[length(Model_RSI_PAYX$Action)]/Model_RSI_PAYX$close_PAYX[1]-1)*100)


##RDS.A Using RSI

RSI_Tbl <- RDS.A_RSI
Price_Tbl <- RDS.A_Price


Model_RSI_RDS.A <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_RDS.A > Upper_RSI, "sell", ifelse(RSI_RDS.A < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_RDS.A = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_RDS.A", "Action", "Capital_RDS.A", "StocksHeld", "close_RDS.A") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_RSI_RDS.A$Action)-1)){
  prev=(Model_RSI_RDS.A$Action[i-1])
  curr=(Model_RSI_RDS.A$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_RDS.A$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_RDS.A$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_RDS.A$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_RDS.A$Action[i]="none"
  }
}


if(Model_RSI_RDS.A$Action[1]=="buy"){
    Model_RSI_RDS.A$StocksHeld[1]=(Model_RSI_RDS.A$Capital_RDS.A[1]/Model_RSI_RDS.A$close_RDS.A[1])
    Model_RSI_RDS.A$Capital_RDS.A[1]=0
}


for(i in 2:(length(Model_RSI_RDS.A$Action)-1)){
  prev=(Model_RSI_RDS.A$Action[i-1])
  curr=(Model_RSI_RDS.A$Action[i])
  
  if(curr=="buy"){
    Model_RSI_RDS.A$StocksHeld[i]=(Model_RSI_RDS.A$Capital_RDS.A[i-1]/Model_RSI_RDS.A$close_RDS.A[i])
    Model_RSI_RDS.A$Capital_RDS.A[i]=0
  }else if(curr=="sell"){
    Model_RSI_RDS.A$Capital_RDS.A[i]=(Model_RSI_RDS.A$StocksHeld[i-1]*Model_RSI_RDS.A$close_RDS.A[i])
    Model_RSI_RDS.A$StocksHeld[i]=0
  }
  else{
    Model_RSI_RDS.A$Capital_RDS.A[i]=Model_RSI_RDS.A$Capital_RDS.A[i-1]
    Model_RSI_RDS.A$StocksHeld[i]=Model_RSI_RDS.A$StocksHeld[i-1]
  }
}

if(Model_RSI_RDS.A$StocksHeld[length(Model_RSI_RDS.A$Action)-1]>0){
    Model_RSI_RDS.A$Capital_RDS.A[length(Model_RSI_RDS.A$Action)]=(Model_RSI_RDS.A$StocksHeld[length(Model_RSI_RDS.A$Action)-1]*Model_RSI_RDS.A$close_RDS.A[length(Model_RSI_RDS.A$Action)])
    Model_RSI_RDS.A$Action[length(Model_RSI_RDS.A$Action)]="sell"
    Model_RSI_RDS.A$StocksHeld[length(Model_RSI_RDS.A$Action)]=0  
}else{
  Model_RSI_RDS.A$Capital_RDS.A[length(Model_RSI_RDS.A$Action)]=Model_RSI_RDS.A$Capital_RDS.A[length(Model_RSI_RDS.A$Action)-1]
}




(returns_RSI_RDS.A <- (Model_RSI_RDS.A$Capital_RDS.A[length(Model_RSI_RDS.A$Action)]/Initial_Capital-1)*100)
(returns_RDS.A_hold <- (Model_RSI_RDS.A$close_RDS.A[length(Model_RSI_RDS.A$Action)]/Model_RSI_RDS.A$close_RDS.A[1]-1)*100)


##WFC Using RSI

RSI_Tbl <- WFC_RSI
Price_Tbl <- WFC_Price


Model_RSI_WFC <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_WFC > Upper_RSI, "sell", ifelse(RSI_WFC < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_WFC = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_WFC", "Action", "Capital_WFC", "StocksHeld", "close_WFC") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27") %>%
  filter(time > "2013-11-25")


for(i in 2:(length(Model_RSI_WFC$Action)-1)){
  prev=(Model_RSI_WFC$Action[i-1])
  curr=(Model_RSI_WFC$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_WFC$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_WFC$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_WFC$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_WFC$Action[i]="none"
  }
}


if(Model_RSI_WFC$Action[1]=="buy"){
    Model_RSI_WFC$StocksHeld[1]=(Model_RSI_WFC$Capital_WFC[1]/Model_RSI_WFC$close_WFC[1])
    Model_RSI_WFC$Capital_WFC[1]=0
}


for(i in 2:(length(Model_RSI_WFC$Action)-1)){
  prev=(Model_RSI_WFC$Action[i-1])
  curr=(Model_RSI_WFC$Action[i])
  
  if(curr=="buy"){
    Model_RSI_WFC$StocksHeld[i]=(Model_RSI_WFC$Capital_WFC[i-1]/Model_RSI_WFC$close_WFC[i])
    Model_RSI_WFC$Capital_WFC[i]=0
  }else if(curr=="sell"){
    Model_RSI_WFC$Capital_WFC[i]=(Model_RSI_WFC$StocksHeld[i-1]*Model_RSI_WFC$close_WFC[i])
    Model_RSI_WFC$StocksHeld[i]=0
  }
  else{
    Model_RSI_WFC$Capital_WFC[i]=Model_RSI_WFC$Capital_WFC[i-1]
    Model_RSI_WFC$StocksHeld[i]=Model_RSI_WFC$StocksHeld[i-1]
  }
}

if(Model_RSI_WFC$StocksHeld[length(Model_RSI_WFC$Action)-1]>0){
    Model_RSI_WFC$Capital_WFC[length(Model_RSI_WFC$Action)]=(Model_RSI_WFC$StocksHeld[length(Model_RSI_WFC$Action)-1]*Model_RSI_WFC$close_WFC[length(Model_RSI_WFC$Action)])
    Model_RSI_WFC$Action[length(Model_RSI_WFC$Action)]="sell"
    Model_RSI_WFC$StocksHeld[length(Model_RSI_WFC$Action)]=0  
}else{
  Model_RSI_WFC$Capital_WFC[length(Model_RSI_WFC$Action)]=Model_RSI_WFC$Capital_WFC[length(Model_RSI_WFC$Action)-1]
}


(returns_RSI_WFC <- (Model_RSI_WFC$Capital_WFC[length(Model_RSI_WFC$Action)]/Initial_Capital-1)*100)
(returns_WFC_hold <- (Model_RSI_WFC$close_WFC[length(Model_RSI_WFC$Action)]/Model_RSI_WFC$close_WFC[1]-1)*100)



RSI_mean_returns_Fid <- mean(returns_RSI_CMCSA+returns_RSI_CVX+returns_RSI_GE+returns_RSI_JNJ+returns_RSI_JPM+returns_RSI_MRK+returns_RSI_PFE+returns_RSI_PAYX+returns_RSI_RDS.A+returns_RSI_WFC)


c(RSI_mean_returns_Fid, Upper_RSI, Lower_RSI)

}
```

  
```{r eval=FALSE}
#input radius 
radius_input <- 20
#number of recursions
recursions <- 3
max_upper_RSI = 80
max_lower_RSI = 30

param_j <- 2*radius_input
RSI_data<-matrix(rep(0, 300),ncol=3)

for(i in 1:recursions){
  
  for(j in 1:param_j){
    output<-RSI_model_Fidelity(1000, max_upper_RSI, (max_lower_RSI+j)-(radius_input))
    RSI_data[j,]<-output
  }
  max_lower_RSI=RSI_data[which.max(RSI_data[,1]),3]
    
  for(j in 1:param_j){
    output<-RSI_model_Fidelity(1000, (max_upper_RSI+j)-(radius_input), max_lower_RSI)
    RSI_data[j,]<-output
  }
  max_upper_RSI=RSI_data[which.max(RSI_data[,1]),2]
}
max_lower_RSI
max_upper_RSI
RSI_data

RSI_opt <- as.data.frame(RSI_data)
RSI_opt <- RSI_opt[apply(RSI_opt!=0, 1, all),]
colnames(RSI_opt) <- c("Mean RSI Returns","Upper Bound RSI","Lower Bound RSI") 
RSI_opt
```

#STOCH, Random Portfolio

```{r}
Initial_Capital <- 1000
Upper_STOCH <- 70
Lower_STOCH <- 30

STOCH_model_Random<-function(Initial_Capital, Upper_STOCH, Lower_STOCH){
  
 
STOCH_Tbl <- NANO_STOCH
Price_Tbl <- NANO_Price



Model_STOCH_NANO <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_NANO > Upper_STOCH, "sell", ifelse(SlowD_NANO < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_NANO = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_NANO", "Action", "Capital_NANO", "StocksHeld", "close_NANO") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_STOCH_NANO$Action)-1)){
  prev=(Model_STOCH_NANO$Action[i-1])
  curr=(Model_STOCH_NANO$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_NANO$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_NANO$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_NANO$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_NANO$Action[i]="none"
  }

if(Model_STOCH_NANO$Action[1]=="buy"){
    Model_STOCH_NANO$StocksHeld[1]=(Model_STOCH_NANO$Capital_NANO[1]/Model_STOCH_NANO$close_NANO[1])
    Model_STOCH_NANO$Capital_NANO[1]=0
}}


for(i in 2:(length(Model_STOCH_NANO$Action)-1)){
  prev=(Model_STOCH_NANO$Action[i-1])
  curr=(Model_STOCH_NANO$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_NANO$StocksHeld[i]=(Model_STOCH_NANO$Capital_NANO[i-1]/Model_STOCH_NANO$close_NANO[i])
    Model_STOCH_NANO$Capital_NANO[i]=0
  }else if(curr=="sell"){
    Model_STOCH_NANO$Capital_NANO[i]=(Model_STOCH_NANO$StocksHeld[i-1]*Model_STOCH_NANO$close_NANO[i])
    Model_STOCH_NANO$StocksHeld[i]=0
  }
  else{
    Model_STOCH_NANO$Capital_NANO[i]=Model_STOCH_NANO$Capital_NANO[i-1]
    Model_STOCH_NANO$StocksHeld[i]=Model_STOCH_NANO$StocksHeld[i-1]
  }

if(Model_STOCH_NANO$StocksHeld[length(Model_STOCH_NANO$Action)-1]>0){
    Model_STOCH_NANO$Capital_NANO[length(Model_STOCH_NANO$Action)]=(Model_STOCH_NANO$StocksHeld[length(Model_STOCH_NANO$Action)-1]*Model_STOCH_NANO$close_NANO[length(Model_STOCH_NANO$Action)])
    Model_STOCH_NANO$Action[length(Model_STOCH_NANO$Action)]="sell"
    Model_STOCH_NANO$StocksHeld[length(Model_STOCH_NANO$Action)]=0  
}else{
  Model_STOCH_NANO$Capital_NANO[length(Model_STOCH_NANO$Action)]=Model_STOCH_NANO$Capital_NANO[length(Model_STOCH_NANO$Action)-1]
}}




(returns_STOCH_NANO <- (Model_STOCH_NANO$Capital_NANO[length(Model_STOCH_NANO$Action)]/Initial_Capital-1)*100)
(returns_NANO_hold <- (Model_STOCH_NANO$close_NANO[length(Model_STOCH_NANO$Action)]/Model_STOCH_NANO$close_NANO[1]-1)*100)


##PEZ Using STOCH

STOCH_Tbl <- PEZ_STOCH
Price_Tbl <- PEZ_Price


Model_STOCH_PEZ <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_PEZ > Upper_STOCH, "sell", ifelse(SlowD_PEZ < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_PEZ = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_PEZ", "Action", "Capital_PEZ", "StocksHeld", "close_PEZ") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_STOCH_PEZ$Action)-1)){
  prev=(Model_STOCH_PEZ$Action[i-1])
  curr=(Model_STOCH_PEZ$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_PEZ$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_PEZ$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_PEZ$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_PEZ$Action[i]="none"
  }
}


if(Model_STOCH_PEZ$Action[1]=="buy"){
    Model_STOCH_PEZ$StocksHeld[1]=(Model_STOCH_PEZ$Capital_PEZ[1]/Model_STOCH_PEZ$close_PEZ[1])
    Model_STOCH_PEZ$Capital_PEZ[1]=0
}


for(i in 2:(length(Model_STOCH_PEZ$Action)-1)){
  prev=(Model_STOCH_PEZ$Action[i-1])
  curr=(Model_STOCH_PEZ$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_PEZ$StocksHeld[i]=(Model_STOCH_PEZ$Capital_PEZ[i-1]/Model_STOCH_PEZ$close_PEZ[i])
    Model_STOCH_PEZ$Capital_PEZ[i]=0
  }else if(curr=="sell"){
    Model_STOCH_PEZ$Capital_PEZ[i]=(Model_STOCH_PEZ$StocksHeld[i-1]*Model_STOCH_PEZ$close_PEZ[i])
    Model_STOCH_PEZ$StocksHeld[i]=0
  }
  else{
    Model_STOCH_PEZ$Capital_PEZ[i]=Model_STOCH_PEZ$Capital_PEZ[i-1]
    Model_STOCH_PEZ$StocksHeld[i]=Model_STOCH_PEZ$StocksHeld[i-1]
  }
}

if(Model_STOCH_PEZ$StocksHeld[length(Model_STOCH_PEZ$Action)-1]>0){
    Model_STOCH_PEZ$Capital_PEZ[length(Model_STOCH_PEZ$Action)]=(Model_STOCH_PEZ$StocksHeld[length(Model_STOCH_PEZ$Action)-1]*Model_STOCH_PEZ$close_PEZ[length(Model_STOCH_PEZ$Action)])
    Model_STOCH_PEZ$Action[length(Model_STOCH_PEZ$Action)]="sell"
    Model_STOCH_PEZ$StocksHeld[length(Model_STOCH_PEZ$Action)]=0  
}else{
  Model_STOCH_PEZ$Capital_PEZ[length(Model_STOCH_PEZ$Action)]=Model_STOCH_PEZ$Capital_PEZ[length(Model_STOCH_PEZ$Action)-1]
}




(returns_STOCH_PEZ <- (Model_STOCH_PEZ$Capital_PEZ[length(Model_STOCH_PEZ$Action)]/Initial_Capital-1)*100)
(returns_PEZ_hold <- (Model_STOCH_PEZ$close_PEZ[length(Model_STOCH_PEZ$Action)]/Model_STOCH_PEZ$close_PEZ[1]-1)*100)



##FE Using STOCH

STOCH_Tbl <- FE_STOCH
Price_Tbl <- FE_Price


Model_STOCH_FE <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_FE > Upper_STOCH, "sell", ifelse(SlowD_FE < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_FE = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_FE", "Action", "Capital_FE", "StocksHeld", "close_FE") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_STOCH_FE$Action)-1)){
  prev=(Model_STOCH_FE$Action[i-1])
  curr=(Model_STOCH_FE$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_FE$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_FE$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_FE$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_FE$Action[i]="none"
  }
}


if(Model_STOCH_FE$Action[1]=="buy"){
    Model_STOCH_FE$StocksHeld[1]=(Model_STOCH_FE$Capital_FE[1]/Model_STOCH_FE$close_FE[1])
    Model_STOCH_FE$Capital_FE[1]=0
}


for(i in 2:(length(Model_STOCH_FE$Action)-1)){
  prev=(Model_STOCH_FE$Action[i-1])
  curr=(Model_STOCH_FE$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_FE$StocksHeld[i]=(Model_STOCH_FE$Capital_FE[i-1]/Model_STOCH_FE$close_FE[i])
    Model_STOCH_FE$Capital_FE[i]=0
  }else if(curr=="sell"){
    Model_STOCH_FE$Capital_FE[i]=(Model_STOCH_FE$StocksHeld[i-1]*Model_STOCH_FE$close_FE[i])
    Model_STOCH_FE$StocksHeld[i]=0
  }
  else{
    Model_STOCH_FE$Capital_FE[i]=Model_STOCH_FE$Capital_FE[i-1]
    Model_STOCH_FE$StocksHeld[i]=Model_STOCH_FE$StocksHeld[i-1]
  }
}

if(Model_STOCH_FE$StocksHeld[length(Model_STOCH_FE$Action)-1]>0){
    Model_STOCH_FE$Capital_FE[length(Model_STOCH_FE$Action)]=(Model_STOCH_FE$StocksHeld[length(Model_STOCH_FE$Action)-1]*Model_STOCH_FE$close_FE[length(Model_STOCH_FE$Action)])
    Model_STOCH_FE$Action[length(Model_STOCH_FE$Action)]="sell"
    Model_STOCH_FE$StocksHeld[length(Model_STOCH_FE$Action)]=0  
}else{
  Model_STOCH_FE$Capital_FE[length(Model_STOCH_FE$Action)]=Model_STOCH_FE$Capital_FE[length(Model_STOCH_FE$Action)-1]
}




(returns_STOCH_FE <- (Model_STOCH_FE$Capital_FE[length(Model_STOCH_FE$Action)]/Initial_Capital-1)*100)
(returns_FE_hold <- (Model_STOCH_FE$close_FE[length(Model_STOCH_FE$Action)]/Model_STOCH_FE$close_FE[1]-1)*100)


##TFX Using STOCH

STOCH_Tbl <- TFX_STOCH
Price_Tbl <- TFX_Price


Model_STOCH_TFX <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_TFX > Upper_STOCH, "sell", ifelse(SlowD_TFX < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_TFX= Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_TFX", "Action", "Capital_TFX", "StocksHeld", "close_TFX") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_STOCH_TFX$Action)-1)){
  prev=(Model_STOCH_TFX$Action[i-1])
  curr=(Model_STOCH_TFX$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_TFX$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_TFX$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_TFX$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_TFX$Action[i]="none"
  }
}


if(Model_STOCH_TFX$Action[1]=="buy"){
    Model_STOCH_TFX$StocksHeld[1]=(Model_STOCH_TFX$Capital_TFX[1]/Model_STOCH_TFX$close_TFX[1])
    Model_STOCH_TFX$Capital_TFX[1]=0
}


for(i in 2:(length(Model_STOCH_TFX$Action)-1)){
  prev=(Model_STOCH_TFX$Action[i-1])
  curr=(Model_STOCH_TFX$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_TFX$StocksHeld[i]=(Model_STOCH_TFX$Capital_TFX[i-1]/Model_STOCH_TFX$close_TFX[i])
    Model_STOCH_TFX$Capital_TFX[i]=0
  }else if(curr=="sell"){
    Model_STOCH_TFX$Capital_TFX[i]=(Model_STOCH_TFX$StocksHeld[i-1]*Model_STOCH_TFX$close_TFX[i])
    Model_STOCH_TFX$StocksHeld[i]=0
  }
  else{
    Model_STOCH_TFX$Capital_TFX[i]=Model_STOCH_TFX$Capital_TFX[i-1]
    Model_STOCH_TFX$StocksHeld[i]=Model_STOCH_TFX$StocksHeld[i-1]
  }
}

if(Model_STOCH_TFX$StocksHeld[length(Model_STOCH_TFX$Action)-1]>0){
    Model_STOCH_TFX$Capital_TFX[length(Model_STOCH_TFX$Action)]=(Model_STOCH_TFX$StocksHeld[length(Model_STOCH_TFX$Action)-1]*Model_STOCH_TFX$close_TFX[length(Model_STOCH_TFX$Action)])
    Model_STOCH_TFX$Action[length(Model_STOCH_TFX$Action)]="sell"
    Model_STOCH_TFX$StocksHeld[length(Model_STOCH_TFX$Action)]=0  
}else{
  Model_STOCH_TFX$Capital_TFX[length(Model_STOCH_TFX$Action)]=Model_STOCH_TFX$Capital_TFX[length(Model_STOCH_TFX$Action)-1]
}




(returns_STOCH_TFX <- (Model_STOCH_TFX$Capital_TFX[length(Model_STOCH_TFX$Action)]/Initial_Capital-1)*100)
(returns_TFX_hold <- (Model_STOCH_TFX$close_TFX[length(Model_STOCH_TFX$Action)]/Model_STOCH_TFX$close_TFX[1]-1)*100)


##EPM Using STOCH

STOCH_Tbl <- EPM_STOCH
Price_Tbl <- EPM_Price


Model_STOCH_EPM <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_EPM > Upper_STOCH, "sell", ifelse(SlowD_EPM < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_EPM = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_EPM", "Action", "Capital_EPM", "StocksHeld", "close_EPM") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27") 


for(i in 2:(length(Model_STOCH_EPM$Action)-1)){
  prev=(Model_STOCH_EPM$Action[i-1])
  curr=(Model_STOCH_EPM$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_EPM$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_EPM$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_EPM$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_EPM$Action[i]="none"
  }
}


if(Model_STOCH_EPM$Action[1]=="buy"){
    Model_STOCH_EPM$StocksHeld[1]=(Model_STOCH_EPM$Capital_EPM[1]/Model_STOCH_EPM$close_EPM[1])
    Model_STOCH_EPM$Capital_EPM[1]=0
}


for(i in 2:(length(Model_STOCH_EPM$Action)-1)){
  prev=(Model_STOCH_EPM$Action[i-1])
  curr=(Model_STOCH_EPM$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_EPM$StocksHeld[i]=(Model_STOCH_EPM$Capital_EPM[i-1]/Model_STOCH_EPM$close_EPM[i])
    Model_STOCH_EPM$Capital_EPM[i]=0
  }else if(curr=="sell"){
    Model_STOCH_EPM$Capital_EPM[i]=(Model_STOCH_EPM$StocksHeld[i-1]*Model_STOCH_EPM$close_EPM[i])
    Model_STOCH_EPM$StocksHeld[i]=0
  }
  else{
    Model_STOCH_EPM$Capital_EPM[i]=Model_STOCH_EPM$Capital_EPM[i-1]
    Model_STOCH_EPM$StocksHeld[i]=Model_STOCH_EPM$StocksHeld[i-1]
  }
}

if(Model_STOCH_EPM$StocksHeld[length(Model_STOCH_EPM$Action)-1]>0){
    Model_STOCH_EPM$Capital_EPM[length(Model_STOCH_EPM$Action)]=(Model_STOCH_EPM$StocksHeld[length(Model_STOCH_EPM$Action)-1]*Model_STOCH_EPM$close_EPM[length(Model_STOCH_EPM$Action)])
    Model_STOCH_EPM$Action[length(Model_STOCH_EPM$Action)]="sell"
    Model_STOCH_EPM$StocksHeld[length(Model_STOCH_EPM$Action)]=0  
}else{
  Model_STOCH_EPM$Capital_EPM[length(Model_STOCH_EPM$Action)]=Model_STOCH_EPM$Capital_EPM[length(Model_STOCH_EPM$Action)-1]
}




(returns_STOCH_EPM <- (Model_STOCH_EPM$Capital_EPM[length(Model_STOCH_EPM$Action)]/Initial_Capital-1)*100)
(returns_EPM_hold <- (Model_STOCH_EPM$close_EPM[length(Model_STOCH_EPM$Action)]/Model_STOCH_EPM$close_EPM[1]-1)*100)


##LKFN Using STOCH

STOCH_Tbl <- LKFN_STOCH
Price_Tbl <- LKFN_Price


Model_STOCH_LKFN <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_LKFN > Upper_STOCH, "sell", ifelse(SlowD_LKFN < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_LKFN = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_LKFN", "Action", "Capital_LKFN", "StocksHeld", "close_LKFN") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_STOCH_LKFN$Action)-1)){
  prev=(Model_STOCH_LKFN$Action[i-1])
  curr=(Model_STOCH_LKFN$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_LKFN$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_LKFN$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_LKFN$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_LKFN$Action[i]="none"
  }
}


if(Model_STOCH_LKFN$Action[1]=="buy"){
    Model_STOCH_LKFN$StocksHeld[1]=(Model_STOCH_LKFN$Capital_LKFN[1]/Model_STOCH_LKFN$close_LKFN[1])
    Model_STOCH_LKFN$Capital_LKFN[1]=0
}


for(i in 2:(length(Model_STOCH_LKFN$Action)-1)){
  prev=(Model_STOCH_LKFN$Action[i-1])
  curr=(Model_STOCH_LKFN$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_LKFN$StocksHeld[i]=(Model_STOCH_LKFN$Capital_LKFN[i-1]/Model_STOCH_LKFN$close_LKFN[i])
    Model_STOCH_LKFN$Capital_LKFN[i]=0
  }else if(curr=="sell"){
    Model_STOCH_LKFN$Capital_LKFN[i]=(Model_STOCH_LKFN$StocksHeld[i-1]*Model_STOCH_LKFN$close_LKFN[i])
    Model_STOCH_LKFN$StocksHeld[i]=0
  }
  else{
    Model_STOCH_LKFN$Capital_LKFN[i]=Model_STOCH_LKFN$Capital_LKFN[i-1]
    Model_STOCH_LKFN$StocksHeld[i]=Model_STOCH_LKFN$StocksHeld[i-1]
  }
}

if(Model_STOCH_LKFN$StocksHeld[length(Model_STOCH_LKFN$Action)-1]>0){
    Model_STOCH_LKFN$Capital_LKFN[length(Model_STOCH_LKFN$Action)]=(Model_STOCH_LKFN$StocksHeld[length(Model_STOCH_LKFN$Action)-1]*Model_STOCH_LKFN$close_LKFN[length(Model_STOCH_LKFN$Action)])
    Model_STOCH_LKFN$Action[length(Model_STOCH_LKFN$Action)]="sell"
    Model_STOCH_LKFN$StocksHeld[length(Model_STOCH_LKFN$Action)]=0  
  }else{
  Model_STOCH_LKFN$Capital_LKFN[length(Model_STOCH_LKFN$Action)]=Model_STOCH_LKFN$Capital_LKFN[length(Model_STOCH_LKFN$Action)-1]
}
  




(returns_STOCH_LKFN <- (Model_STOCH_LKFN$Capital_LKFN[length(Model_STOCH_LKFN$Action)]/Initial_Capital-1)*100)
(returns_LKFN_hold <- (Model_STOCH_LKFN$close_LKFN[length(Model_STOCH_LKFN$Action)]/Model_STOCH_LKFN$close_LKFN[1]-1)*100)


##LEA Using STOCH

STOCH_Tbl <- LEA_STOCH
Price_Tbl <- LEA_Price


Model_STOCH_LEA <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_LEA > Upper_STOCH, "sell", ifelse(SlowD_LEA < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_LEA = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_LEA", "Action", "Capital_LEA", "StocksHeld", "close_LEA") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_STOCH_LEA$Action)-1)){
  prev=(Model_STOCH_LEA$Action[i-1])
  curr=(Model_STOCH_LEA$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_LEA$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_LEA$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_LEA$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_LEA$Action[i]="none"
  }
}


if(Model_STOCH_LEA$Action[1]=="buy"){
    Model_STOCH_LEA$StocksHeld[1]=(Model_STOCH_LEA$Capital_LEA[1]/Model_STOCH_LEA$close_LEA[1])
    Model_STOCH_LEA$Capital_LEA[1]=0
}


for(i in 2:(length(Model_STOCH_LEA$Action)-1)){
  prev=(Model_STOCH_LEA$Action[i-1])
  curr=(Model_STOCH_LEA$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_LEA$StocksHeld[i]=(Model_STOCH_LEA$Capital_LEA[i-1]/Model_STOCH_LEA$close_LEA[i])
    Model_STOCH_LEA$Capital_LEA[i]=0
  }else if(curr=="sell"){
    Model_STOCH_LEA$Capital_LEA[i]=(Model_STOCH_LEA$StocksHeld[i-1]*Model_STOCH_LEA$close_LEA[i])
    Model_STOCH_LEA$StocksHeld[i]=0
  }
  else{
    Model_STOCH_LEA$Capital_LEA[i]=Model_STOCH_LEA$Capital_LEA[i-1]
    Model_STOCH_LEA$StocksHeld[i]=Model_STOCH_LEA$StocksHeld[i-1]
  }
}

if(Model_STOCH_LEA$StocksHeld[length(Model_STOCH_LEA$Action)-1]>0){
    Model_STOCH_LEA$Capital_LEA[length(Model_STOCH_LEA$Action)]=(Model_STOCH_LEA$StocksHeld[length(Model_STOCH_LEA$Action)-1]*Model_STOCH_LEA$close_LEA[length(Model_STOCH_LEA$Action)])
    Model_STOCH_LEA$Action[length(Model_STOCH_LEA$Action)]="sell"
    Model_STOCH_LEA$StocksHeld[length(Model_STOCH_LEA$Action)]=0  
}else{
  Model_STOCH_LEA$Capital_LEA[length(Model_STOCH_LEA$Action)]=Model_STOCH_LEA$Capital_LEA[length(Model_STOCH_LEA$Action)-1]
}




(returns_STOCH_LEA <- (Model_STOCH_LEA$Capital_LEA[length(Model_STOCH_LEA$Action)]/Initial_Capital-1)*100)
(returns_LEA_hold <- (Model_STOCH_LEA$close_LEA[length(Model_STOCH_LEA$Action)]/Model_STOCH_LEA$close_LEA[1]-1)*100)


##LOPE Using STOCH

STOCH_Tbl <- LOPE_STOCH
Price_Tbl <- LOPE_Price


Model_STOCH_LOPE <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_LOPE > Upper_STOCH, "sell", ifelse(SlowD_LOPE < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_LOPE = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_LOPE", "Action", "Capital_LOPE", "StocksHeld", "close_LOPE") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_STOCH_LOPE$Action)-1)){
  prev=(Model_STOCH_LOPE$Action[i-1])
  curr=(Model_STOCH_LOPE$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_LOPE$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_LOPE$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_LOPE$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_LOPE$Action[i]="none"
  }
}


if(Model_STOCH_LOPE$Action[1]=="buy"){
    Model_STOCH_LOPE$StocksHeld[1]=(Model_STOCH_LOPE$Capital_LOPE[1]/Model_STOCH_LOPE$close_LOPE[1])
    Model_STOCH_LOPE$Capital_LOPE[1]=0
}


for(i in 2:(length(Model_STOCH_LOPE$Action)-1)){
  prev=(Model_STOCH_LOPE$Action[i-1])
  curr=(Model_STOCH_LOPE$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_LOPE$StocksHeld[i]=(Model_STOCH_LOPE$Capital_LOPE[i-1]/Model_STOCH_LOPE$close_LOPE[i])
    Model_STOCH_LOPE$Capital_LOPE[i]=0
  }else if(curr=="sell"){
    Model_STOCH_LOPE$Capital_LOPE[i]=(Model_STOCH_LOPE$StocksHeld[i-1]*Model_STOCH_LOPE$close_LOPE[i])
    Model_STOCH_LOPE$StocksHeld[i]=0
  }
  else{
    Model_STOCH_LOPE$Capital_LOPE[i]=Model_STOCH_LOPE$Capital_LOPE[i-1]
    Model_STOCH_LOPE$StocksHeld[i]=Model_STOCH_LOPE$StocksHeld[i-1]
  }
}

if(Model_STOCH_LOPE$StocksHeld[length(Model_STOCH_LOPE$Action)-1]>0){
    Model_STOCH_LOPE$Capital_LOPE[length(Model_STOCH_LOPE$Action)]=(Model_STOCH_LOPE$StocksHeld[length(Model_STOCH_LOPE$Action)-1]*Model_STOCH_LOPE$close_LOPE[length(Model_STOCH_LOPE$Action)])
    Model_STOCH_LOPE$Action[length(Model_STOCH_LOPE$Action)]="sell"
    Model_STOCH_LOPE$StocksHeld[length(Model_STOCH_LOPE$Action)]=0  
}else{
  Model_STOCH_LOPE$Capital_LOPE[length(Model_STOCH_LOPE$Action)]=Model_STOCH_LOPE$Capital_LOPE[length(Model_STOCH_LOPE$Action)-1]
}




(returns_STOCH_LOPE <- (Model_STOCH_LOPE$Capital_LOPE[length(Model_STOCH_LOPE$Action)]/Initial_Capital-1)*100)
(returns_LOPE_hold <- (Model_STOCH_LOPE$close_LOPE[length(Model_STOCH_LOPE$Action)]/Model_STOCH_LOPE$close_LOPE[1]-1)*100)


##IMAX Using STOCH

STOCH_Tbl <- IMAX_STOCH
Price_Tbl <- IMAX_Price


Model_STOCH_IMAX <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_IMAX > Upper_STOCH, "sell", ifelse(SlowD_IMAX < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_IMAX = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_IMAX", "Action", "Capital_IMAX", "StocksHeld", "close_IMAX") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_STOCH_IMAX$Action)-1)){
  prev=(Model_STOCH_IMAX$Action[i-1])
  curr=(Model_STOCH_IMAX$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_IMAX$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_IMAX$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_IMAX$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_IMAX$Action[i]="none"
  }
}


if(Model_STOCH_IMAX$Action[1]=="buy"){
    Model_STOCH_IMAX$StocksHeld[1]=(Model_STOCH_IMAX$Capital_IMAX[1]/Model_STOCH_IMAX$close_IMAX[1])
    Model_STOCH_IMAX$Capital_IMAX[1]=0
}


for(i in 2:(length(Model_STOCH_IMAX$Action)-1)){
  prev=(Model_STOCH_IMAX$Action[i-1])
  curr=(Model_STOCH_IMAX$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_IMAX$StocksHeld[i]=(Model_STOCH_IMAX$Capital_IMAX[i-1]/Model_STOCH_IMAX$close_IMAX[i])
    Model_STOCH_IMAX$Capital_IMAX[i]=0
  }else if(curr=="sell"){
    Model_STOCH_IMAX$Capital_IMAX[i]=(Model_STOCH_IMAX$StocksHeld[i-1]*Model_STOCH_IMAX$close_IMAX[i])
    Model_STOCH_IMAX$StocksHeld[i]=0
  }
  else{
    Model_STOCH_IMAX$Capital_IMAX[i]=Model_STOCH_IMAX$Capital_IMAX[i-1]
    Model_STOCH_IMAX$StocksHeld[i]=Model_STOCH_IMAX$StocksHeld[i-1]
  }
}

if(Model_STOCH_IMAX$StocksHeld[length(Model_STOCH_IMAX$Action)-1]>0){
    Model_STOCH_IMAX$Capital_IMAX[length(Model_STOCH_IMAX$Action)]=(Model_STOCH_IMAX$StocksHeld[length(Model_STOCH_IMAX$Action)-1]*Model_STOCH_IMAX$close_IMAX[length(Model_STOCH_IMAX$Action)])
    Model_STOCH_IMAX$Action[length(Model_STOCH_IMAX$Action)]="sell"
    Model_STOCH_IMAX$StocksHeld[length(Model_STOCH_IMAX$Action)]=0  
}else{
  Model_STOCH_IMAX$Capital_IMAX[length(Model_STOCH_IMAX$Action)]=Model_STOCH_IMAX$Capital_IMAX[length(Model_STOCH_IMAX$Action)-1]
}




(returns_STOCH_IMAX <- (Model_STOCH_IMAX$Capital_IMAX[length(Model_STOCH_IMAX$Action)]/Initial_Capital-1)*100)
(returns_IMAX_hold <- (Model_STOCH_IMAX$close_IMAX[length(Model_STOCH_IMAX$Action)]/Model_STOCH_IMAX$close_IMAX[1]-1)*100)


##ATHN Using STOCH

STOCH_Tbl <- ATHN_STOCH
Price_Tbl <- ATHN_Price


Model_STOCH_ATHN <- STOCH_Tbl %>%
  mutate(Action = ifelse(SlowD_ATHN > Upper_STOCH, "sell", ifelse(SlowD_ATHN < Lower_STOCH, "buy", "none"))) %>%
  mutate(Capital_ATHN = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "SlowD_ATHN", "Action", "Capital_ATHN", "StocksHeld", "close_ATHN") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27") %>%
  filter(time > "2013-11-25")


for(i in 2:(length(Model_STOCH_ATHN$Action)-1)){
  prev=(Model_STOCH_ATHN$Action[i-1])
  curr=(Model_STOCH_ATHN$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_STOCH_ATHN$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_STOCH_ATHN$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_STOCH_ATHN$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_STOCH_ATHN$Action[i]="none"
  }
}


if(Model_STOCH_ATHN$Action[1]=="buy"){
    Model_STOCH_ATHN$StocksHeld[1]=(Model_STOCH_ATHN$Capital_ATHN[1]/Model_STOCH_ATHN$close_ATHN[1])
    Model_STOCH_ATHN$Capital_ATHN[1]=0
}


for(i in 2:(length(Model_STOCH_ATHN$Action)-1)){
  prev=(Model_STOCH_ATHN$Action[i-1])
  curr=(Model_STOCH_ATHN$Action[i])
  
  if(curr=="buy"){
    Model_STOCH_ATHN$StocksHeld[i]=(Model_STOCH_ATHN$Capital_ATHN[i-1]/Model_STOCH_ATHN$close_ATHN[i])
    Model_STOCH_ATHN$Capital_ATHN[i]=0
  }else if(curr=="sell"){
    Model_STOCH_ATHN$Capital_ATHN[i]=(Model_STOCH_ATHN$StocksHeld[i-1]*Model_STOCH_ATHN$close_ATHN[i])
    Model_STOCH_ATHN$StocksHeld[i]=0
  }
  else{
    Model_STOCH_ATHN$Capital_ATHN[i]=Model_STOCH_ATHN$Capital_ATHN[i-1]
    Model_STOCH_ATHN$StocksHeld[i]=Model_STOCH_ATHN$StocksHeld[i-1]
  }
}

if(Model_STOCH_ATHN$StocksHeld[length(Model_STOCH_ATHN$Action)-1]>0){
    Model_STOCH_ATHN$Capital_ATHN[length(Model_STOCH_ATHN$Action)]=(Model_STOCH_ATHN$StocksHeld[length(Model_STOCH_ATHN$Action)-1]*Model_STOCH_ATHN$close_ATHN[length(Model_STOCH_ATHN$Action)])
    Model_STOCH_ATHN$Action[length(Model_STOCH_ATHN$Action)]="sell"
    Model_STOCH_ATHN$StocksHeld[length(Model_STOCH_ATHN$Action)]=0  
}else{
  Model_STOCH_ATHN$Capital_ATHN[length(Model_STOCH_ATHN$Action)]=Model_STOCH_ATHN$Capital_ATHN[length(Model_STOCH_ATHN$Action)-1]
}


(returns_STOCH_ATHN <- (Model_STOCH_ATHN$Capital_ATHN[length(Model_STOCH_ATHN$Action)]/Initial_Capital-1)*100)
(returns_ATHN_hold <- (Model_STOCH_ATHN$close_ATHN[length(Model_STOCH_ATHN$Action)]/Model_STOCH_ATHN$close_ATHN[1]-1)*100)



STOCH_mean_returns_Random <- mean(returns_STOCH_NANO+returns_STOCH_PEZ+returns_STOCH_FE+returns_STOCH_TFX+returns_STOCH_EPM+returns_STOCH_LKFN+returns_STOCH_LEA+returns_STOCH_LOPE+returns_STOCH_IMAX+returns_STOCH_ATHN)


c(STOCH_mean_returns_Random, Upper_STOCH, Lower_STOCH)

}
```

  
```{r eval=FALSE}
#input radius 
radius_input <- 20
#number of recursions
recursions <- 3
max_upper_stoch = 80
max_lower_stoch = 40

param_j <- 2*radius_input
stoch_data<-matrix(rep(0, 300),ncol=3)

for(i in 1:recursions){
  
  for(j in 1:param_j){
    output<-STOCH_model_Random(1000, max_upper_stoch, (max_lower_stoch+j)-(radius_input))
    stoch_data[j,]<-output
  }
  max_lower_stoch=stoch_data[which.max(stoch_data[,1]),3]
    
  for(j in 1:param_j){
    output<-STOCH_model_Random(1000, (max_upper_stoch+j)-(radius_input), max_lower_stoch)
    stoch_data[j,]<-output
  }
  max_upper_stoch=stoch_data[which.max(stoch_data[,1]),2]
}
max_lower_stoch
max_upper_stoch
stoch_data

stoch_opt <- as.data.frame(stoch_data)
stoch_opt <- stoch_opt[apply(stoch_opt!=0, 1, all),]
colnames(stoch_opt) <- c("Mean STOCH Returns","Upper Bound STOCH","Lower Bound STOCH") 
stoch_opt

```

#RSI, Random Portfolio

```{r}
Initial_Capital <- 1000
Upper_RSI <- 70
Lower_RSI <- 30

RSI_model_Random <-function(Initial_Capital, Upper_RSI, Lower_RSI){
  
 
RSI_Tbl <- NANO_RSI
Price_Tbl <- NANO_Price



Model_RSI_NANO <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_NANO > Upper_RSI, "sell", ifelse(RSI_NANO < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_NANO = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_NANO", "Action", "Capital_NANO", "StocksHeld", "close_NANO") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_RSI_NANO$Action)-1)){
  prev=(Model_RSI_NANO$Action[i-1])
  curr=(Model_RSI_NANO$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_NANO$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_NANO$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_NANO$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_NANO$Action[i]="none"
  }

if(Model_RSI_NANO$Action[1]=="buy"){
    Model_RSI_NANO$StocksHeld[1]=(Model_RSI_NANO$Capital_NANO[1]/Model_RSI_NANO$close_NANO[1])
    Model_RSI_NANO$Capital_NANO[1]=0
}}


for(i in 2:(length(Model_RSI_NANO$Action)-1)){
  prev=(Model_RSI_NANO$Action[i-1])
  curr=(Model_RSI_NANO$Action[i])
  
  if(curr=="buy"){
    Model_RSI_NANO$StocksHeld[i]=(Model_RSI_NANO$Capital_NANO[i-1]/Model_RSI_NANO$close_NANO[i])
    Model_RSI_NANO$Capital_NANO[i]=0
  }else if(curr=="sell"){
    Model_RSI_NANO$Capital_NANO[i]=(Model_RSI_NANO$StocksHeld[i-1]*Model_RSI_NANO$close_NANO[i])
    Model_RSI_NANO$StocksHeld[i]=0
  }
  else{
    Model_RSI_NANO$Capital_NANO[i]=Model_RSI_NANO$Capital_NANO[i-1]
    Model_RSI_NANO$StocksHeld[i]=Model_RSI_NANO$StocksHeld[i-1]
  }

if(Model_RSI_NANO$StocksHeld[length(Model_RSI_NANO$Action)-1]>0){
    Model_RSI_NANO$Capital_NANO[length(Model_RSI_NANO$Action)]=(Model_RSI_NANO$StocksHeld[length(Model_RSI_NANO$Action)-1]*Model_RSI_NANO$close_NANO[length(Model_RSI_NANO$Action)])
    Model_RSI_NANO$Action[length(Model_RSI_NANO$Action)]="sell"
    Model_RSI_NANO$StocksHeld[length(Model_RSI_NANO$Action)]=0  
}else{
  Model_RSI_NANO$Capital_NANO[length(Model_RSI_NANO$Action)]=Model_RSI_NANO$Capital_NANO[length(Model_RSI_NANO$Action)-1]
}}




(returns_RSI_NANO <- (Model_RSI_NANO$Capital_NANO[length(Model_RSI_NANO$Action)]/Initial_Capital-1)*100)
(returns_NANO_hold <- (Model_RSI_NANO$close_NANO[length(Model_RSI_NANO$Action)]/Model_RSI_NANO$close_NANO[1]-1)*100)


##PEZ Using RSI

RSI_Tbl <- PEZ_RSI
Price_Tbl <- PEZ_Price


Model_RSI_PEZ <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_PEZ > Upper_RSI, "sell", ifelse(RSI_PEZ < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_PEZ = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_PEZ", "Action", "Capital_PEZ", "StocksHeld", "close_PEZ") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_RSI_PEZ$Action)-1)){
  prev=(Model_RSI_PEZ$Action[i-1])
  curr=(Model_RSI_PEZ$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_PEZ$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_PEZ$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_PEZ$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_PEZ$Action[i]="none"
  }
}


if(Model_RSI_PEZ$Action[1]=="buy"){
    Model_RSI_PEZ$StocksHeld[1]=(Model_RSI_PEZ$Capital_PEZ[1]/Model_RSI_PEZ$close_PEZ[1])
    Model_RSI_PEZ$Capital_PEZ[1]=0
}


for(i in 2:(length(Model_RSI_PEZ$Action)-1)){
  prev=(Model_RSI_PEZ$Action[i-1])
  curr=(Model_RSI_PEZ$Action[i])
  
  if(curr=="buy"){
    Model_RSI_PEZ$StocksHeld[i]=(Model_RSI_PEZ$Capital_PEZ[i-1]/Model_RSI_PEZ$close_PEZ[i])
    Model_RSI_PEZ$Capital_PEZ[i]=0
  }else if(curr=="sell"){
    Model_RSI_PEZ$Capital_PEZ[i]=(Model_RSI_PEZ$StocksHeld[i-1]*Model_RSI_PEZ$close_PEZ[i])
    Model_RSI_PEZ$StocksHeld[i]=0
  }
  else{
    Model_RSI_PEZ$Capital_PEZ[i]=Model_RSI_PEZ$Capital_PEZ[i-1]
    Model_RSI_PEZ$StocksHeld[i]=Model_RSI_PEZ$StocksHeld[i-1]
  }
}

if(Model_RSI_PEZ$StocksHeld[length(Model_RSI_PEZ$Action)-1]>0){
    Model_RSI_PEZ$Capital_PEZ[length(Model_RSI_PEZ$Action)]=(Model_RSI_PEZ$StocksHeld[length(Model_RSI_PEZ$Action)-1]*Model_RSI_PEZ$close_PEZ[length(Model_RSI_PEZ$Action)])
    Model_RSI_PEZ$Action[length(Model_RSI_PEZ$Action)]="sell"
    Model_RSI_PEZ$StocksHeld[length(Model_RSI_PEZ$Action)]=0  
}else{
  Model_RSI_PEZ$Capital_PEZ[length(Model_RSI_PEZ$Action)]=Model_RSI_PEZ$Capital_PEZ[length(Model_RSI_PEZ$Action)-1]
}




(returns_RSI_PEZ <- (Model_RSI_PEZ$Capital_PEZ[length(Model_RSI_PEZ$Action)]/Initial_Capital-1)*100)
(returns_PEZ_hold <- (Model_RSI_PEZ$close_PEZ[length(Model_RSI_PEZ$Action)]/Model_RSI_PEZ$close_PEZ[1]-1)*100)



##FE Using RSI

RSI_Tbl <- FE_RSI
Price_Tbl <- FE_Price


Model_RSI_FE <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_FE > Upper_RSI, "sell", ifelse(RSI_FE < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_FE = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_FE", "Action", "Capital_FE", "StocksHeld", "close_FE") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_RSI_FE$Action)-1)){
  prev=(Model_RSI_FE$Action[i-1])
  curr=(Model_RSI_FE$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_FE$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_FE$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_FE$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_FE$Action[i]="none"
  }
}


if(Model_RSI_FE$Action[1]=="buy"){
    Model_RSI_FE$StocksHeld[1]=(Model_RSI_FE$Capital_FE[1]/Model_RSI_FE$close_FE[1])
    Model_RSI_FE$Capital_FE[1]=0
}


for(i in 2:(length(Model_RSI_FE$Action)-1)){
  prev=(Model_RSI_FE$Action[i-1])
  curr=(Model_RSI_FE$Action[i])
  
  if(curr=="buy"){
    Model_RSI_FE$StocksHeld[i]=(Model_RSI_FE$Capital_FE[i-1]/Model_RSI_FE$close_FE[i])
    Model_RSI_FE$Capital_FE[i]=0
  }else if(curr=="sell"){
    Model_RSI_FE$Capital_FE[i]=(Model_RSI_FE$StocksHeld[i-1]*Model_RSI_FE$close_FE[i])
    Model_RSI_FE$StocksHeld[i]=0
  }
  else{
    Model_RSI_FE$Capital_FE[i]=Model_RSI_FE$Capital_FE[i-1]
    Model_RSI_FE$StocksHeld[i]=Model_RSI_FE$StocksHeld[i-1]
  }
}

if(Model_RSI_FE$StocksHeld[length(Model_RSI_FE$Action)-1]>0){
    Model_RSI_FE$Capital_FE[length(Model_RSI_FE$Action)]=(Model_RSI_FE$StocksHeld[length(Model_RSI_FE$Action)-1]*Model_RSI_FE$close_FE[length(Model_RSI_FE$Action)])
    Model_RSI_FE$Action[length(Model_RSI_FE$Action)]="sell"
    Model_RSI_FE$StocksHeld[length(Model_RSI_FE$Action)]=0  
}else{
  Model_RSI_FE$Capital_FE[length(Model_RSI_FE$Action)]=Model_RSI_FE$Capital_FE[length(Model_RSI_FE$Action)-1]
}




(returns_RSI_FE <- (Model_RSI_FE$Capital_FE[length(Model_RSI_FE$Action)]/Initial_Capital-1)*100)
(returns_FE_hold <- (Model_RSI_FE$close_FE[length(Model_RSI_FE$Action)]/Model_RSI_FE$close_FE[1]-1)*100)


##TFX Using RSI

RSI_Tbl <- TFX_RSI
Price_Tbl <- TFX_Price


Model_RSI_TFX <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_TFX > Upper_RSI, "sell", ifelse(RSI_TFX < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_TFX= Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_TFX", "Action", "Capital_TFX", "StocksHeld", "close_TFX") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_RSI_TFX$Action)-1)){
  prev=(Model_RSI_TFX$Action[i-1])
  curr=(Model_RSI_TFX$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_TFX$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_TFX$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_TFX$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_TFX$Action[i]="none"
  }
}


if(Model_RSI_TFX$Action[1]=="buy"){
    Model_RSI_TFX$StocksHeld[1]=(Model_RSI_TFX$Capital_TFX[1]/Model_RSI_TFX$close_TFX[1])
    Model_RSI_TFX$Capital_TFX[1]=0
}


for(i in 2:(length(Model_RSI_TFX$Action)-1)){
  prev=(Model_RSI_TFX$Action[i-1])
  curr=(Model_RSI_TFX$Action[i])
  
  if(curr=="buy"){
    Model_RSI_TFX$StocksHeld[i]=(Model_RSI_TFX$Capital_TFX[i-1]/Model_RSI_TFX$close_TFX[i])
    Model_RSI_TFX$Capital_TFX[i]=0
  }else if(curr=="sell"){
    Model_RSI_TFX$Capital_TFX[i]=(Model_RSI_TFX$StocksHeld[i-1]*Model_RSI_TFX$close_TFX[i])
    Model_RSI_TFX$StocksHeld[i]=0
  }
  else{
    Model_RSI_TFX$Capital_TFX[i]=Model_RSI_TFX$Capital_TFX[i-1]
    Model_RSI_TFX$StocksHeld[i]=Model_RSI_TFX$StocksHeld[i-1]
  }
}

if(Model_RSI_TFX$StocksHeld[length(Model_RSI_TFX$Action)-1]>0){
    Model_RSI_TFX$Capital_TFX[length(Model_RSI_TFX$Action)]=(Model_RSI_TFX$StocksHeld[length(Model_RSI_TFX$Action)-1]*Model_RSI_TFX$close_TFX[length(Model_RSI_TFX$Action)])
    Model_RSI_TFX$Action[length(Model_RSI_TFX$Action)]="sell"
    Model_RSI_TFX$StocksHeld[length(Model_RSI_TFX$Action)]=0  
}else{
  Model_RSI_TFX$Capital_TFX[length(Model_RSI_TFX$Action)]=Model_RSI_TFX$Capital_TFX[length(Model_RSI_TFX$Action)-1]
}




(returns_RSI_TFX <- (Model_RSI_TFX$Capital_TFX[length(Model_RSI_TFX$Action)]/Initial_Capital-1)*100)
(returns_TFX_hold <- (Model_RSI_TFX$close_TFX[length(Model_RSI_TFX$Action)]/Model_RSI_TFX$close_TFX[1]-1)*100)


##EPM Using RSI

RSI_Tbl <- EPM_RSI
Price_Tbl <- EPM_Price


Model_RSI_EPM <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_EPM > Upper_RSI, "sell", ifelse(RSI_EPM < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_EPM = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_EPM", "Action", "Capital_EPM", "StocksHeld", "close_EPM") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27") 


for(i in 2:(length(Model_RSI_EPM$Action)-1)){
  prev=(Model_RSI_EPM$Action[i-1])
  curr=(Model_RSI_EPM$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_EPM$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_EPM$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_EPM$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_EPM$Action[i]="none"
  }
}


if(Model_RSI_EPM$Action[1]=="buy"){
    Model_RSI_EPM$StocksHeld[1]=(Model_RSI_EPM$Capital_EPM[1]/Model_RSI_EPM$close_EPM[1])
    Model_RSI_EPM$Capital_EPM[1]=0
}


for(i in 2:(length(Model_RSI_EPM$Action)-1)){
  prev=(Model_RSI_EPM$Action[i-1])
  curr=(Model_RSI_EPM$Action[i])
  
  if(curr=="buy"){
    Model_RSI_EPM$StocksHeld[i]=(Model_RSI_EPM$Capital_EPM[i-1]/Model_RSI_EPM$close_EPM[i])
    Model_RSI_EPM$Capital_EPM[i]=0
  }else if(curr=="sell"){
    Model_RSI_EPM$Capital_EPM[i]=(Model_RSI_EPM$StocksHeld[i-1]*Model_RSI_EPM$close_EPM[i])
    Model_RSI_EPM$StocksHeld[i]=0
  }
  else{
    Model_RSI_EPM$Capital_EPM[i]=Model_RSI_EPM$Capital_EPM[i-1]
    Model_RSI_EPM$StocksHeld[i]=Model_RSI_EPM$StocksHeld[i-1]
  }
}

if(Model_RSI_EPM$StocksHeld[length(Model_RSI_EPM$Action)-1]>0){
    Model_RSI_EPM$Capital_EPM[length(Model_RSI_EPM$Action)]=(Model_RSI_EPM$StocksHeld[length(Model_RSI_EPM$Action)-1]*Model_RSI_EPM$close_EPM[length(Model_RSI_EPM$Action)])
    Model_RSI_EPM$Action[length(Model_RSI_EPM$Action)]="sell"
    Model_RSI_EPM$StocksHeld[length(Model_RSI_EPM$Action)]=0  
}else{
  Model_RSI_EPM$Capital_EPM[length(Model_RSI_EPM$Action)]=Model_RSI_EPM$Capital_EPM[length(Model_RSI_EPM$Action)-1]
}




(returns_RSI_EPM <- (Model_RSI_EPM$Capital_EPM[length(Model_RSI_EPM$Action)]/Initial_Capital-1)*100)
(returns_EPM_hold <- (Model_RSI_EPM$close_EPM[length(Model_RSI_EPM$Action)]/Model_RSI_EPM$close_EPM[1]-1)*100)


##LKFN Using RSI

RSI_Tbl <- LKFN_RSI
Price_Tbl <- LKFN_Price


Model_RSI_LKFN <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_LKFN > Upper_RSI, "sell", ifelse(RSI_LKFN < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_LKFN = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_LKFN", "Action", "Capital_LKFN", "StocksHeld", "close_LKFN") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_RSI_LKFN$Action)-1)){
  prev=(Model_RSI_LKFN$Action[i-1])
  curr=(Model_RSI_LKFN$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_LKFN$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_LKFN$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_LKFN$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_LKFN$Action[i]="none"
  }
}


if(Model_RSI_LKFN$Action[1]=="buy"){
    Model_RSI_LKFN$StocksHeld[1]=(Model_RSI_LKFN$Capital_LKFN[1]/Model_RSI_LKFN$close_LKFN[1])
    Model_RSI_LKFN$Capital_LKFN[1]=0
}


for(i in 2:(length(Model_RSI_LKFN$Action)-1)){
  prev=(Model_RSI_LKFN$Action[i-1])
  curr=(Model_RSI_LKFN$Action[i])
  
  if(curr=="buy"){
    Model_RSI_LKFN$StocksHeld[i]=(Model_RSI_LKFN$Capital_LKFN[i-1]/Model_RSI_LKFN$close_LKFN[i])
    Model_RSI_LKFN$Capital_LKFN[i]=0
  }else if(curr=="sell"){
    Model_RSI_LKFN$Capital_LKFN[i]=(Model_RSI_LKFN$StocksHeld[i-1]*Model_RSI_LKFN$close_LKFN[i])
    Model_RSI_LKFN$StocksHeld[i]=0
  }
  else{
    Model_RSI_LKFN$Capital_LKFN[i]=Model_RSI_LKFN$Capital_LKFN[i-1]
    Model_RSI_LKFN$StocksHeld[i]=Model_RSI_LKFN$StocksHeld[i-1]
  }
}

if(Model_RSI_LKFN$StocksHeld[length(Model_RSI_LKFN$Action)-1]>0){
    Model_RSI_LKFN$Capital_LKFN[length(Model_RSI_LKFN$Action)]=(Model_RSI_LKFN$StocksHeld[length(Model_RSI_LKFN$Action)-1]*Model_RSI_LKFN$close_LKFN[length(Model_RSI_LKFN$Action)])
    Model_RSI_LKFN$Action[length(Model_RSI_LKFN$Action)]="sell"
    Model_RSI_LKFN$StocksHeld[length(Model_RSI_LKFN$Action)]=0  
  }else{
  Model_RSI_LKFN$Capital_LKFN[length(Model_RSI_LKFN$Action)]=Model_RSI_LKFN$Capital_LKFN[length(Model_RSI_LKFN$Action)-1]
}
  




(returns_RSI_LKFN <- (Model_RSI_LKFN$Capital_LKFN[length(Model_RSI_LKFN$Action)]/Initial_Capital-1)*100)
(returns_LKFN_hold <- (Model_RSI_LKFN$close_LKFN[length(Model_RSI_LKFN$Action)]/Model_RSI_LKFN$close_LKFN[1]-1)*100)


##LEA Using RSI

RSI_Tbl <- LEA_RSI
Price_Tbl <- LEA_Price


Model_RSI_LEA <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_LEA > Upper_RSI, "sell", ifelse(RSI_LEA < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_LEA = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_LEA", "Action", "Capital_LEA", "StocksHeld", "close_LEA") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_RSI_LEA$Action)-1)){
  prev=(Model_RSI_LEA$Action[i-1])
  curr=(Model_RSI_LEA$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_LEA$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_LEA$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_LEA$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_LEA$Action[i]="none"
  }
}


if(Model_RSI_LEA$Action[1]=="buy"){
    Model_RSI_LEA$StocksHeld[1]=(Model_RSI_LEA$Capital_LEA[1]/Model_RSI_LEA$close_LEA[1])
    Model_RSI_LEA$Capital_LEA[1]=0
}


for(i in 2:(length(Model_RSI_LEA$Action)-1)){
  prev=(Model_RSI_LEA$Action[i-1])
  curr=(Model_RSI_LEA$Action[i])
  
  if(curr=="buy"){
    Model_RSI_LEA$StocksHeld[i]=(Model_RSI_LEA$Capital_LEA[i-1]/Model_RSI_LEA$close_LEA[i])
    Model_RSI_LEA$Capital_LEA[i]=0
  }else if(curr=="sell"){
    Model_RSI_LEA$Capital_LEA[i]=(Model_RSI_LEA$StocksHeld[i-1]*Model_RSI_LEA$close_LEA[i])
    Model_RSI_LEA$StocksHeld[i]=0
  }
  else{
    Model_RSI_LEA$Capital_LEA[i]=Model_RSI_LEA$Capital_LEA[i-1]
    Model_RSI_LEA$StocksHeld[i]=Model_RSI_LEA$StocksHeld[i-1]
  }
}

if(Model_RSI_LEA$StocksHeld[length(Model_RSI_LEA$Action)-1]>0){
    Model_RSI_LEA$Capital_LEA[length(Model_RSI_LEA$Action)]=(Model_RSI_LEA$StocksHeld[length(Model_RSI_LEA$Action)-1]*Model_RSI_LEA$close_LEA[length(Model_RSI_LEA$Action)])
    Model_RSI_LEA$Action[length(Model_RSI_LEA$Action)]="sell"
    Model_RSI_LEA$StocksHeld[length(Model_RSI_LEA$Action)]=0  
}else{
  Model_RSI_LEA$Capital_LEA[length(Model_RSI_LEA$Action)]=Model_RSI_LEA$Capital_LEA[length(Model_RSI_LEA$Action)-1]
}




(returns_RSI_LEA <- (Model_RSI_LEA$Capital_LEA[length(Model_RSI_LEA$Action)]/Initial_Capital-1)*100)
(returns_LEA_hold <- (Model_RSI_LEA$close_LEA[length(Model_RSI_LEA$Action)]/Model_RSI_LEA$close_LEA[1]-1)*100)


##LOPE Using RSI

RSI_Tbl <- LOPE_RSI
Price_Tbl <- LOPE_Price


Model_RSI_LOPE <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_LOPE > Upper_RSI, "sell", ifelse(RSI_LOPE < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_LOPE = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_LOPE", "Action", "Capital_LOPE", "StocksHeld", "close_LOPE") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_RSI_LOPE$Action)-1)){
  prev=(Model_RSI_LOPE$Action[i-1])
  curr=(Model_RSI_LOPE$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_LOPE$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_LOPE$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_LOPE$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_LOPE$Action[i]="none"
  }
}


if(Model_RSI_LOPE$Action[1]=="buy"){
    Model_RSI_LOPE$StocksHeld[1]=(Model_RSI_LOPE$Capital_LOPE[1]/Model_RSI_LOPE$close_LOPE[1])
    Model_RSI_LOPE$Capital_LOPE[1]=0
}


for(i in 2:(length(Model_RSI_LOPE$Action)-1)){
  prev=(Model_RSI_LOPE$Action[i-1])
  curr=(Model_RSI_LOPE$Action[i])
  
  if(curr=="buy"){
    Model_RSI_LOPE$StocksHeld[i]=(Model_RSI_LOPE$Capital_LOPE[i-1]/Model_RSI_LOPE$close_LOPE[i])
    Model_RSI_LOPE$Capital_LOPE[i]=0
  }else if(curr=="sell"){
    Model_RSI_LOPE$Capital_LOPE[i]=(Model_RSI_LOPE$StocksHeld[i-1]*Model_RSI_LOPE$close_LOPE[i])
    Model_RSI_LOPE$StocksHeld[i]=0
  }
  else{
    Model_RSI_LOPE$Capital_LOPE[i]=Model_RSI_LOPE$Capital_LOPE[i-1]
    Model_RSI_LOPE$StocksHeld[i]=Model_RSI_LOPE$StocksHeld[i-1]
  }
}

if(Model_RSI_LOPE$StocksHeld[length(Model_RSI_LOPE$Action)-1]>0){
    Model_RSI_LOPE$Capital_LOPE[length(Model_RSI_LOPE$Action)]=(Model_RSI_LOPE$StocksHeld[length(Model_RSI_LOPE$Action)-1]*Model_RSI_LOPE$close_LOPE[length(Model_RSI_LOPE$Action)])
    Model_RSI_LOPE$Action[length(Model_RSI_LOPE$Action)]="sell"
    Model_RSI_LOPE$StocksHeld[length(Model_RSI_LOPE$Action)]=0  
}else{
  Model_RSI_LOPE$Capital_LOPE[length(Model_RSI_LOPE$Action)]=Model_RSI_LOPE$Capital_LOPE[length(Model_RSI_LOPE$Action)-1]
}




(returns_RSI_LOPE <- (Model_RSI_LOPE$Capital_LOPE[length(Model_RSI_LOPE$Action)]/Initial_Capital-1)*100)
(returns_LOPE_hold <- (Model_RSI_LOPE$close_LOPE[length(Model_RSI_LOPE$Action)]/Model_RSI_LOPE$close_LOPE[1]-1)*100)


##IMAX Using RSI

RSI_Tbl <- IMAX_RSI
Price_Tbl <- IMAX_Price


Model_RSI_IMAX <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_IMAX > Upper_RSI, "sell", ifelse(RSI_IMAX < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_IMAX = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_IMAX", "Action", "Capital_IMAX", "StocksHeld", "close_IMAX") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27")


for(i in 2:(length(Model_RSI_IMAX$Action)-1)){
  prev=(Model_RSI_IMAX$Action[i-1])
  curr=(Model_RSI_IMAX$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_IMAX$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_IMAX$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_IMAX$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_IMAX$Action[i]="none"
  }
}


if(Model_RSI_IMAX$Action[1]=="buy"){
    Model_RSI_IMAX$StocksHeld[1]=(Model_RSI_IMAX$Capital_IMAX[1]/Model_RSI_IMAX$close_IMAX[1])
    Model_RSI_IMAX$Capital_IMAX[1]=0
}


for(i in 2:(length(Model_RSI_IMAX$Action)-1)){
  prev=(Model_RSI_IMAX$Action[i-1])
  curr=(Model_RSI_IMAX$Action[i])
  
  if(curr=="buy"){
    Model_RSI_IMAX$StocksHeld[i]=(Model_RSI_IMAX$Capital_IMAX[i-1]/Model_RSI_IMAX$close_IMAX[i])
    Model_RSI_IMAX$Capital_IMAX[i]=0
  }else if(curr=="sell"){
    Model_RSI_IMAX$Capital_IMAX[i]=(Model_RSI_IMAX$StocksHeld[i-1]*Model_RSI_IMAX$close_IMAX[i])
    Model_RSI_IMAX$StocksHeld[i]=0
  }
  else{
    Model_RSI_IMAX$Capital_IMAX[i]=Model_RSI_IMAX$Capital_IMAX[i-1]
    Model_RSI_IMAX$StocksHeld[i]=Model_RSI_IMAX$StocksHeld[i-1]
  }
}

if(Model_RSI_IMAX$StocksHeld[length(Model_RSI_IMAX$Action)-1]>0){
    Model_RSI_IMAX$Capital_IMAX[length(Model_RSI_IMAX$Action)]=(Model_RSI_IMAX$StocksHeld[length(Model_RSI_IMAX$Action)-1]*Model_RSI_IMAX$close_IMAX[length(Model_RSI_IMAX$Action)])
    Model_RSI_IMAX$Action[length(Model_RSI_IMAX$Action)]="sell"
    Model_RSI_IMAX$StocksHeld[length(Model_RSI_IMAX$Action)]=0  
}else{
  Model_RSI_IMAX$Capital_IMAX[length(Model_RSI_IMAX$Action)]=Model_RSI_IMAX$Capital_IMAX[length(Model_RSI_IMAX$Action)-1]
}




(returns_RSI_IMAX <- (Model_RSI_IMAX$Capital_IMAX[length(Model_RSI_IMAX$Action)]/Initial_Capital-1)*100)
(returns_IMAX_hold <- (Model_RSI_IMAX$close_IMAX[length(Model_RSI_IMAX$Action)]/Model_RSI_IMAX$close_IMAX[1]-1)*100)


##ATHN Using RSI

RSI_Tbl <- ATHN_RSI
Price_Tbl <- ATHN_Price


Model_RSI_ATHN <- RSI_Tbl %>%
  mutate(Action = ifelse(RSI_ATHN > Upper_RSI, "sell", ifelse(RSI_ATHN < Lower_RSI, "buy", "none"))) %>%
  mutate(Capital_ATHN = Initial_Capital) %>%
  mutate(StocksHeld = 0) %>%
  inner_join(Price_Tbl, by=c("time"="timestamp")) %>%
  select("time", "RSI_ATHN", "Action", "Capital_ATHN", "StocksHeld", "close_ATHN") %>%
  arrange(time) %>% filter(time > "2013-11-25") %>%
  filter(time < "2018-11-27") %>%
  filter(time > "2013-11-25")


for(i in 2:(length(Model_RSI_ATHN$Action)-1)){
  prev=(Model_RSI_ATHN$Action[i-1])
  curr=(Model_RSI_ATHN$Action[i])
  
  if(prev=="buy" & (curr=="buy"|curr=="none")){
    Model_RSI_ATHN$Action[i]="hold"
  }else if(prev=="hold" & (curr=="none"|curr=="buy")){
    Model_RSI_ATHN$Action[i]="hold"
  }else if(prev=="sell" & curr=="sell"){
    Model_RSI_ATHN$Action[i]="none"
  }else if(prev=="none" & curr=="sell"){
    Model_RSI_ATHN$Action[i]="none"
  }
}


if(Model_RSI_ATHN$Action[1]=="buy"){
    Model_RSI_ATHN$StocksHeld[1]=(Model_RSI_ATHN$Capital_ATHN[1]/Model_RSI_ATHN$close_ATHN[1])
    Model_RSI_ATHN$Capital_ATHN[1]=0
}


for(i in 2:(length(Model_RSI_ATHN$Action)-1)){
  prev=(Model_RSI_ATHN$Action[i-1])
  curr=(Model_RSI_ATHN$Action[i])
  
  if(curr=="buy"){
    Model_RSI_ATHN$StocksHeld[i]=(Model_RSI_ATHN$Capital_ATHN[i-1]/Model_RSI_ATHN$close_ATHN[i])
    Model_RSI_ATHN$Capital_ATHN[i]=0
  }else if(curr=="sell"){
    Model_RSI_ATHN$Capital_ATHN[i]=(Model_RSI_ATHN$StocksHeld[i-1]*Model_RSI_ATHN$close_ATHN[i])
    Model_RSI_ATHN$StocksHeld[i]=0
  }
  else{
    Model_RSI_ATHN$Capital_ATHN[i]=Model_RSI_ATHN$Capital_ATHN[i-1]
    Model_RSI_ATHN$StocksHeld[i]=Model_RSI_ATHN$StocksHeld[i-1]
  }
}

if(Model_RSI_ATHN$StocksHeld[length(Model_RSI_ATHN$Action)-1]>0){
    Model_RSI_ATHN$Capital_ATHN[length(Model_RSI_ATHN$Action)]=(Model_RSI_ATHN$StocksHeld[length(Model_RSI_ATHN$Action)-1]*Model_RSI_ATHN$close_ATHN[length(Model_RSI_ATHN$Action)])
    Model_RSI_ATHN$Action[length(Model_RSI_ATHN$Action)]="sell"
    Model_RSI_ATHN$StocksHeld[length(Model_RSI_ATHN$Action)]=0  
}else{
  Model_RSI_ATHN$Capital_ATHN[length(Model_RSI_ATHN$Action)]=Model_RSI_ATHN$Capital_ATHN[length(Model_RSI_ATHN$Action)-1]
}


(returns_RSI_ATHN <- (Model_RSI_ATHN$Capital_ATHN[length(Model_RSI_ATHN$Action)]/Initial_Capital-1)*100)
(returns_ATHN_hold <- (Model_RSI_ATHN$close_ATHN[length(Model_RSI_ATHN$Action)]/Model_RSI_ATHN$close_ATHN[1]-1)*100)



RSI_mean_returns_Fid <- mean(returns_RSI_NANO+returns_RSI_PEZ+returns_RSI_FE+returns_RSI_TFX+returns_RSI_EPM+returns_RSI_LKFN+returns_RSI_LEA+returns_RSI_LOPE+returns_RSI_IMAX+returns_RSI_ATHN)


c(RSI_mean_returns_Fid, Upper_RSI, Lower_RSI)

}
```

  
```{r eval=FALSE}
#input radius 
radius_input <- 20
#number of recursions
recursions <- 3
max_upper_RSI = 90
max_lower_RSI = 20

param_j <- 2*radius_input
RSI_data<-matrix(rep(0, 300),ncol=3)

for(i in 1:recursions){
  
  for(j in 1:param_j){
    output<-RSI_model_Random(1000, max_upper_RSI, (max_lower_RSI+j)-(radius_input))
    RSI_data[j,]<-output
  }
  max_lower_RSI=RSI_data[which.max(RSI_data[,1]),3]
    
  for(j in 1:param_j){
    output<-RSI_model_Random(1000, (max_upper_RSI+j)-(radius_input), max_lower_RSI)
    RSI_data[j,]<-output
  }
  max_upper_RSI=RSI_data[which.max(RSI_data[,1]),2]
}
max_lower_RSI
max_upper_RSI
RSI_data

RSI_opt <- as.data.frame(RSI_data)
RSI_opt <- RSI_opt[apply(RSI_opt!=0, 1, all),]
colnames(RSI_opt) <- c("Mean RSI Returns","Upper Bound RSI","Lower Bound RSI") 
RSI_opt
```